\documentclass[wip, algebra]{bsteffan-lecturenotes}

\addbibresource{references.bib}

\newcommand{\cO}{\mathcal{O}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}}
\newcommand{\cH}{\mathcal{H}}
\newcommand{\cK}{\mathcal{K}}
\newcommand{\cL}{\mathcal{L}}
\newcommand{\cM}{\mathcal{M}}

\newcommand{\A}{\mathbb{A}}
\renewcommand{\P}{\mathbb{P}}

\newcommand{\Nil}{\mathrm{Nil}}
\newcommand{\Proj}{\mathrm{Proj}}
\newcommand{\Pic}{\mathrm{Pic}}
\newcommand{\Div}{\mathrm{Div}}
\newcommand{\PrDiv}{\mathrm{PrDiv}}
\newcommand{\Cl}{\mathrm{Cl}}
\newcommand{\CaCl}{\mathrm{CaCl}}
\newcommand{\QCoh}{\mathrm{QCoh}}
\newcommand{\Coh}{\mathrm{Coh}}
\newcommand{\res}{\mathrm{res}}
\newcommand{\grMod}{\mathrm{grMod}}

\newcommand{\PGL}{\mathrm{PGL}}

\newcommand{\nisom}{\ncong}

\newcommand{\sHom}{\mathcal{H}\mathrm{om}}

\DeclareNamedOperator{codim}

\DefineCategory{Sh}
\DefineCategory{Sch}
\DefineCategory{AffSch}
\DefineCategory{LocRingSpc}
\DefineCategory{RingSpc}
\DefineCategory{Ouv}

\newcommand*\noloc{%
        \nobreak
        \mskip6mu plus1mu
        \mathpunct{}%
        \nonscript
        \mkern-\thinmuskip
        {:}%
        \mskip2mu
        \relax
}

\course{Algebraic Geometry \uppercase\expandafter{\romannumeral 1\relax}}
\lecturer{Prof. Dr. Daniel Huybrechts}
\assistant{Dr. Giacomo Mezzedini}
\author{Ben Steffan}

\begin{document}
\maketitle
\tableofcontents

\section*{About These Notes}

\section{Sheaves}
Sheaf theory is supposed to keep track of local vs. global information on topological spaces.
\begin{definition}
	Let $X$ be a topological space.
	Define a poset $\Ouv_X$ with objects the open sets of $X$ ordered by inclusion.

	Let $\cC$ be a category.
	A $\cC$-valued \defineterm{presheaf} on $X$ is a functor $\cF\colon \op{\Ouv_X} \to \cC$.
\end{definition}
We will mostly be interested in presheaves of abelian groups, rings, or other algebraic structures.
Sometimes one requires that $\cF(\emptyset)$ is a terminal object of $\cC$, but we generally will not assume this.

Given such a presheaf $\cF$ and some open set $U \subseteq X$, we will call the elements of $\cF(U)$ \defineterm[section!local]{local sections of $\cF$} over $U$.
We write $\Gamma(U, \cF) \coloneq \cF(U)$ for the \defineterm{space of sections} over $U$.
If $U = X$, then an element of $\cF(X)$ will be known as a \defineterm[sectin!global]{global section} of $\cF$ and $\Gamma(X, \cF)$ as the \emph{space of global sections}.

Given open sets $V \subseteq U \subseteq X$, we will write the induced map of the inclusion as $\rho_{UV}\colon \cF(U) \to \cF(V)$ and call it a \defineterm{restriction map}.
If $s \in \cF(U)$ is a section, then we will often denote its \emph{restriction} $\rho_{UV}(s) \in \cF(V)$ to $V$ by $s|_V$.

We will take the term \enquote{presheaf on $X$} sans further qualifiers to mean $\Ab$-valued presheaf on $X$.
\begin{example}
	Let $X$ and $Y$ be spaces.
	\begin{alphanumerate}
		\item Define a presheaf $\cF$ of sets on $X$ by putting 
			\begin{equation*}
				\cF(U) \coloneq \{f\colon X \to Y \mid f \text{ continuous}\}
			\end{equation*}
			for any open $U \subseteq X$ with restriction maps given by restriction of domain.
		\item Letting $Y = \R$ in the last definition, we obtain the \defineterm[sheaf!of continuous functions]{presheaf $\cC_X$ of continuous functions} on $X$.
			Note that in this case pointwise addition and multiplication make $\cC_X$ into a presheaf of rings on $X$, although we will often consider it as simply as a presheaf of abelian groups.
		\item Let $G$ be an abelian group.
			Define the \defineterm[presheaf!constant]{constant presheaf} $\mathbb{G}$ with values in $G$ as $\mathbb{G}(U) \coloneq G$ for all $U \subseteq X$ open with all restriction maps the identity of $G$.
	\end{alphanumerate}
\end{example}

\section{Schemes}
\begin{definition}
	A \defineterm{ringed space} is a pair $(X, \cO_X)$ where $X$ is a space and $\cO_X\in \Sh_{\CRing}(X)$ a sheaf of rings on $X$.
	A \emph{morphism of ringed spaces} $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ is a pair $(f, f^\sharp)$ where $f\colon X \to Y$ is a continuous function and $f^\sharp\colon \cO_Y \to f_* \cO_X$ a map of sheaves of rings.
\end{definition}
\begin{remark}
	Given morphisms of ringed space $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ and $(g, g^\sharp)\colon (Y, \cO_Y) \to (Z, \cO_Z)$, their composite is the morphism $(g \circ f, g^\sharp \circ f^\sharp)\colon (X, \cO_X) \to (Z, \cO_Z)$ where $g^\sharp \circ f^\sharp\colon \cO_Z \to (g \circ f)_* \cO_X$ is given by 
	\begin{equation*}
		\cO_Z \xto{g^\sharp} g_* \cO_Y \xto{g_*(f^\sharp)} g_* (f_* \cO_X) = (g \circ f)_* \cO_X
	\end{equation*}
	using functoriality of pushforwards with respect to morphisms of sheaves.
\end{remark}
Note that an isomorphism of ringed spaces is a map $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ of ringed spaces such that $f$ is a homeomorphism and $f^\sharp$ an isomorphism of sheaves.

In many cases (though not always) $f^\sharp$ will be naturally \enquote{induced} by $f$.
\begin{example}\label{epl:sch:examples}
	\leavevmode
	\begin{alphanumerate}
		\item If $X$ is a space and $\cO_X = \cC_X$ its sheaf of continuous functions, then $(X, \cO_X)$ is a ringed space.
			Given a continuous map $f\colon X \to Y$, we obtain a morphism $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ by 
			\begin{align*}
				f^\sharp|_U\colon \cO_Y(U) &\to (f_* \cO_X)(U) = \cO_X(f^{-1}(U)) \\
					\big(\phi\colon U \to \R\big) &\mapsto \big(f^{-1}(U) \xto{f} U \xto{\phi} \R\big)
			\end{align*}
			for all $U \subseteq X$ open.
		\item If $X$ is a smooth manifold and $\cO_X = \cC_X^\infty$ its sheaf of smooth functions, then $(X, \cO_X)$ is a ringed space.
			Given a smooth map $f\colon X \to Y$, we define a map of sheaves $f^\sharp\colon \cO_Y \to f_* \cO_X$ by composition with $f$ as above and therefore obtain a morphism $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ of ringed spaces.
		\item If $X$ is a complex manifold and $\cO_X$ its sheaf of holomorphic functions, then $(X, \cO_X)$ is a ringed space and any holomorphic map $f\colon X \to Y$ induces a map of ringed spaces as above.
		\item Let $k$ be an algebraically closed field.
			A subset $X \subseteq k^n$ is an \defineterm{affine algebraic set} if $X = V(\ideal{a}) = \{(t_1, \ldots, t_n) \in k^n \mid f(t_1, \ldots, t_n)\} = 0 \text{ for all } f \in \ideal{a}\}$ where $\ideal{a} \subseteq k[x_1, \ldots, x_n]$ is an ideal.
			The set $X$ then becomes a space by equipping it with the subspace topology of the Zariski topology on $k^n \isom \MaxSpec k[x_1, \ldots, x_n] \subset \Spec k[x_1, \ldots, x_n]$.

			We call a function $h\colon U \to k$ defined on an open subset $U \subseteq X$ \defineterm[regular function]{regular} if for each $x \in U$ there exists an open neighborhood $V_x \subseteq U$ of $x$ and polynomials $g_1, g_2 \in k[x_1, \ldots, x_n]$ such that for all $y \in V_x$, we can express $h$ as $h(y) = g_1(y) / g_2(y)$ (in particular $g_2$ does not vanish on $V_x$).

			We then obtain a ringed space $(X, \cO_X)$ by letting $\cO_X$ be the \defineterm{sheaf of regular functions} on $X$, i.e.
			\begin{equation*}
				\cO_X(U) \coloneq \{h\colon U \to k \mid h \text{ regular}\}
			\end{equation*}
			together with the obvious restriction maps.
			We call this ringed space the \defineterm[ringed space!associated with an affine algebraic set]{ringed space associated with the affine algebraic set $X$}.
	\end{alphanumerate}
\end{example}
Note that in examples 2 and 3, we cannot expect a general continuous map to induce a morphism of ringed spaces in the same way, since composing a smooth (respectively, holomorphic) map with a continuous function may not yield a smooth (respectively, holomorphic) map again.
\begin{remark}
	A regular function $h\colon U \to k$ is continuous with respect to the Zariski topologies on its domain and codomain; this follows from the fact that polynomials are continuous.

	We should thus ask whether any continuous map $f\colon X \to Y$ between affine algebraic sets induces a $f^\sharp\colon \cO_Y \to f_* \cO_X$ via composition as in example 1.
	The answer is no in general, but if it does, we call it a \defineterm{regular function}.
\end{remark}
\begin{example}
	Consider the ringed spaces $(\R^n, \cC_{\R^n})$ and $(\R^n, \cC^\infty_{\R^n})$ and define a morphism $(f, f^\sharp)\colon (\R^n, \cC_{\R^n}) \to (\R^n, \cC_{\R^n})$ by $f = \id_{\R^n}$ and taking $f^\sharp\colon \cC^\infty_{\R^n} \to (\id_{\R^n})_* \cC_{\R^n} = \cC_{\R^n}$ to be the inclusion.
	Note in particular that $f$ is a homeomorphism but $(f, f^\sharp)$ is not an isomorphism.

	Similarly, we obtain a map $(\C^n, \cO^\mathrm{hol}_{\C^n}) \to (\C^n_{\mathrm{Zar}}, \cO^\mathrm{reg}_{\C^n})$ from the ringed space of homolomorphic functions on $\C^n$ to the ringed space of regular functions on $\C^n$ equipped with the Zariski topology.
\end{example}
\begin{definition}
	A \defineterm{locally ringed space} is a ringed space $(X, \cO_X)$ such that the stalks $\cO_{X, x}$ are local rings for all $x \in X$.
\end{definition}
\begin{example}
	Let $(X, \cO_X)$ be as in example 1 above.
	Then $(X, \cO_X)$ is a locally ringed space.
	To see this, note that the stalk of $\cO_X$ at any point $x \in X$ is given by
	\begin{equation*}
		\cO_{X, x} = \{(h\colon U \to \R) \mid x \in U \subseteq X \text{ open},\ h \in \cO_X(U)\} / {{\sim}}
	\end{equation*}
	where $(h\colon U \to \R) \sim (h'\colon V \to \R)$ if $h|_W = h'|_W$ for some open $x \in W \subseteq U \cap V$.
	Let $\ideal{m}_x \coloneq \{[h\colon U \to \R] \in \cO_{X, x} \mid h(x) = 0\}$ be the set of germs vanishing at $x$.
	Obviously $\ideal{m}_x$ is a proper ideal, and it is in fact the unique maximal ideal of $\cO_{X, x}$:
	To see this, it suffices to show that every element $g \in \cO_{X, x} \setminus \ideal{m}_x$ is invertible. 
	But a continuous function that does not vanish at $x$ does not vanish on a full neighborhood of $x$ and is therefore invertible on such a neighborhood.

	Analogous reasoning shows that the ringed spaces from examples 2 through 4 above are also locally ringed.
\end{example}
\begin{definition}
	A \defineterm[locally ringed space!morphism of]{morphism of locally ringed spaces} is a morphism of ringed spaces $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ if the induced map on stalks $f^\sharp_x\colon \cO_{Y, f(x)} \to (f_* \cO_X)_{f(x)} \to \cO_{X, x}$ is a \defineterm[local ring!morphism of]{morphism of local rings}, i.e. $\big(f^\sharp_x\big)^{-1}(\ideal{m}_x) = \ideal{m}_{f(x)}$.

	Composition of morphisms of locally ringed spaces is given by composition of morphisms of ringed spaces.
\end{definition}
\begin{remark}\label{rmk:sch:nonlocal}
	Note that being a morphism of local rings is a condition over being a morphism of rings which are local.
	If $\phi\colon A \to B$ is a ring map where $A$ and $B$ are local, then $\phi^{-1}(\ideal{m}_B) \subseteq \ideal{m}_A$ will always hold, but the reverse inclusion might not:
	Take for example $A = \Z_{(p)}$ and $B = Q(A) = \Q$ together with the canonical map.
\end{remark}
\begin{remark}
	If $\phi\colon A \to B$ is a ring homomorphism and $\ideal{q} \subset B$ a prime ideal, then $\ideal{p} \coloneq \phi^{-1}(\ideal{q})$ is a prime ideal of $A$.
	Moreover, $\phi$ induces a ring homomorphism $A_{\ideal{p}} \to B_{\ideal{q}}$.
\end{remark}
\begin{example}
	% TODO link to definition of structure sheaf
	Let $A$ be a ring and $\cO_{\Spec A}$ its structure sheaf.
	Then the pair $(\Spec A, \cO_{\Spec A})$ is a ringed space, and in fact a locally ringed space:
	% TODO link
	We have shown that $\cO_{\Spec A, \ideal{p}} \isom A_{\ideal{p}}$.
	By the previous remark, any ring homomorphism $\phi\colon A \to B$ then induces a morphism of locally ringed spaces $(f, f^\sharp)\colon (\Spec A, \cO_{\Spec A}) \to (\Spec B, \cO_{\Spec B})$.
\end{example}
\begin{definition}
	An \defineterm[scheme!affine]{affine scheme} is a locally ringed space $(X, \cO_X)$ which is isomorphic to $(\Spec A, \cO_{\Spec A})$ for some ring $A$.
\end{definition}
\begin{example}
	The following are important examples of affine schemes:
	\begin{alphanumerate}
		\item $(\Spec \Z, \cO_{\Spec \Z})$.
			For $D(a)$ a basic open set, we have $\cO_{\Spec \Z}(D(a)) \isom \Z_a$.
		\item $(\Spec k, \cO_{\Spec k})$ for $k$ a field.
			In this case $\Spec k$ consists of a single point and $\cO_{\Spec k}(\Spec(k)) = k$.
		\item $\A^n_A \coloneq (\Spec A[x_1, \ldots, x_n], \cO_{\Spec A[x_1, \ldots, x_n]})$ for $A$ any ring.
		\item $(\Spec A, \cO_{\Spec A})$ for $A$ a discrete valuation ring.
			In this case $\Spec A = \{(0), \ideal{m}\}$ where $\ideal{m}$ is the unique maximal ideal with the open sets being the empty set, $\Spec A$ itself, and $\{(0)\}$.
			We then have $\cO_{\Spec A}(\Spec A) = A$ and $\cO_{\Spec A}(\{(0)\}) = \cO_{\Spec A, (0)} = Q(A)$.
		\item $(\Spec k[x]/(x^2), \cO_{\Spec k[x]/(x^2)})$ where $k$ is a field ($k[x] / (x^2)$ is known as the \defineterm[dual numbers]{ring of dual numbers} over $k$).
			In this case $\Spec k[x]/(x^2)$ again consists of a single point, namely $(x)$.
	\end{alphanumerate}
\end{example}
Note that $(\Spec k, \cO_{\Spec k})$ and $(\Spec k[x]/(x^2), \cO_{\Spec k[x]/(x^2)})$ consist both of one point, yet are different: $\cO_{\Spec k}(\Spec k) = k$ while $\cO_{\Spec k[x]/(x^2)}(\Spec k[x]/(x^2)) = k[x] / (x^2)$.
\begin{example}
	Consider the locally ringed spaces $(\C^n, \cO^\mathrm{hol}_{\C^n})$ and $(\A^n_\C, \cO_{\A^n_\C})$ where $\cO_{\A^n_\C}$ is the structure sheaf.
	We define a map $(f, f^\sharp)\colon (\C^n, \cO^\mathrm{hol}_{\C^n}) \to (\A^n_\C, \cO_{\A^n_\C})$ as follows:
	$f$ is the map 
	\begin{align*}
		f\colon \C^n &\isom \MaxSpec(\C[x_1, \ldots, x_n]) \incl \A^n_\C \\
		(t_1, \ldots, t_n) &\mapsto (x_1 - t_1, \ldots, x_n - t_n)
	\end{align*}
	which is continuous because polynomials are continuous in the standard topology on $\C^n$.
	Letting $A \coloneq \C[x_1, \ldots, x_n]$, we define $f^\sharp\colon \cO_{\A^n_\C} \to f_* \cO^\mathrm{hol}_{\C^n}$ as
	\begin{equation*}
		f^\sharp|_U(s) = \left(U \cap \C^n \xto{s} \coprod_{\ideal{m} \in U \cap \C^n} A_{\ideal{m}} \to \C\right)
	\end{equation*}
	for all $(s\colon U \to \coprod_{\ideal{p} \in U} A_{\ideal{p}}) \in \cO_{\A^n_\C}(U)$ sections over the open set $U \subseteq \A^n_\C$ where the map $\coprod_{\ideal{m} \in U \cap \C^n} A_{\ideal{m}} \to \C$ is given component-wise by the maps $A_{\ideal{m}} \surj A_{\ideal{m}} / \ideal{m} A_{\ideal{m}} \isom \C$.
	Holomorphicity of $f^\sharp|_U(s)$ comes down to the fact that $s$ is locally representable as a quotient of polynomials which are of course holomorphic.
\end{example}
\begin{lemma}
	Let $(f, f^\sharp)\colon (\Spec A, \cO_A) \to (\Spec B, \cO_B)$ be a morphism of locally ringed spaces.
	Then $f$ is of the form $f = \Spec \phi$ where $\phi \coloneq f^\sharp(\Spec A)\colon B \isom \cO_B(\Spec B) \to (f_* \cO_A)(\Spec B) = \cO_A(\Spec A) \isom A$ is the map on global sections.
\end{lemma}
\begin{proof}
	Since passing to stalks is commutative with the map on global sections, we have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}
			B
					\ar[r, "\phi"]
					\ar[d]
				& A
					\ar[d]
			\\
			B_{f(\ideal{q})}
					\ar[r, swap, "f^\sharp_{\ideal{q}}"]
				& A_{\ideal{q}}
		\end{tikzcd}
	\end{equation*}
	for any $\ideal{q} \in \Spec A$.
	But $(f, f^\sharp)$ is local, so $(f^\sharp_{\ideal{q}})^{-1}(\ideal{q} B_{\ideal{q}}) = f(\ideal{q}) B_{f(\ideal{q})}$ and we conclude that $\phi^{-1}(\ideal{q}) = f(\ideal{q})$, whence $f = \Spec \phi$.
\end{proof}
\begin{corollary}
	Let $(f, f^\sharp), (g, g^\sharp)\colon (\Spec A, \cO_A) \to (\Spec B, \cO_B)$ be two morphisms of locally ringed spaces.
	If $f^\sharp(\Spec B) = g^\sharp(\Spec B)$, then $(f, f^\sharp) = (g, g^\sharp)$.
\end{corollary}
\begin{solution}
	By the previous lemma we have $f = g$.
	To show that $f^\sharp = g^\sharp$, it suffices to show that they agree on all distinguished open sets $D(b) \subseteq \Spec B$, and this follows from the fact that $D(b) = \Spec B_b$ by restriction.
\end{solution}
\begin{proposition}\label{prp:sch:morphbij}
	Let $A$, $B$ be two rings.
	Then there exists a bijection
	\begin{equation*}
		\begin{Bmatrix}
			\text{ring homomorphisms} \\
			A \to B
		\end{Bmatrix}
		\leftrightarrow
		\begin{Bmatrix}
			\text{morphisms of locally ringed spaces} \\
			(\Spec B, \cO_{\Spec B}) \to (\Spec A, \cO_{\Spec A})
		\end{Bmatrix}
	\end{equation*}
\end{proposition}
\begin{proof}
	Given a morphism $(f, f^\sharp)\colon (\Spec B, \cO_{\Spec B}) \to (\Spec A, \cO_{\Spec A})$, we obtain a ring homomorphism $\phi\colon A \to B$ as
	\begin{align*}
		\phi = f^\sharp\colon A \isom \cO_A(\Spec A) \to (f_* \cO_B)(\Spec A) &= \cO_B(f^{-1}(\Spec A)) \\
																			  &= \cO_B(\Spec B) \\
																			  &\isom B
	\end{align*}
	In the other direction, if we start with a ring homomorphism $\psi\colon A \to B$, we obtain a morphism $(g, g^\sharp)\colon (\Spec B, \cO_{B}) \to (\Spec A, \cO_{A})$ via $g = \Spec \psi$ and defining $g^\sharp\colon \cO_A \to g_* \cO_B$ as follows: 
	For any distinguished open set $D(a) \subseteq \Spec A$, we have $\cO_A(D(a)) \isom A_a$ as well as 
	\begin{equation*}
		(g_* \cO_B)(D(a)) = \cO_B(g^{-1}(D(a))) = \cO_B(D(\psi(a))) = B_{\psi(a)}
	\end{equation*}
	so we can take $g^\sharp\colon \cO_A(D(a)) \to (g_* \cO_B)(D(a))$ to be the natural map $A_a \to B_{\psi(a)}$ induced by $\psi$.
	It is not hard to check that this glues together to a sheaf homomorphism (in particular since the $D(a)$ form a basis of the Zariski topology on $\Spec A$), so $(g, g^\sharp)$ is a morphism of ringed spaces.
	To see that it is in fact a morphism of locally ringed spaces, let $\ideal{q} \in \Spec B$ be a prime ideal and define $\ideal{p} \coloneq \psi^{-1}(\ideal{q})$.
	Since the map $g^\sharp_{\ideal{p}}\colon \cO_{A, \ideal{p}} \to \cO_{B, \ideal{q}}$ is compatible with $\psi = g^\sharp(\Spec A)$, we find that $(g^\sharp_{\ideal{p}})^{-1}(\ideal{q} B_{\ideal{q}}) = (\psi^{-1}(\ideal{q})) A_{\psi^{-1}(\ideal{q})} = \ideal{p} A_{\ideal{p}}$ so $g^\sharp$ is local.

	Finally, we will show that these two constructions are mutually inverse.
	One direction is easy: 
	If we start with a ring homomorphism $\phi\colon A \to B$, then construct a morphism of locally ringed spaces $(f, f^\sharp)$, we recover $\phi$ as $\phi = f^\sharp(\Spec A)$.
	On the other hand, if we start with $(f, f^\sharp)$ and apply our construction to $f^\sharp(\Spec A)$ to get another morphism $(g, g^\sharp)$, the previous corollary implies that $(f, f^\sharp) = (g, g^\sharp)$ since $f^\sharp(\Spec A) = g^\sharp(\Spec B)$ by construction.
\end{proof}
\begin{definition}
	A \defineterm{scheme} is a ringed space $(X, \cO_X)$ that is locally isomorphic to an affine scheme, i.e. for all points $x \in X$ there exists an open neighborhood $U \ni x$ such that $(U, \cO_X|_U)$ is isomorphic to $(\Spec A, \cO_{\Spec A})$ for some ring $A$.
\end{definition}
\begin{definition}
	We define $\AffSch$, $\Sch$, and $\LocRingSpc$ to be the categories with objects the affine schemes, schemes, and locally ringed spaces, respectively, and morphisms all morphisms of locally ringed spaces.

	We also define a category $\RingSpc$ which has as objects all ringed spaces and as morphisms all morphisms of ringed spaces.
\end{definition}
We thus have a chain of subcategory inclusions
\begin{equation*}
	\AffSch \incl \Sch \incl \LocRingSpc \incl \RingSpc
\end{equation*}
of which the first two are full.
\begin{remark}\label{prp:sch:ringaff}
	\Cref{prp:sch:morphbij} implies that we have an equivalence of categories 
	\begin{align*}
		\op{\CRing} &\xto{\eqv} \AffSch \\
		A &\mapsto (\Spec A, \cO_{\Spec A})
	\end{align*}
\end{remark}
\begin{remark}
	Recall the example from \cref{rmk:sch:nonlocal} and note that the induced map $(\Spec Q(A), \cO_{\Spec Q(A)}) \to (\Spec A, \cO_{\Spec A})$ \emph{is} a morphism of local rings.
\end{remark}

\subsection{From Classical Algebraic Geometry to Scheme Theory}
Let $k$ be an algebraically closed field and $X \subseteq k^n$ an affine algebraic set, say $X = V(\ideal{a})$ for some ideal $\ideal{a} \subseteq k[x_1, \ldots, x_n]$.
Then $X$ comes with a sheaf, its sheaf of regular functions $\cO_X$ (see \cref{epl:sch:examples}), which gives a ringed space $(X, \cO_X)$.
In general $(X, \cO_X)$ is not a scheme, but we can associate to it a scheme as follows:
Consider the ideal $I(X) \subseteq k[x_1, \ldots, x_n]$ given by 
\begin{equation*}
	I(X) \coloneq \{f \in k[x_1, \ldots, x_n] \mid f(t_1, \ldots, t_n) = 0 \text{ for all } (t_1, \ldots, t_n) \in X\}
\end{equation*}
By Hilbert's Nullstellensatz, we then have $I(X) = \sqrt{\ideal{a}}$.
We then obtain the \defineterm{affine coordinate ring} $A(X) \coloneq k[x_1, \ldots, x_n] / I(X)$ of $X$, and from this an affine scheme $(\Spec A(X), \cO_{A(X)})$.
\begin{proposition}
	There exists a morphism of locally ringed spaces $(f, f^\sharp)\colon (X, \cO_X) \to (\Spec A(X), \cO_{A(X)})$.
\end{proposition}
\begin{proof}
	Noting that 
	\begin{equation*}
		\MaxSpec A(X) = \{\ideal{m} \in \MaxSpec k[x_1, \ldots, x_n] \mid I(X) \subseteq \ideal{m}\}
	\end{equation*}
	we see that under the bijection $k^n \leftrightarrow \MaxSpec k[x_1, \ldots, x_n]$, $(t_1, \ldots, t_n) \mapsto (x_1 - t_1, \ldots, x_n - t_n)$ we in fact have $X \isom \MaxSpec A(X)$, and so define $f$ to be the inclusion $X \isom \MaxSpec A(X) \incl \Spec A(X)$.

	If $U \subseteq \Spec A(X)$ is open and $s\colon U \to \coprod_{\ideal{p} \in U} A(X)_{\ideal{p}}$ is any section in $\cO_{A(X)}(U)$, we obtain a section $t \in (f_* \cO_X)(U) = \cO_X(U \cap \MaxSpec A(X))$ via
	\begin{equation*}
		t\colon U \cap \MaxSpec A(X) \xto{s|_{U \cap \MaxSpec A(X)}} \coprod_{\ideal{m} \in \MaxSpec A(X)} A(X)_{\ideal{m}} \to k
	\end{equation*}
	where the last map is obtained by observing that $A(X)_{\ideal{m}} / \ideal{m} A(X)_{\ideal{m}} \isom k$ for all $\ideal{m} \in \MaxSpec A(X)$ and applying this isomorphism to each component.
	% TODO check
	Since $s$ is locally of the form $s = \bar{g}_1 / \bar{g}_2$ for $\bar{g}_1, \bar{g}_2 \in A(X)$, $t$ is locally of the form $t = g_1 / g_2$ for $g_1, g_2$ lifts of $\bar{g}_1, \bar{g}_2$, respectively, and therefore $f^\sharp(s) \coloneq t$ is well-defined.

	% TODO spell this out?
	One then checks that $(f, f^\sharp)$ does in fact define a morphism of locally ringed spaces.
	In fact, if $\ideal{m} \in \MaxSpec k[x_1, \ldots, x_n]$ is the maximal ideal corresponding to $(t_1, \ldots, t_n) \in k^n$, then $\cO_{X, \ideal{m}} \isom \cO_{Y, \ideal{m}} \isom A(X)_{\ideal{m}}$.
\end{proof}
\begin{remark}
	To define $(\Spec A(X), \cO_{A(X)})$, we only that $X$ is an affine algebraic set, not that $X = V(\ideal{a})$ for a given ideal $\ideal{a}$.
	If we remember this information, we can consider $\Spec k[x_1, \ldots, x_n] / \ideal{a}$.
	We then have morphisms
	\begin{equation*}
		(X, \cO_X) \xto{(f, f^\sharp)} (\Spec A(X), \cO_{A(X)}) \xto{(g, g^\sharp)} (\Spec k[x_1, \ldots, x_n] / \ideal{a}, \cO_{k[x_1, \ldots, x_n] / \ideal{a}})
	\end{equation*}
	% TODO homeomorphism?
	where $g$ is a continuous bijection.
\end{remark}
\begin{example}
	Let $k$ be a field and $A \coloneq k[x] / (x^2)$ its ring of dual numbers.
	Then $\Spec k$ and $\Spec A$ both consist of a single point.
	Define two maps $(f, f^\sharp)\colon (\Spec k, \cO_{k}) \to (\Spec A, \cO_{A})$ and $(g, g^\sharp)\colon (\Spec A, \cO_{A}) \to (\Spec k, \cO_k)$ as follows:
	$f$ and $g$ must be the unique maps. 
	The map $f^\sharp$ is given by the quotient map $f^\sharp\colon \cO_A(\Spec A) \isom A \surj A / (x) \isom k \isom (f_* \cO_k)(\Spec A)$, and its counterpart $g^\sharp\colon \cO_k(\Spec k) \isom k \incl A \isom (g_* \cO_A)(\Spec k)$ is the canonical inclusion.
	Then $(g, g^\sharp) \circ (f, f^\sharp) = \id_{(\Spec k, \cO_k)}$, but $(f, f^\sharp) \circ (g, g^\sharp) \neq \id_{(\Spec A, \cO_A)}$: $f^\sharp \circ g^\sharp$ is the composite $A \surj k \incl A \neq \id_A$.
\end{example}
\begin{proposition}\label{prp:affinclleftadj}
	The inclusion $i\colon \AffSch \incl \Sch$ has a left adjoint $l\colon \Sch \to \AffSch$ given by $l((X, \cO_X)) \coloneq \Spec \Gamma(X, \cO_X)$ on objects.
	In other words, there are natural isomorphisms
	\begin{equation*}
		\AffSch(\Spec \Gamma(X, \cO_X), Y) \isom \Sch(X, Y)
	\end{equation*}
	for any scheme $X$ and affine scheme $Y$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
Here are two special cases of this:
\begin{example}
	\leavevmode
	\begin{alphanumerate}
		\item Let $(X, \cO_X)$ be any scheme.
			Since there is a unique ring map $\Z \to \Gamma(X, \cO_X)$, there is a unique morphism of schemes $X \to \Spec \Z$, i.e. $\Spec \Z$ is a terminal object of $\Sch$.
		\item If $k$ is a field and $A$ a $k$-algebra, then the inclusion $k \incl A$ corresponds to a morphism $(\Spec A, \cO_A) \to (\Spec k, \cO_k)$.
	\end{alphanumerate}
\end{example}
Next, we want to briefly discuss how to create new schemes out of old via gluing.
\begin{proposition}[{\cite[Exercise 4.4.A]{vakil_rising_2025}}]
	Suppose we are given schemes $X_i$, open subschemes $X_{ij} \subseteq X_i$ with $X_{ii} = X_i$, and isomorphisms $f_{ij}\colon X_{ij} \to X_{ji}$ with $f_{ii}$ the identity such that the \defineterm{cocycle condition} $f_{ik}|_{X_{ij} \cap X_{ik}} = f_{jk}|_{X_{ji} \cap X_{jk}} \circ f_{ij}|_{X_{ij} \cap X_{ik}}$ is satisfied for all $i, j, k$.
	Then there is a unique scheme $X$ along with open subschemes isomorphic to the $X_i$ respecting the gluing data in the obvious sense.
\end{proposition}
\begin{proof}
	TODO (maybe?)
\end{proof}
\begin{example}
	Let $k$ be a field and let $X_1 = X_2 = \A^1_k$ and $U_1 = U_2 = \A^1_k \setminus \{0\} = \Spec(k[x]_x)$. 
	There are two interesting choices of morphism $(\phi, \phi^\sharp)\colon (U_1, \cO_{U_1}) \to (U_2, \cO_{U_2})$:
	\begin{alphanumerate}
		\item $(\phi, \phi^\sharp) = \id_{(U_1, \cO_{U_1})}$.
			In this case we obtain the \defineterm{affine line with two origins}.
		\item $(\phi, \phi^\sharp)$ is given by the ring isomorphism $k[x]_x \to k[x]_x$, $x \mapsto 1 / x$.
			In this case we obtain the \defineterm{projective line} $\P^1_k$ over the field $k$.
			% TODO pictures?
	\end{alphanumerate}
\end{example}
To make sense of this second example, assume that $k$ is algebraically closed and only consider maximal ideals.
Then $\phi^{-1}((x - t)) = (x - 1 / t)$, so $\P^1_k$ identifies with $k^2 \setminus \{0\} / k^\times$, points of which we write as $[t_1 : t_2]$ (these are the familiar homogeneous coordinates).

\subsection{Properties of Schemes}
We start out by listing some topological properties of schemes, i.e. properties that apply to the underlying space.
\begin{definition}
	Let $X = (X, \cO_X)$ be a scheme.
	\begin{alphanumerate}
		\item $X$ is \defineterm[scheme!connected]{connected} if $X$ is, i.e. if $X$ cannot be decomposed as the union of two disjoint proper non-empty subsets.
		\item $X$ is \defineterm[scheme!irreducible]{irreducible} if $X$ is, i.e. if $X$ cannot be written as the union of two proper closed subsets (not necessarily disjoint).
			Equivalently, $X$ is irreducible iff every open subset of $X$ is dense in $X$ iff any two non-empty open subsets of $X$ have non-empty intersection.
		\item $X$ is \defineterm[scheme!quasicompact]{quasicompact} if $X$ is, i.e. if any open cover of $X$ admits a finite subcover.
	\end{alphanumerate}
\end{definition}
Note that $X$ being irreducible implies $X$ is connected, but not vice-versa:
For any field $k$, the scheme $\Spec k[x_1, x_2] / (x_1 x_2)$ is connected but at the same time union $\Spec k[x_1, x_2] / (x_1) \cup \Spec k[x_1, x_2] / (x_2)$ of proper closed subsets and therefore reducible.
\begin{figure}[ht]
	\centering
	\begin{tikzpicture}[thick, scale = 2]
		\draw (-1, 0) -- (1, 0) node[below] {$x_1$};
		\draw (0, -1) -- (0, 1) node[left] {$x_2$};
	\end{tikzpicture}
	\caption{The scheme $\Spec k[x_1, x_2] / (x_1 x_2)$.}
\end{figure}
\begin{remark}
	If $X$ is quasicompact, then any closed subspace of $X$, too, is quasicompact.
	The same is not true for open subspaces in general.
\end{remark}
\begin{example}
	For every ring $A$, $\Spec A$ is quasicompact.
	% TODO put proof here or in appendix?
\end{example}
We will also need a few properties that are scheme-theoretic in nature:
\begin{definition}
	Let $X = (X, \cO_X)$ be a scheme.
	\begin{alphanumerate}
		\item $X$ is \defineterm[scheme!locally Noetherian]{locally Noetherian} if it admits an affine cover $X = \bigcup_{i \in I} \Spec A_i$ such that $A_i$ is a Noetherian ring.
		\item $X$ is \defineterm[scheme!Noetherian]{Noetherian} if it is locally Noetherian and quasi-compact.
		\item $X$ is \defineterm[scheme!reduced]{reduced} if $\Gamma(U, \cO_X)$ is a reduced ring for all $U \subseteq X$ open.
		\item $X$ is \defineterm[scheme!integral]{integral} if $\Gamma(U, \cO_X)$ is an integral domain for all $U \subseteq X$ open.	
	\end{alphanumerate}
\end{definition}
% TODO put that here
By exercise 28, $X$ being reduced is equivalent to all the stalks $\cO_{X, x}$ of $X$ being reduced rings.
The analogous statement for $X$ being integral is false, however: 
Although it holds that $X$ being integral implies all its stalks being integral, there are non-integral schemes with integral stalks, e.g. $\Spec k \sqcup \Spec k$ for $k$ a field.
Note also that integral implies reduced but not vice-versa: 
Take for instance $\Spec k[x_1, x_2] / (x_1 x_2)$.
Note also that open subset of an irreducible space are again irreducible.
\begin{proposition}\label{prp:intiffirredred}
	A scheme $(X, \cO_X)$ is integral iff it is irreducible and reduced.
\end{proposition}
Before the proof, let us prove a quick lemma.
\begin{lemma}
	Let $(X, \cO_X)$ be any scheme, $U \subseteq X$ an open subset, and $s \in \Gamma(U, \cO_X)$ a section.
	Then the set $\{x \in U \mid s_x \in \ideal{m}_x\} \subseteq U$ is closed in $U$, where $\ideal{m}_x \subset \cO_{X, x}$ is the maximal ideal.
\end{lemma}
\begin{proof}
	Write $I_s \coloneq \{x \in U \mid s_x \notin \ideal{m}_x\}$.
	We will show that $I_s$ is open in $U$.
	To that end, note that $s_x \notin \ideal{m}_x$ is to say that $s_x$ is a unit since $\cO_{X, x}$ is local.
	If $s_x^{-1} \in \cO_{X, x}$ is its inverse, then by definition of the stalk we find sections $s_V, s_V^{-1} \in \cO_X(V)$ on some open neighborhood $x \in V \subseteq U$ representing $s_x$ and $s_x^{-1}$, respectively, but then in particular we have that $s_V s_V^{-1} = 1$.
	Noting that we may take $s_V = s|_V$ we find that $s_y \notin \ideal{m}_y$ for all $y \in V$.
	In other words, $I_s$ contains an open neighborhood around each of its points and must therefore be open.
\end{proof}
\begin{proof}[Proof of \cref{prp:intiffirredred}]
	If $(X, \cO_X)$ is integral then it is reduced.
	If $X$ was not irreducible, then we could find non-empty proper open subsets $U_1, U_2 \subset X$ with $U_1 \cap U_2 = \emptyset$.
	But this implies $\Gamma(U_1 \cup U_2, \cO_X) = \Gamma(U_1, \cO_X) \times \Gamma(U_2, \cO_X)$ which is not an integral domain, contradiction.

	Conversely, assume $(X, \cO_X)$ is irreducible and reduced and let $s_1, s_2 \in \Gamma(U, \cO_X)$ be sections over some open $U \subseteq X$ with $s_1 s_2 = 0$.
	By the previous lemma, the two sets $X_i \coloneq \{x \in U \mid s_{i, x} \in \ideal{m}_x\}	\subseteq U$ ($i = 1, 2$) are closed.
	But if $0 = (s_1 s_2)_x = s_{1, x} s_{2, x}$, then we must have $s_{1, x} \in \ideal{m}_x$ or $s_{2, x} \in \ideal{m}_x$ for each $x \in U$ since $\ideal{m}_x$ is in particular a prime ideal, and this implies that $X_1 \cup X_2 = U$.
	But $X$ is irreducible, so $U$, too, is irreducible, so without loss of generality we may assume that $X_1 = U$.
	Let $\Spec A \subseteq U$ be an open affine subscheme and define $t\coloneq s_1|_{\Spec A}$.
	We then in particular have $t_x \in \ideal{m}_x$ for all $x \in \Spec A$, but unraveling the definitions this is to say that $t / 1 \in \ideal{p} A_{\ideal{p}}$ for all $\ideal{p} \in \Spec A$, so $t \in \ideal{p}$ for all $\ideal{p} \in \Spec A$, which is to say that $\ideal{p} \in \Nil A$ and therefore that $t = 0$ since $X$ and therefore $A$ is reduced.
	Thus $s_1|_{\Spec A} = 0$, so covering $U$ with affine schemes we find that $s_1 = 0$ altogether.
\end{proof}
\begin{corollary}
	If $X$ is an integral scheme, then there exists a unique \defineterm{generic point} $\eta \in X$, i.e. a point whose closure is the whole space $X$.
\end{corollary}
\begin{proof}
	Pick an affine subscheme $\Spec A \subseteq X$ and define $\eta \coloneq (0) \in \Spec A$.
	Then $\close{\{\eta\}} = \Spec A$ and by irreducibility we must already have $\close{\{\eta\}} = X$, seeing as $\Spec A$ is dense in $X$.

	It remains to show that $\eta$ is unique.
	Let thus $\eta' \in X$ be another generic point and pick an affine subscheme $\Spec A \subseteq X$ containing $\eta$.
	Since $X \setminus \Spec A$ is closed and $\close{\{\eta'\}} = X$, we must then have $\eta' \in \Spec A$.
	Assuming without loss of generality that $\eta = (0) \in \Spec A$ and identifying $\eta'$ with some prime ideal $\ideal{p} \in \Spec A$, we have $\eta \in V(\ideal{p})$, but this means $\ideal{p} = (0)$, so $\eta = \eta'$.
\end{proof}
We now come back to Noetherianness.
By definition, a scheme is locally Noetherian if it admits a cover by affine subschemes of Noetherian rings.
It is natural to ask (and to expect true) whether this already implies that any affine subscheme is one of Noetherian rings, and indeed the answer is yes, even though the proof is somewhat tedious.
\begin{proposition}
	A scheme $X$ is locally Noetherian iff for any open affine subscheme $\Spec A \subseteq X$, the ring $A$ is Noetherian.
\end{proposition}
% TODO split this proof up into multiple lemmas
\begin{proof}
	One direction of the proof is true by definition.
	Let thus $X$ be a locally Noetherian scheme and pick a cover $X = \bigcup_{i \in I} \Spec A_i$ with the $A_i$ Noetherian.
	Let $U = \Spec A \subseteq X$ be another open, affine subscheme, and let $U_i \coloneq \Spec A_i \cap U$ such that $U = \bigcup_{i \in I} U_i$.
	Since $U$ is affine, it is quasicompact, so we may reduce to a finite covering $U = \bigcup_{i = 1}^n U_i$.
	Now $U_i \subseteq \Spec A_i$ is open, so we may cover it with finitely many distinguished opens $U_i = \bigcup_{j = 1}^{k_i} \Spec A_{i, a_j}$.
	Fixing one $B \coloneq A_{i, a_j}$, we can find an element $a \in A$ such that $\Spec A_a \subseteq \Spec B$, which gives rise to a commutative diagram
	\begin{equation*}
		\begin{tikzcd}
			A 
					\ar[r]
					\ar[dr]
				& B
					\ar[d]
			\\
				& A_a
		\end{tikzcd}
	\end{equation*}
	Let $b \in B$ be the image of $a$ under the top map.
	We now claim that $\Spec A_a = \Spec B_b$ as sets, but this is clear: 
	For any prime ideal $\ideal{q} \in \Spec B$, we have $b \notin \ideal{q}$ iff $a \notin \ideal{p} \coloneq \ideal{q}^c$.
	
	More importantly, however, we also have $\Spec A_a = \Spec B_b$ \emph{as schemes}.
	To this end, we have to show that we have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
				& B
					\ar[dl]
					\ar[dr]
			\\
			A_a 
					\ar[rr, "\isom"]
				& & B_b
		\end{tikzcd}
	\end{equation*}
	But we already know that $\cO_A|_{\Spec B} \isom \cO_B$, so further restriction yields 
	\begin{equation*}
		\cO_{A_a} \isom \cO_A|_{\Spec A_a} \isom \cO_B|_{\Spec B_b} \isom \cO_{B_b}
	\end{equation*}
	so taking sections yields the claim.

	Next, we show that any ideal $\ideal{a} \subseteq A$ can be written as $\ideal{a} = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}) A_{a_i})$ where $\pi_i\colon A \to A_{a_i}$ are the canonical maps.
	Clearly $\ideal{a}$ is contained in the intersection.
	On the other hand, if $b \in \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}) A_{a_i})$ is any element, then we can write each $\pi_i(b)$ as $\pi_i(b) = b / 1 = b_i / a_i^{n_i}$ for some $b_i \in \ideal{a}$.
	Since $b_i / a_i^{n_i} = (a_i b_i) / a_i^{n_i + 1}$ and $a_i b_i \in \ideal{a}$, we may in fact assume that $\pi_i(b) = b_i / a_i^m$ for some fixed $m$ independent of $i$.
	We then find $m_1, \ldots, m_i \in \N$ such that $(b_i - a_i^m b) a_i^{m_i} = 0$ for all $i$, and setting $M \coloneq \max \{m_1, \ldots, m_n\}$ we obtain $(b_i - a_i^m b) a_i^M = 0$.
	But this is to say that $a_i^{m + M} b \in \ideal{a}$, so since $\Spec A = \bigcup_{i = 1}^n \Spec A_{a_i}$, which is the same as saying that $\bigcap_{i = 1}^n V(a_i) = V(a_1, \ldots, a_n) = \emptyset$, we see that we must have $(a_1, \ldots, a_n) = (1)$, which in turn is the case iff $(a_1^k, \ldots, a_n^k) = (1)$ for any $k > 0$.
	Applying this to $k = m + M$, we obtain that 1 can be expressed as a linear combination
	\begin{equation*}
		1 = \sum_{i = 1}^n \beta_i a_i^k
	\end{equation*}
	for some $\beta_i \in A$ and multiplying both sides with $b$ then yields
	\begin{equation*}
		b = \sum_{i = 1}^n \beta_i \underbrace{a_i^k b}_{\in \ideal{a}}
	\end{equation*}
	so $b \in \ideal{a}$, as we set out to show.

	To finish up the proof, let $\ideal{a}_1 \subseteq \ideal{a}_2 \subseteq \ldots$ be an ascending chain of ideals of $A$.
	We then obtain ascending chains $\pi_i(\ideal{a}_1) A_{a_i} \subseteq \pi_i(\ideal{a}_2) A_{a_i} \subseteq \ldots$ of ideals of $A_{a_i}$ for all $i = 1, \ldots, n$.
	But the $A_{a_i}$ are Noetherian, so for each there exists some $N_i > 0$ with $\pi_i(\ideal{a}_{N_i}) A_{a_i} = \pi_i(\ideal{a}_{N_i + 1}) A_{a_i} = \ldots$.
	Then putting $N \coloneq \max \{N_1, \ldots, N_n\}$, we find that $\pi_i(\ideal{a}_N) A_{a_i} = \pi_i(\ideal{a}_{N + 1}) A_{a_i} = \ldots$ for all $i$, so 
	\begin{equation*}
		\ideal{a}_N = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}_N) A_{a_i}) = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}_{N + 1}) A_{a_i}) = \ideal{a}_{N + 1} = \ldots
	\end{equation*}
	so $A$ is Noetherian.
\end{proof}

\subsection{Open and Closed Subschemes}
Recall that if $U \subseteq X$ is an open subset of a scheme $(X, \cO_X)$, then $(U, \cO_X|_U)$ is an open subscheme of $X$ (in particular it is again a scheme).
\begin{remark}
	If $\Spec B \subseteq \Spec A$ is an open affine subscheme of an affine scheme, then $\Spec B = \bigcup_{i = 1}^n \Spec A_{a_i}$ for suitable $a_1, \ldots, a_n \in A$.
	If $b_i$ is the image of $a_i$ under the associated ring homomorphism $A \to B$, then $\Spec A_{a_i} = \Spec B_{b_i}$ (this we showed in the proof of the preceding proposition).
\end{remark}
\begin{remark}
	An open subscheme of an affine scheme need not again be affine.
	For instance, $\A^n_k \setminus \{0\} \subset \A^n_k$ is open but not affine if $n \geq 2$ for any field $k$.

	Why is this the case? Let us consider what happens for $n = 2$.
	To see this, note that we have $\A^2_k \setminus \{0\} = D(x_1) \cup D(x_2)$.
	Since all rings involved are integral, the restriction maps to $D(x_1)$, $D(x_2)$, and $D(x_1) \cap D(x_2) = D(x_1 x_2)$ are all injective, so $\Gamma\big(U, \cO_{\A^2_k}\big)$ consists of pairs of functions $f \in \Gamma\big(D(x_1), \cO_{\A^2_k}\big) = k[x_1, x_2, x_1^{-1}]$ and $g \in \Gamma\big(D(x_2), \cO_{\A^2_k}\big) = k[x_1, x_2, x_2^{-1}]$ agreeing when restricted to $\Gamma(D(x_1 x_2), \cO_{\A^n_k}) = k[x_1, x_2, (x_1 x_2)^{-1}]$.
	Thus $f$ and $g$ must be polynomials, so $\Gamma\big(U, \cO_{\A^2_k}\big) = k[x_1, x_2]$.

	In other words, if $U$ was affine we would have to have $U \isom \A^2_k$ again.
	But note that $V(x_1) \cap V(x_2) = V(x_1, x_2) = \emptyset$ in $U$, contradicting the fact that we should have $I(V(x_1, x_2)) = (x_1, x_2)$.
\end{remark}
Closed subschemes are not quite as straightforward.
In fact, we can give two separate definitions which will turn out to agree.
\begin{definition}
	A \defineterm{closed subscheme} of a scheme $(X, \cO_X)$ is an equivalence class of morphisms of schemes $(i, i^\sharp)\colon (Z, \cO_Z) \to (X, \cO_X)$ such that $i\colon Z \incl X$ is a closed embedding and $i^\sharp\colon \cO_X \to i_* \cO_Z$ is a surjection, where $(i, i^\sharp)$ is equivalent to $(i', i'^\sharp)\colon (Z', \cO_{Z'}) \to (X, \cO_X)$ if there is a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
			(Z, \cO_Z)
					\ar[rr, "\isom"]
					\ar[dr]
				& & (Z', \cO_{Z'})
					\ar[dl]
			\\
				& (X, \cO_X)
		\end{tikzcd}
	\end{equation*}
	with the top map an isomorphism.
\end{definition}
\begin{definition}
	A \defineterm{closed subscheme} of a scheme $(X, \cO_X)$ consists of a closed subset $i\colon Z \incl X$ and structure sheaf $\cO_Z$ such that $(Z, \cO_Z)$ is a scheme, together with a sheaf of ideals $\theta_Z \subseteq \cO_X$ such that $\cO_X / \theta_Z \isom i_* \cO_Z$ (here the quotient is a quotient of sheaves).
\end{definition}
\begin{proposition}
	Let $A$ be a ring.
	Then there exists a natural bijection
	\begin{equation*}
		\{\ideal{a} \subseteq A \text{ ideal}\} \leftrightarrow \{Z \subseteq \Spec A \text{ closed subscheme}\}
	\end{equation*}
\end{proposition}
\begin{proof}
	Given an ideal $\ideal{a} \subseteq A$, consider $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) \subseteq (\Spec A, \cO_A)$.
	Then $\Spec A / \ideal{a} = V(\ideal{a}) \subseteq \Spec A$ is closed and the map $\cO_A \surj i_* \cO_{A / \ideal{a}}$ surjective since for all prime ideals $\ideal{p} \in \Spec A$ containing $\ideal{a}$, the map $A_{\ideal{p}} \surj (A / \ideal{a})_{\ideal{p}} = A_{\ideal{p}} / \ideal{a} A_{\ideal{p}}$ is.
	Conversely, if $(Z, \cO_Z) \subseteq (\Spec A, \cO_A)$ is a closed subscheme, we obtain an ideal $\ideal{a} \coloneq \ker(\Gamma(\Spec A, \cO_A) \to \Gamma(Z, \cO_Z))$.

	We now have to show these two constructions are mutually inverse to each other.
	One direction is easy: 
	Starting with an ideal $\ideal{a} \subseteq A$, we have 
	\begin{equation*}
		\ideal{a}_{\Spec A / \ideal{a}} = \ker\big(\underbrace{\Gamma(\Spec A, \cO_A)}_{= A} \to \underbrace{\Gamma(\Spec A / \ideal{a}, \cO_{A / \ideal{a}})}_{= A / \ideal{a}}\big) = \ideal{a}
	\end{equation*}
	On the other hand, if we start out with a closed subscheme $(Z, \cO_Z) \incl (\Spec A, \cO_A)$, we obtain an ideal $\ideal{a}_Z \coloneq \ker(\Gamma(\Spec Z, \cO_Z) \to \Gamma(\Spec A, \cO_A))$, and from this the closed subscheme $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) \incl (\Spec A, \cO_A)$.
	As a first step to showing $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) = (Z, \cO_Z)$, we will show that $Z \subseteq V(\ideal{a})$ as sets.
	Suppose there exists some prime ideal $\ideal{p} \in Z \setminus V(\ideal{a}_Z)$, i.e. $\ideal{p} \in Z$ but $\ideal{a}_Z \nsubseteq \ideal{p}$.
	There is then some $a \in \ideal{a}_Z$ with $a \notin \ideal{p}$.
	We then have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[sep = large]
			\textcolor{darkgray}{a} 
					\ar[rrr, mapsto, darkgray]
					\ar[ddd, mapsto, darkgray]
				&[-3.2em] & &[-3.2em] \textcolor{darkgray}{0}
					\ar[ddd, mapsto, darkgray]
			\\[-2.5em]
				& A
					\ar[r]
					\ar[d]
				& \Gamma(Z, \cO_Z)
					\ar[d]
			\\
				& A_{\ideal{p}}
					\ar[r]
				& \cO_{Z, \ideal{p}}
			\\[-2.5em]
			\textcolor{darkgray}{a_{\ideal{p}}}
					\ar[rrr, mapsto, darkgray]
				& & & \textcolor{darkgray}{0}
		\end{tikzcd}
	\end{equation*}
	But $a_{\ideal{p}}$ must lie in $A_{\ideal{p}}^*$ since $a \notin \ideal{p}$ and therefore get mapped to a unit of $\cO_{Z, \ideal{p}}$, contradiction.
	Hence $Z \subseteq V(\ideal{a})$.

	Consider now the inclusion $j\colon \Spec A / \ideal{a}_Z \incl \Spec A$ and the induced map $j^\sharp\colon \cO_A \to j_* \cO_{A / \ideal{a}_Z}$.
	We get an induced map $g\colon j_* \cO_{A / \ideal{a}_Z} \to i_* \cO_Z$ making the diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
			\cO_A 
					\ar[rr, two heads, "j^\sharp"]
					\ar[dr, two heads, swap, "i^\sharp"]
				& & j_* \cO_{A / \ideal{a}_Z}
					\ar[dl, "g"]
			\\
				& i_* \cO_Z
		\end{tikzcd}
	\end{equation*}
	commute iff the restriction $i^\sharp|_{\ker j^\sharp}$ is trivial.
	This condition we can check on stalks.
	But for $\ideal{p} \in Z$, $j^\sharp_{\ideal{p}}$ is the quotient map $\cO_{A, \ideal{p}} = A_{\ideal{p}} \surj A_{\ideal{p}} / \ideal{a}_Z A_{\ideal{p}} = \cO_{A / \ideal{a}_Z, \ideal{p}}$ so $\ker j^\sharp_{\ideal{p}} = \ideal{a}_Z A_{\ideal{p}}$, and $i^\sharp|_{\ideal{a}_Z A_{\ideal{p}}} = 0$, so $g$ exists.
	Note also that $g$ is surjective since $j^\sharp$ and $i^\sharp$ are.
	We may thus assume that $(\Spec A, \cO_Z) = (\Spec A / \ideal{a}_Z, \cO_{A / \ideal{a}_Z})$.
	%We may thus replace the inclusion $(Z, \cO_Z) \incl (\Spec A, \cO_A)$ by $(Z, \cO_Z) \incl (\Spec A / \ideal{a}_Z, \cO_{A / \ideal{a}_Z})$.
	% and assume without loss of generality that $A = \Gamma(\Spec A, \cO_A)

	We now show that $Z = \Spec A$ as schemes.
	Since $Z \subset \Spec A$ is closed, there are elements $\{a_i \in A \mid i \in I\}$ where $I$ is some index set such that $Z = V((a_i)_{i \in I})$.
	Pick some $a = a_i$.
	Since $\Spec A$ is quasi-compact and $Z \subseteq \Spec A$ is closed, it, too, is quasi-compact and can therefore be covered with finitely many open affine subschemes $Z = \bigcup_{j = 1}^n \Spec B_i$.
	The maps $A \incl \Gamma(Z, \cO_Z) \to \cO_Z(\Spec B_i) = B_i$ take the element $a$ to $b_i$, so since $\Spec B_i \subseteq Z \subseteq V(a)$, we find that all prime ideals $\ideal{p} \in \Spec B_i$ must contain $b_i$, i.e. $b_i$ is nilpotent.

	TODO: Complete proof.
\end{proof}

\section{Fibre Products}
\begin{definition}
	Fix a scheme $S \in \Sch$.
	In this section, we will consider \defineterm[S-scheme@$S$-scheme]{$S$-schemes}, i.e. elements of the slice category $\Sch_{/ S}$ of schemes over $S$.

	When $S = \Spec k$ for $k$ a field, we will simply speak of $k$-schemes and write $\Sch_{/ k} \coloneq \Sch_{/ \Spec k}$.
\end{definition}
Note that $\Sch_{/ \Spec \Z} \isom \Sch$ since $\Spec \Z$ is terminal in $\Sch$.

In this section we will be interested in studying products in $\Sch_{/ S}$, or equivalently pullbacks (or \defineterm[fibre product]{fibre products}) in $\Sch$.

As a first step, let us treat the case that all involved schemes are affine.
\begin{proposition}
	The inclusion $\AffSch \incl \Sch$ preserves arbitrary limits, in particular pullbacks.
	Moreover $\AffSch$ has all pullbacks, and the pullback of a cospan $\Spec A \rightarrow \Spec C \leftarrow \Spec B$ in $\AffSch$ is given by $\Spec A \tensor_C B$.
\end{proposition}
\begin{proof}
	The first statement is an immediate consequence of the fact that the inclusion admits a left adjoint, see \cref{prp:affinclleftadj}.
	The second follows from the equivalence $\AffSch \simeq \op{\CRing}$ of \cref{prp:sch:ringaff}.
\end{proof}
Before moving on to the general proof, let us discuss some applications and properties.
\begin{remark}
	Let $X$ be an $S$-scheme, $Z$ a $T$-scheme, and $Y$ both an $S$- and $T$-scheme.
	As for pullbacks in any category, $X \times_S Y$ is unique up to unique isomorphism.
	Also, there is a unique isomorphism $(X \times_S Y) \times_T Z \isom X \times_S (Y \times_T Z)$ which commutes with the structure maps.
\end{remark}
\begin{example}
	Let $k$ be a field.
	We will usually write $X \times_k Y$ in place of $X \times_{\Spec k} Y$ for $X, Y$ two $k$-schemes.
	Then we have $\A^n_k \times_k \A^m_k \isom \A^{n + m}_k$, seeing as $k[x_1, \ldots, x_n] \tensor_k k[y_1, \ldots, y_m] \isom k[x_1, \ldots, x_n, y_1, \ldots, y_m]$.

	Importantly, note, however, that $|\A^n_k \times_k \A^m_k| \neq |\A^n_k| \times |\A^m_k|$ in general (take $n = m = 1$).
\end{example}
\begin{example}\label{epl:sch:fpR}
	Let $X = Y = \Spec \C$ considered as $\R$-schemes.
	Then
	\begin{align*}
		X \times_\R Y &= \Spec \C \tensor_\R \C \\
					  &\isom \Spec \R[x] / (x^2 + 1) \tensor_\R \C \\
					  &\isom \Spec \C[x] / (x^2 + 1) \\
					  &\isom \Spec \C[x] / (x + i)(x - 1) \\
					  &\isom \Spec \C \times \C
	\end{align*}
	thus $|X \times_\R Y|$ has exactly two points while $|X| \times |Y|$ has one.
	In particular, there is no obvious natural map $|X| \times |Y| \to |X \times_\R Y|$ one could write down!
\end{example}
\begin{definition}
	Let $Y$ be a scheme, $y \in Y$ a point, and define the \defineterm{residue field} $k(y) \coloneq \cO_{Y, y} / \ideal{m}_y$ of $y$ where $\ideal{m}_y \subset \cO_{Y, y}$ is the maximal ideal.
	We then have a morphism of schemes $\Spec k(y) \to Y$ taking the unique point of $\Spec k(y)$ to $y$ and on structure sheaves being given by the composite 
	\begin{equation*}
		\cO_Y \to \cO_{Y, y} \surj k(y) \isom i_* \cO_{k(y)}
	\end{equation*}
	Let now $f\colon X \to Y$ be a morphism of schemes.
	The \defineterm{fibre} of $f$ over $y$ is the fibre product
	\begin{equation}\label{diag:sch:fibre}
		\begin{tikzcd}
			X_y \coloneq X \times_Y \Spec k(y) 
					\ar[r]
					\ar[d, swap, "p"]
				& \Spec k(y)
					\ar[d]
			\\
			X
					\ar[r, "f"]
				& Y
		\end{tikzcd}
	\end{equation}
\end{definition}
\begin{definition}
	If $Y$ is an integral scheme, then it has a unique generic point $\eta \in Y$.
	If $f\colon X \to Y$ is a morphism of schemes, we define the \defineterm{generic fibre} $X_\eta$ of $f$ to be that over $\eta$.
	Similarly, a \defineterm{closed fibre} of $f$ is any fibre over a closed point $y \in Y$.
\end{definition}
\begin{example}
	If $A$ is a DVR, then $\Spec A$ consists of exactly two points: $\eta = (0)$ and $t = \ideal{m}$ where $\ideal{m} \subset A$ is the maximal ideal.
	A morphism $f\colon X \to \Spec A$ thus has exactly two fibres: one closed and one generic.
	By definition, these come with morphisms
	\begin{align*}
		X_\eta &\to \Spec k(\eta) = \Spec Q(A) \;\;\text{and}\\
		X_t &\to \Spec k(t) = \Spec A / \ideal{m}
	\end{align*}
	As a concrete example, consider $A = \Z_{(p)}$ for some prime $p$.
	Then $k(t) = \F_p$ and $k(\eta) = \Q$, so $X_\eta$ is a scheme over $\Q$ and $X_t$ is a scheme over $\F_p$.
	Note in particular that the two residue fields have different characteristics.

	On the other hand, if $A = k\llbracket x\rrbracket$, then $k(\eta) = k((x))$ and $k(t) = k$ which are of the same characteristic.
\end{example}
We will now prove the existence of fibre products.
\begin{proposition}
	$\Sch$ admits all fibre products.
\end{proposition}
\begin{proof}
	TODO.
\end{proof}
We now resume talking about fibres.
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then there is a homeomorphism from $|X_y|$ to $f^{-1}(y)$ for any point $y \in Y$.
\end{proposition}
\begin{proof}
	The commutativity of diagram \eqref{diag:sch:fibre} implies that the image of $p$ lands in $f^{-1}(y)$, so we have a continuous map $g \coloneq |p|\colon |X_y| \to f^{-1}(y)$.
	To see that $g$ is surjective, pick any element $x \in f^{-1}(y)$ and consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(x)
					\ar[dr, dashed, "\exists!"]
					\ar[drr, bend left = 20, "\Spec \phi"]
					\ar[ddr, bend right = 20]
			\\[-1em]
				&[-2.2em] X_y
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& \Spec k(y) 
					\ar[d]
			\\
				& X
					\ar[r, swap, "f"]
				& Y
		\end{tikzcd}
	\end{equation*}
	where $\phi$ is the induced map on residue fields
	\begin{equation*}
		\begin{tikzcd}
			\cO_{Y, y} 
					\ar[r, "f^\sharp"]
					\ar[d, two heads]
				& \cO_{X, x}
					\ar[d, two heads]
			\\
			k(y)
					\ar[r, dashed, swap, "\phi"]
				& k(x)
		\end{tikzcd}
	\end{equation*}
	using that $f^\sharp$ is local.
	Thus $x \in \img g$.

	For injectivity, we may without loss of generality assume that $X = \Spec B$ and $Y = \Spec A$ so that $y$ corresponds to some prime ideal $\ideal{p} \in \Spec A$ and $X_y = \Spec k(Y) \tensor_A B$.
	Seeing as $k(y) = A_{\ideal{p}} / \ideal{p} A_{\ideal{p}}$ in this case, we have $X_y = \Spec S^{-1} B / \ideal{p} B$ where $S = A \setminus \ideal{p}$.
	Then 
	\begin{align*}
		|X_y| &= \{\ideal{q} \in \Spec B \mid \underbrace{\ideal{p} B \subseteq \ideal{q}}_{\Leftrightarrow \ideal{p} \subseteq \ideal{q}^c} \text{ and } \ideal{q}^c \cap S = \emptyset\} \\
			  &= \{\ideal{q} \in \Spec B \mid \ideal{q}^c \subseteq \ideal{p}\} \\
			  &= f^{-1}(y)
	\end{align*}
	so $g$ is injective.

	% TODO explain this better!
	Finally, to see that $g^{-1}\colon f^{-1}(y) \to |X_y|$ is continuous, we note that we have a basis for the topology on $X_y$ consisting of sets of the form $D(b / s)$ with $b / s \in S^{-1} B$, i.e. they are of the form $D(b) \cap f^{-1}(y)$.
\end{proof}

\subsection{Base Change}
Let $\phi\colon R \to S$ be a morphism of schemes.
We define a functor $\Sch_{/ S} \to \Sch_{/ R}$, $(X \xto{f} S) \mapsto (X_R \xto{g} R)$ through the pullback diagram
\begin{equation*}
	\begin{tikzcd}
		X_R \coloneq X \times_S R
				\ar[r]
				\ar[d, swap, "g"]
				\ar[dr, phantom, "\lrcorner" very near start]
			& X
				\ar[d, "f"]
		\\
		R 
				\ar[r, swap, "\phi"]
			& S
	\end{tikzcd}
\end{equation*}
on objects.
If $\alpha\colon X \to Y$ is a morphism of $S$-schemes, we then define $\alpha_R\colon X_R \to Y_R$ via the commutative cube
\begin{equation*}
	\begin{tikzcd}
		X_R
				\ar[rr]
				\ar[dd, swap, "g"]
				\ar[dr, dashed, swap, "\alpha_R"]
			& & X
				\ar[dd, swap, "f\;" near start]
				\ar[dr, "\alpha"]
		\\
			& Y_R
				\ar[rr, crossing over]
			& & Y
				\ar[dd]
		\\
		R 
				\ar[rr, "\phi" near end]
				\ar[dr, equals]
			& & S
				\ar[dr, equals]
		\\
			& R 
				\ar[rr, "\phi"]
				\ar[from = uu, crossing over]
			& & S
	\end{tikzcd}
\end{equation*}
induced by the universal property of the pullback.
It is easy to check that this in fact defines a functor.
\begin{definition}
	Let $K / k$ be a field extension and $X$ a $k$-scheme.
	We define the set of \defineterm[K-rational point@$K$-rational point]{$K$-rational points} $X(K)$ of $X$ to be
	\begin{equation*}
		X(K) \coloneq \Sch_{/ k}(\Spec K, X)
	\end{equation*}
\end{definition}
% TODO something about Galois groups?
Observe that there is a bijection between $X(K)$ and the $K$-rational points $X_K(K)$ of the base change along $\Spec K \to \Spec k$:
This follows from the universal property of the pushout in the diagram
\begin{equation*}
	\begin{tikzcd}
		\Spec K
				\ar[dr, dashed, "\exists!"]
				\ar[drr, bend left = 20]
				\ar[ddr, equals, bend right = 18]
		\\[-1em]
			&[-2.2em] X_K
				\ar[r]
				\ar[d]
				\ar[dr, phantom, "\lrcorner" very near start]
			& X
				\ar[d]
		\\
			& \Spec K 
				\ar[r]
			& \Spec k
	\end{tikzcd}
\end{equation*}
We can combine this with our discussion of fibres:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes, let $y \in Y$ be a point with residue field $k(y)$, and fix an algebraic closure $\close{k(y)}$ of $k(y)$.
	The \defineterm[fibre!geometric]{geometric fibre} $X_{\close{y}}$ of $X$ over $y$ is defined by the pullback
	\begin{equation*}
		\begin{tikzcd}
			X_{\close{y}}
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X_y
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X
					\ar[d]
			\\
			\Spec \close{k(y)}
					\ar[r]
				& \Spec k(y)
					\ar[r]
				& Y
		\end{tikzcd}
	\end{equation*}
\end{definition}
Note that by pullback pasting the outer rectangle is also a pullback square.
\begin{example}
	Fix a field $k$ and an algebraic closure $\close{k}$ of $k$ and consider the $k$-scheme $\A^n_k$.
	Since $\A^n_k$ is already the fibre of the unique morphism $\A^n_k \to \Spec k = \{(0)\}$, its geometric fibre is given by
	\begin{equation*}
		\begin{tikzcd}
			\mathllap{(\A^n_k)_{\close{(0)}} =\ } \A^n_{\close{k}} 
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& \A^n_k
					\ar[d]
			\\
			\Spec \close{k}
					\ar[r]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
	(note that $k[x_1, \ldots, x_n] \tensor_k \close{k} \isom \close{k}[x_1, \ldots, x_n]$).
	In particular, note that $\A^1_k = \{(0)\} \cup \{(f) \mid f \in k[x] \text{ irreducible}\}$ whereas $\A^1_{\close{k}} = \{0\} \cup \{(x - \lambda) \mid \lambda \in \close{k}\} \leftrightarrow \{(0)\} \cup \close{k}$: 
	Unless $k = \close{k}$ already, the geometric fibre has fewer points than the ordinary fibre.
\end{example}
\begin{example}
	Let $k$ be a field and $\close{k}$ an algebraic closure of $k$.
	Then the $\close{k}$-rational points of $\A^n_k$ are in bijection with $\close{k}^n$ for any $n$ since we have
	\begin{align*}
		\A^n_k(\close{k}) &= \A^n_{\close{k}}(\close{k}) \\
						  &= \Sch_{/ \close{k}}\big(\Spec \close{k}, \A^n_{\close{k}}\big) \\
						  &= \Sch\big(\Spec \close{k}, \A^n_{\close{k}}\big) \\
						  &\isom \CRing\big(\close{k}[x_1, \ldots, x_n], \close{k}\big) \\
						  &\leftrightarrow \close{k}^n
	\end{align*}
\end{example}
\begin{example}
	Consider an $\Z_{(p)}$-scheme $X \to \Spec \Z_{(p)}$ for some prime number $p$.
	Then $\Spec \Z_{(p)} = \{\eta = (0), t = (p)\}$, so we have two fibres $X_\eta \to \Spec k(\eta) = \Spec \Q$ and $X_t \to \Spec k(t) = \Spec \F_p$ and therefore also two geometric fibres $X_{\close{\eta}} \to \Spec \close{\Q}$ and $X_{\close{t}} \to \Spec \close{\F_p}$.
\end{example}
Two warnings are in order: 
First, note that base change does not translate to underlying spaces.
In other words, the square at the left being a pullback does not imply the square at the right is a pullback in the following diagram:
\begin{equation*}
	\begin{tikzcd}
		X_R
				\ar[r]
				\ar[d]
				\ar[dr, phantom, "\lrcorner" very near start]
			& X
				\ar[d]
		\\
		R 
				\ar[r]
			& S
	\end{tikzcd}
	\qquad\qquad
	\begin{tikzcd}
		{|X_R|}
				\ar[r]
				\ar[d]
			& {|X|}
				\ar[d]
		\\
		{|R|}
				\ar[r]
			& {|S|}
	\end{tikzcd}
\end{equation*}
Consider for instance $X = R = \Spec \C$ and $S = \Spec \R$ so that $X_R = \Spec \C \times_{\Spec \R} \Spec \C \isom \Spec \C[x] / (x + i)(x - i)$, i.e. $|X_R| = \{(x - i), (x + i)\}$ whereas $|X| \times_{|S|} |R|$ is a singleton (cf. \cref{epl:sch:fpR}).
In particular, note that connectedness is not preserved under fibre products.

The other warning concerns base change along endomorphisms.
\begin{definition}
	Let $k$ be a field and $X$ a $k$-scheme.
	Given an automorphism $\sigma \in \Aut(k)$, define the \defineterm[scheme!conjugate]{conjugate $k$-scheme} $X^\sigma$ of $X$ associated to $\sigma$ as the pullback
	\begin{equation*}
		\begin{tikzcd}
			X^\sigma
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X
					\ar[d]
			\\
			\Spec k
					\ar[r, swap, "\Spec \sigma"]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
\end{definition}
Note that $X \isom X^\sigma$ as schemes, but generally not as $k$-schemes:
\begin{example}
	Consider $X = \Spec \R$ viewed as a $\Q\big(\sqrt{2}\big)$-scheme and let $\sigma\colon \Q\big(\sqrt{2}\big) \to \Q\big(\sqrt{2}\big)$ be the automorphism sending $\sqrt{2}$ to $-\sqrt{2}$.
	Then $X^\sigma \nisom X$ as $\Q\big(\sqrt{2}\big)$-schemes:
	There is no automorphism of $\R$ taking $\sqrt{2}$ to $-\sqrt{2}$ (in fact, the only automorphism of $\R$ is the identity).
\end{example}
% TODO \P^1_C example

\section{Morphisms of Schemes}
We will now discuss a bunch of properties of morphisms of schemes.
A lot of these are going to be \enquote{reasonable,} in the following sense:
\begin{definition}[{\cite[Paragraph 8.1.1]{vakil_rising_2025}}]
	A class $\symcal{A}$ of morphisms of schemes is called \defineterm[reasonable class of morphisms]{reasonable} if it has all of the following properties:
	\begin{alphanumerate}
		\item $\symcal{A}$ is closed under composition.
		\item $\symcal{A}$ is closed under base change.
		\item\label{en:sch:localontarget} $\symcal{A}$ is \emph{local on the target}.
			This means that\textellipsis{}
			\begin{alphanumerate}
				\item for all $(f\colon X \to Y) \in \symcal{A}$ and all open subsets $V \subseteq Y$, the restriction $f|_{f^{-1}(V)}\colon f^{-1}(V) \to V$ is in $\symcal{A}$, and
				\item a morphism $f\colon X \to Y$ of schemes is in $\symcal{A}$ if there exists an open cover $Y = \bigcup_{i \in I} V_i$ of $Y$ such that $f|_{f^{-1}(V_i)} \in \symcal{A}$ for all $i \in I$.
			\end{alphanumerate}
	\end{alphanumerate}
\end{definition}
\begin{proposition}[{\cite[Exercise 8.1.A]{vakil_rising_2025}}]
	Let $\symcal{A}$ be a reasonable class of morphisms of schemes (not necessarily satisfying property \lref{en:sch:localontarget}).
	Given $(f\colon X \to Y), (g\colon X' \to Y') \in \symcal{A}$ where $X, Y, X', Y' \in \Sch_{/ S}$ for some $S \in \Sch$, then $f \times_S g\colon X \times_S X' \to Y \times_S Y'$ is in $\symcal{A}$.
\end{proposition}
\begin{proof}
	Consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			X \times_S X'
					\ar[r, "\id_X \times_S g"]
					\ar[d]
				&[1.4em] X \times_S Y'
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& X
					\ar[d]
			\\
			X' 
					\ar[r, "g"]
				& Y'
					\ar[r]
				& S
		\end{tikzcd}
	\end{equation*}
	Since the right-hand square and the outer rectangle are pullbacks, so, too, is the left-hand square, whence $\id_X \times_S g \in \symcal{A}$ since $\symcal{A}$ is closed under base change.
	By the same argument we find $f \times_S \id_{Y'} \in \symcal{A}$, so altogether $f \times_S g = (f \times_S \id_{Y'}) \circ (\id_X \times_S g) \in \symcal{A}$.
\end{proof}
\begin{definition}\label{def:sch:diagonal}
	Given a morphism $f\colon X \to Y$ of schemes, its \defineterm{diagonal} $\Delta_f = \Delta_{X / Y}\colon X \to X \times_Y X$ is given by the pullback
	\begin{equation*}
		\begin{tikzcd}
			X
					\ar[dr, dashed, "\Delta_f" near end]
					\ar[drr, equals, bend left = 20]
					\ar[ddr, equals, bend right = 18]
			\\[-.7em]
				&[-1.5em] X \times_Y X
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& X
					\ar[d, "f"]
			\\
				& X
					\ar[r, swap, "f"]
				& Y
		\end{tikzcd}
	\end{equation*}
\end{definition}
Given a reasonable class $\symcal{A}$ of morphisms of schemes, we write $\symcal{A}\delta$ for the class of all morphisms of schemes whose diagonal lies in $\symcal{A}$.
\begin{theorem}[Cancellation Theorem, {\cite[Theorem 11.1.1]{vakil_rising_2025}}]
	Let $\symcal{A}$ be a reasonable class of morphisms of schemes (not necessarily satisfying property \lref{en:sch:localontarget}).
	Given morphisms $X \xto{f} Y \xto{g} Z$ of schemes, if $g \circ f \in \symcal{A}$ and $g \in \symcal{A}\delta$, then $f \in \symcal{A}$.
\end{theorem}
\begin{proof}
	TODO	
\end{proof}

To start, we have a number of purely topological properties:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is\textellipsis{}
	\begin{alphanumerate}
		\item \defineterm[morphism of schemes!open]{open}/\defineterm[morphism of schemes!closed]{closed} if $|f|\colon |X| \to |Y|$ is, 
		\item \defineterm[morphism of schemes!dominant]{dominant} if $f(|X|)$ is dense in $|Y|$,
		\item \defineterm[morphism of schemes!quasi-compact]{quasi-compact} if for all quasi-compact open subsets $V \subseteq Y$, $f^{-1}(V)$ is quasi-compact, and
		\item \defineterm[morphism of schemes!quasi-finite]{quasi-finite} all fibres $f^{-1}(y)$ for $y \in Y$ are finite.
	\end{alphanumerate}
\end{definition}
Note that if $Y$ is integral, then $f$ is dominant iff $\eta \in \img f$.
% TODO explain?
Also note that it is enough to check quasi-compactness on an open affine cover of $Y$.
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is an \defineterm[morphism of schemes!open immersion]{open/closed immersion}\index{morphism of schemes!closed immersion} if $f$ is an isomorphism onto an open (respective, closed) subscheme of $Y$.
\end{definition}
\begin{proposition}
	The classes $\symcal{U}$ and $\symcal{C}$ of open and closed immersions, respectively, are reasonable.
\end{proposition}
\begin{proof}
	Clearly $\symcal{U}$ and $\symcal{C}$ are closed under composition.
	If $i\colon U \incl X$ is an open immersion and $f\colon Y \to X$ is any map of schemes, then we claim that
	\begin{equation*}
		\begin{tikzcd}
			(f^{-1}(U), \cO_Y|_{f^{-1}(U)})
					\ar[r, "f"]
					\ar[d, hook]
				& U
					\ar[d, hook, "i"]
			\\
			Y	
					\ar[r, swap, "f"]
				& X
		\end{tikzcd}
	\end{equation*}
	is a pullback square:
	Indeed, if $g\colon Z \to U$ and $h\colon Z \to Y$ are morphisms satisfying $i \circ g = f \circ h$, then the image of $h$ is contained in $f^{-1}(U)$, and clearly $h\colon Z \to f^{-1}(U)$ is the only candidate map making the obvious diagram commute, seeing as $f^{-1}(U) \incl Y$ is injective.
\end{proof}
We also have some purely scheme-theoretic properties:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	We say that $f$ is\textellipsis{}
	\begin{alphanumerate}
		\item \defineterm[morphism of schemes!locally of finite type]{locally of finite type} if there exists an open affine covering $Y = \bigcup_i \Spec A_i$ of $Y$ and open affine covering $f^{-1}(\Spec A_i) = \bigcup_j \Spec B_{ij}$ of $f^{-1}(\Spec A_i)$ such that each $B_{ij}$ is a finite type $A_i$-algebra,
		\item \defineterm[morphism of schemes!of finite type]{of finite type} if it is locally of finite type and there are only finitely many $B_{ij}$ for each $i$ in the preceding definition,
		\item \defineterm[morphism of schemes!affine]{affine} there exists an open affine covering $Y = \bigcup_i \Spec A_i$ such that $f^{-1}(\Spec A_i)$ is affine, and
		\item \defineterm[morphism of schemes!finite]{finite} if it is affine and $B_i \coloneq f^{-1}(\Spec A_i)$ is a finite $A_i$-module for all $i$.
	\end{alphanumerate}
\end{definition}
\begin{proposition}\label{prp:sch:surjringmapclosedimm}
	Let $\phi\colon A \to B$ be a surjective ring map.
	Then $\Spec \phi\colon \Spec B \to \Spec A$ is a closed immersion onto $V(\ker \phi) \subseteq \Spec A$.
\end{proposition}
\begin{proof}
	This follows from the fact that $\phi$ induces an isomorphism $A / \ker \phi \isom B$.
\end{proof}
We will now discuss some \enquote{standard tricks} when working with properties of morphisms of schemes.
\begin{proposition}\label{prp:sch:basicloc}
	If $f\colon \Spec B \to \Spec A$ is a morphism induced by a morphism $\phi\colon A \to B$ of rings, then $f^{-1}(\Spec A_s) = \Spec B_t$ for all $s \in A$ and $t \in B$ with $\phi(s) = t$.
\end{proposition}
\begin{proof}
	Since $\Spec A_s = D(s) = \{\ideal{p} \in \Spec A \mid s \notin \ideal{p}\}$ and $\Spec B_t = D(t) = \{\ideal{q} \in \Spec B \mid t \notin \ideal{q}\}$ and $f(\ideal{q}) = \phi^{-1}(\ideal{q})$ for all $\ideal{q} \in \Spec B$, it suffices to observe that $s \notin \phi^{-1}(\ideal{q})$ iff $t \notin \ideal{q}$.
\end{proof}
\begin{proposition}
	Let $\Spec A, \Spec B \subseteq X$ be affine subschemes of a scheme $X$. 
	Then $\Spec A \cap \Spec B$ can be covered by open affines $U \subseteq \Spec A \cap \Spec B$ of the form $U = D(s) = \Spec A_s = D(t) = \Spec B_t$ for suitable $s \in A$, $t \in B$.
\end{proposition}
\begin{proof}
	Writing $V \coloneq \Spec A \cap B$, consider a point $x \in V$.
	There then exists some $t_1 \in B$ with $x \in D(t_1) = \Spec B_{t_1} \subseteq V$ since the distinguished open subsets form a basis.
	We can then further find some $s \in A$ with $x \in D(s) = \Spec A_s \subseteq \Spec B_{t_1} \subseteq V$.
	We thus have ring homomorphisms $A \xto{f} B_{t_1} \xto{g} A_s$.
	Applying the last proposition to $g$, we find that $g^{-1}(\Spec A_s) = D(t_2) = \Spec (B_{t_1})_{t_2}$ for some $t_2 \in B$.
	% TODO why?
	On the other hand $f^{-1}(\Spec A_s) = \Spec A_s$, so since we may assume without loss of generality that $t_2 \in \img(B \to B_{t_1})$, we finally obtain that $\Spec (B_{t_1})_{t_2} = \Spec B_{t_1 t_2}$, so for $t = t_1 t_2$ we have $\Spec A_s = \Spec B_t \subseteq V$ as desired.
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes where $Y = \Spec A$ is affine.
	If $X = \bigcup_{i \in I} \Spec B_i$ is a covering of $X$ by open affine subschemes, then $f^{-1}(\Spec A_s) = \Spec (B_i)_t$ for all $s \in A$, $t_i \in B_i$ such that the ring map associated to the restriction $f|_{\Spec B_i}$ takes $s$ to $t_i$.
\end{proposition}
\begin{proof}
	This is a direct consequence of \cref{prp:sch:basicloc}.
\end{proof}
\begin{proposition}
	Assume $\phi\colon A \to B$ is a ring homomorphism and $b_i \in B$ be a collection of elements such that $(b_i \mid i \in I) = B$.
	If each $B_{b_i}$ is of finite type over $A$, then $B$, too, is of finite type over $A$.
\end{proposition}
\begin{proof}
	Without loss of generality we may assume that there are only finitely many $b_i$, say $b_1, \ldots, b_n$.
	Since $(b_1, \ldots, b_n) = B$, we may find coefficients $a_i \in B$ such that
	\begin{equation*}
		\sum_{i = 1}^n a_i b_i = 1
	\end{equation*}
	By assumption, we may write every $B_{b_i}$ as $B_{b_i} = A[\beta_{i, 0}, \ldots, \beta_{i, N_i}]$ where each $\beta_{i, j}$ is of the form $\beta_{i, j} = \alpha_{i, j} / b_i^{k_{i, j}}$ with $\alpha_{i, j} \in B$.
	Letting $B'$ be the $A$-subalgebra of $B$ generated by all the $a_i, b_i$, and $\alpha_{i, j}$, we obtain another algebra of finite type over $A$.
	Now since $(b_1, \ldots, b_n) = B$, we have for all $M > 0$ that $(b_1^M, \ldots, b_n^M) = B$ as well, so there exist $c_i \in B$ with
	\begin{equation*}
		\sum_{i = 1}^n c_i b_i^M = 1
	\end{equation*}
	so for all $b \in B$ we find that $b = \sum_{i = 1}^n c_i (b b_i^M)$.
	Noting then that for $m \gg 0$ we have $b b_i^M \in B$ since $b$ maps to some polynomial in the $\beta_{i, j}$ under the map $B \to B_{b_i}$ and $b_i^M \beta_{i, j}$ lies in the subalgebra generated by the $\alpha_{i, j}$ for $M \gg 0$ by definition, we find that $B = B'$ and therefore that $B$ is of finite type over $A$. 
\end{proof}
\begin{proposition}
	Let $X$ be a scheme and let $A \coloneq \Gamma(X, \cO_X)$.
	Then $X$ is affine, i.e. $X = \Spec A$, iff there exist $a_1, \ldots, a_n \in A$ such that $(a_i) = A$ and the $X_{a_i} \coloneq \{x \in X \mid a_{i, x} \in \cO_{X, x}^*\}$ are affine.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	If $\phi\colon A \to B$ is a ring homomorphism and $\{s_i\}_{i \in I}$ is a family of elements of $A$ such that $(s_i \mid i \in I) = A$.
	Letting $t_i \coloneq \phi(s_i)$, then we have that if $B_{t_i}$ is of finite type over $A_{s_i}$ for all $i$, then $B$ itself is of finite type over $A$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is locally of finite type iff for all $\Spec B \subseteq f^{-1}(\Spec A)$ where $\Spec A \subseteq Y$ is affine, $B$ is of finite type over $A$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is affine iff for all $\Spec A \subseteq Y$ affine, $f^{-1}(\Spec A) \subseteq X$ is affine.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
This has the following immediate consequence:
\begin{corollary}
	If $X \to \Spec A$ is an affine morphism of schemes, then $X$ is affine.
\end{corollary}
\begin{corollary}
	A morphism $f\colon X \to Y$ of schemes is finite iff for all $\Spec A \subseteq Y$ open affine, the preimage $\Spec B = f^{-1}(\Spec A) \subseteq X$ is affine with $B$ of finite type over $A$.
\end{corollary}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	If $f\colon X \to Y$ is a finite morphism of schemes, then $f$ is closed and quasi-finite.
\end{proposition}
\begin{proof}
	TODO
\end{proof}

\subsection{Separated and Proper Morphisms}
\begin{definition}
	A morphism $f\colon X \to Y$ of schemes is \defineterm[morphism of schemes!separated]{separated} if the diagonal $\Delta_f\colon X \to X \times_Y X$ (cf. \cref{def:sch:diagonal}) is a closed immersion.
\end{definition}
\begin{example}
	Morphisms $f\colon \Spec B \to \Spec A$ between affine schemes are always separated: 
	If $f$ corresponds to the ring map $\phi\colon A \to B$, then $\Delta_f$ corresponds to the ring map $\psi\colon B \tensor_A B \to B$ in the pushout diagram
	\begin{equation*}
		\begin{tikzcd}
			A
					\ar[r, "\phi"]
					\ar[d, swap, "\phi"]
				& B
					\ar[d]
					\ar[ddr, bend left, equals]
				&[-1.5em]
			\\
			B
					\ar[r]
					\ar[drr, bend right = 21, equals]
				& B \tensor_A B
					\ar[dr, dashed, "\psi"]
					\ar[ul, phantom, "\ulcorner" very near start]
			\\[-1em]
				& & B
		\end{tikzcd}
	\end{equation*}
	This means $\psi$ is injective, so $\Delta_f$ is a closed immersion by \cref{prp:sch:surjringmapclosedimm}.

	Similarly, every affine morphism is separated, and so are open and closed immersions.
\end{example}
In fact, we can weaken the condition of $\Delta_f$ being a closed immersion somewhat:
\begin{proposition}
	A morphism $f\colon X \to Y$ of schemes is separated iff $\Delta(X) \subseteq X \times_Y X$ is a closed subset.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{definition}
	A morphism $f\colon X \to Y$ of schemes is \defineterm[morphism of schemes!proper]{proper} if it is separated, of finite type, and \defineterm[morphism of schemes!universally closed]{universally closed}, i.e. all pullbacks of $f$ are closed maps.
\end{definition}
\begin{example}
	The map $\A^1_k \to \Spec k$ where $k$ is a field is closed but not universally so:
	For instance, the left hand map in the pullback diagram
	\begin{equation*}
		\begin{tikzcd}
			\A^2_k
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& \A^1_k
					\ar[d]
			\\
			\A^1_k
					\ar[r]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
	is not closed.
	On the other hand, the map $\P^1_k \to \Spec k$ is proper, as we will see later.
	% TODO proof
\end{example}
\begin{example}
	Any finite map is proper:
	Being finite implies being affine, which implies being separated, as we saw above.
	Of course being finite is a stronger condition than being of finite type, and finite maps are closed as well as stable under base change and therefore universally closed.
\end{example}
\begin{example}
	There exist maps that are quasi-finite, separated, of finite type, and surjective, but nevertheless not proper: 
	The projection $\A^1_k \setminus \{0\} \sqcup \A^1_k \to \A^1_k$ for $k$ any field is an example.
\end{example}
The following two results we will not prove:
\begin{proposition}[Nagata Compactification]
	If $f\colon X \to Y$ is separated and of finite type, with $X$ and $Y$ Noetherian schemes, then $f$ can be factored as $X \xto{h} Z \xto{g} Y$ with $h$ an open immersion and $g$ proper.
\end{proposition}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is finite iff it is quasi-finite and proper.
\end{proposition}
We now turn our attention to Vakil's \defineterm{magic square}, an important tool for working with separatedness.
\begin{proposition}
	Given schemes $X_1$, $X_2$, $Y$, and $Z$, as well as maps $f_i\colon X_i \to Y$ ($i = 1, 2$) and $g\colon Y \to Z$, the square
	\begin{equation*}
		\begin{tikzcd}
			X_1 \times_Y X_2
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& Y
					\ar[d, "\Delta_{Y / Z}"]
			\\
			X_1 \times_Z X_2
					\ar[r]
				& Y \times_Z Y
		\end{tikzcd}
	\end{equation*}
	is a pullback square.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Separatedness and properness are closed under composition.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Given morphisms of schemes $X \xto{f} Y \xto{g} Z$ where $g$ is separated, then $\Gamma_f\colon X \to X \times_Z Y$, the \defineterm{graph} of $f$, defined by the diagram
	\begin{equation*}
		\begin{tikzcd}
			X
					\ar[dr, "\isom"]
					\ar[ddr, swap, bend right = 18, "\Gamma_f"]
			\\[-.9em]
				&[-2em] X \times_Y Y
					\ar[r]
					\ar[d, "\psi"]
					\ar[dr, pullback marker]
				& Y
					\ar[d, "\Delta_g"]
			\\
				& X \times_Z Y
					\ar[r]
				& Y \times_Z Y
		\end{tikzcd}
	\end{equation*}
	is a closed immersion.
	(Here the pullback square is the magic square obtained from $X_1 = X$, $X_2 = Y$ and $f_2 = \id_Y$.)
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Given morphisms $X \xto{f} Y \xto{g} Z$ of schemes, then $f$ is separated if $g \circ f$ is.
	Likewise, if $g \circ f$ is proper, $g$ is separated and $f$ is quasi-compact, then $f$ is proper.
\end{proposition}
\begin{proof}
	TODO
\end{proof}

\subsection{Valuative Criterion}
Let $K$ be a field.
A \defineterm{valuation} of $K$ is a function $v\colon K^\mlt \to \Gamma$ where $\Gamma$ is a totlly ordered abelian group such that
\begin{equation*}
	v(x \cdot y) = v(x) + v(y)
\end{equation*}
and
\begin{equation*}
	v(x + y) = \min \{v(x), v(y)\}
\end{equation*}
We can then define the \defineterm{valuation ring} $\cO_v \coloneq \{x \in K \mid v(x) \geq 0\} \subseteq K$ of $K$ with respect to $v$ (by convention $v(0) = \infty$).
The ring $\cO_v$ is a local ring with maximal ideal $\ideal{m}_v = \{x \in \cO_v \mid v(x) > 0\}$.
In fact, $\ideal{m}$ is the only non-zero prime ideal of $\cO_v$, so $\Spec \cO_v$ consists of an open point $\eta = (0)$ and a closed point $\ideal{m}_v$.
\begin{theorem}[Valuative Criterion]
	Let $f\colon X \to Y$ be a map of schemes where $X$ is Noetherian and consider all diagrams of the form
	\begin{equation*}
		\begin{tikzcd}
			\Spec K
					\ar[r]
					\ar[d, hook]
				& X
					\ar[d, "f"]
			\\
			\Spec \cO_v
					\ar[r]
					\ar[ur, dashed]
				& Y
		\end{tikzcd}
	\end{equation*}
	Where $K$ is a field and $v$ a valuation on $K$.
	Then $f$ is separated iff at most one lift as indicated exists, and proper iff exactly one lift exists.
\end{theorem}
\begin{remark}[{\cite[Exercise \RN{2}.4.11]{hartshorne_algebraic_1977}}]
	If $Y$ is also Noetherian and $f$ of finite type, then it suffices to consider squares in which $\cO_v$ is a \emph{discrete} valuation ring.
\end{remark}
\begin{example}
	Fix a field $k$ and let $X$ be the line with double origin.
	We claim that the projection $X \to \A^1_k$ is not separated.
	To this end, observe that $k[t]_{(t)}$ is a valuation ring of $k(t)$ with valuation given by $v(t) = 1$ and group $\Gamma = \Z$ and consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(t)
					\ar[r]
					\ar[d, hook]
				& X
					\ar[d]
			\\
			\Spec k[t]_{(t)}
					\ar[r]
				& \A^1_k
		\end{tikzcd}
	\end{equation*}
	Clearly there are at least two morphisms $\Spec k[t]_{(t)} \to X$ making the diagram commute, given by including into each of the two copies of $\A^1_k$ from which $X$ is glued, so the valuative criterion implies that $X \to \A^1_k$ is not separated.
\end{example}
\begin{example}
	Fix a field $k$ and and consider the projection $\A^1_k \to \Spec k$.
	Consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(t)
					\ar[r]
					\ar[d, hook]
				& \A^1_k
					\ar[d]
			\\
			\Spec k[t]_{(t)}
					\ar[r]
					\ar[ur, dashed]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
	where the top map is induced by the ring map $k[x] \to k(t)$, $x \mapsto t^{-1}$ and the bottom map by the inclusion $k \incl k[t]_{(t)}$.
	A solution to the lifting problem as indicated then corresponds to the dashed arrow in the diagram
	\begin{equation*}
		\begin{tikzcd}
			k(t)
				& k[x]
					\ar[l]
					\ar[dl, dashed]
			\\
			k[t]_{(t)}
					\ar[u, hook]
				& k
					\ar[l, hook]
					\ar[u, hook]
		\end{tikzcd}
	\end{equation*}
	but no such ring map exists since $t$ is not invertible in $k[t]_{(t)}$.
\end{example}

\section{Projective Schemes and the \texorpdfstring{$\Proj$}{Proj}-Construction}
One major class of well-behaved schemes we will be interested in are \emph{projective} schemes.
In fact, almost all schemes we will consider are projective or \emph{quasiprojective}, and coming up with examples that are neither is not so easy.
To make sense of what these words should mean, we first need to discuss the $\Proj$ construction and define projective spaces, and in order for that, in turn, we need to start out with a brief discussion of graded rings.

\subsection{Graded Rings and Modules}
\begin{definition}
	A \defineterm[ring!graded]{graded ring} is a ring $R$ which as an abelian group decomposes into a direct sum
	\begin{equation*}
		R = \bigdsum_{d \geq 0} R_d
	\end{equation*}
	such that the multiplication on $R$ respects this decomposition, i.e. such that $R_d \cdot R_{d'} \subseteq R_{dd'}$.
\end{definition}
To be precise, what we call \enquote{graded ring} is a $\Z_{\geq 0}$-graded ring.
Not every author agrees with this convention, so be careful!

Given a graded ring $R$, $R_0$ is a subring, and each $R_d$ is an $R_0$-module, with the whole ring $R$ an $R_0$-algebra.
The elements of $R_d$ are called \defineterm[homogeneous element]{homogeneous elements of degree $d$}, and an ideal $\ideal{a} \subseteq R$ is a \defineterm[ideal!homogeneous]{homogeneous ideal} if it is generated by its homogeneous elements.
Given $b \in R_d$, we write $\deg(b) \coloneq d$ for its degree.
\begin{proposition}
	Let $R$ be a graded ring.
	An ideal $\ideal{a} \subseteq R$ is homogeneous iff it contains the degree $d$ piece of each of its elements for all $d \geq 0$.
	Moreover, the sum, product, and intersection of two homogeneous ideals are again homogeneous, and so is the radical of a homogeneous ideal.
\end{proposition}
\begin{proof}
	The first claim is immediate.
	Since sum and product of two ideals can be expressed in terms of their generators, they preserve homogeneousness.
	For the radical, if $b \in R$ is an element such that $b^n \in \ideal{a}$ for some $n > 0$, then writing $b = b_{d_1} + \ldots + b_{d_k}$ with $b_{d_i} \in R_{d_i}$ and $d_1 < \cdots < d_k$, we find that the degree $nd_1$-part of $b^n$ is precisely $b_{d_1}^n$, which therefore must lie in $\ideal{a}$, whence $b_{d_1} \in \sqrt{\ideal{a}}$.
	Continuing on upwards then shows that each $b_{d_i}$ must lie in $\sqrt{\ideal{a}}$, so $\sqrt{\ideal{a}}$ is homogeneous.
\end{proof}
\begin{corollary}
	If $\ideal{a} \subseteq R$ is a homogeneous ideal, then $R / \ideal{a}$ naturally carries the structure of a graded ring.
\end{corollary}
\begin{proof}
	The last proposition shows that a homogeneous ideal has the form $\ideal{a} = \bigdsum_{d \geq 0} \ideal{a}_d$ with each $\ideal{a}_d$ a sub-$R_0$-module of $R_d$, so $R / \ideal{a} \isom \bigdsum_{d \geq 0} R_d / \ideal{a}_d$ with the induced ring structure.
\end{proof}
\begin{proposition}
	A homogeneous ideal $\ideal{a} \subseteq R$ is prime iff $\ideal{a} \neq R$ and for any homogeneous elements $a, b \in R$, if $ab \in \ideal{a}$ then $a \in \ideal{a}$ or $b \in \ideal{a}$.
\end{proposition}
\begin{proof}
	One direction is obvious.
	For the other, let $a, b \in R / \ideal{a}$ be a pair of zero divisors such that $ab = 0$.
	Denoting the degree $d$ part of $a$ and $b$ by $a_d$ and $b_d$, respectively, we have 
	\begin{equation*}
		0 = \sum_{i + j = d} a_i b_j
	\end{equation*}
	for all $d \geq 0$.
	In particular $a_0 b_0 = 0$, so our assumption on $\ideal{a}$ implies that $a_0 = 0$ or $b_0 = 0$ (since $a_0$ and $b_0$ lift to elements of $R_0$); without loss of generality we may assume that $a_0 = 0$.
	But then
	\begin{equation*}
		0 = a_0 b_1 + a_1 b_0 = a_1 b_0
	\end{equation*}
	so again we find that $a_1 = 0$ or $b_0 = 0$.
	Continuing this scheme, we arrive at the conclusion that for each $i$ at least one of $a_i$ and $b_i$ has to be zero.
	How can we make sure it is always the one we want? Let us assume without loss of generality that $b_0 \neq 0$.
	In this case we see that $a_1 = 0$ is forced upon us.
	Moreover, each higher sum will have a term of the form $a_k b_0$ with all other terms forced zero by our induction above, so we find that $a_k = 0$, and altogether that $a = 0$, whence $R / \ideal{a}$ is an integral domain and therefore $\ideal{a}$ a prime ideal.
\end{proof}
Every graded ring $R$ comes with a special ideal, the so-called \defineterm{irrelevant ideal} $R_+ \coloneq \bigdsum_{d > 0} R_d \subset R$.
We will justify its name in a second.
Note that $R / R_+ \isom R_0$.
\begin{definition}
	If $R_+ \subset R$ is a finitely generated ideal, we say that $R$ is \defineterm[graded ring!finitely generated]{finitely generated as an $R_0$-algebra}.
	Moreover, if $R$ is generated by $R_1$ as an $R_0$-algebra, we say that it is \defineterm[graded ring!generated in degree 1]{generated in degree 1}.
\end{definition}
If $S \subseteq B$ is a multiplicative subset of homogeneous elements, the localization $S^{-1} B$ has the structure of a $\Z$-graded ring.
\begin{definition}
	\leavevmode
	\begin{alphanumerate}
		\item If $\ideal{p} \subset B$ is a prime ideal, let $S \subseteq B$ consist of all homogeneous elements of $B \setminus \ideal{p}$.
			Then we call
			\begin{equation*}
				B_{(\ideal{p})} \coloneq (S^{-1} B)_0
			\end{equation*}
			the \defineterm[localization!homogeneous]{homogeneous localization of $B$ at $\ideal{p}$}\index{homogeneous localization|see {localization!homogeneous}}.
		\item If $a \in B$ is any element and $S \coloneq \{a^n \mid n \in \N\} \subseteq B$, then we call
			\begin{equation*}
				B_{(a)} \coloneq (S^{-1} B)_0
			\end{equation*}
			the \defineterm[localization!homogeneous]{homogeneous localization of $B$ at $a$}.
	\end{alphanumerate}
\end{definition}
These are ungraded rings.
Note that
\begin{equation*}
	B_{(a)} = \Bigl\{\frac{b}{a^n} \Bigm| \deg(b) = n \deg(a)\Bigr\}
\end{equation*}

\subsection{The \texorpdfstring{$\Proj$}{Proj}-Construction}
Given an ungraded ring $A$, we have seen how to turn it into a scheme by passing to $\Spec A$ and endowing it with the structure sheaf.
As it turns out, if $A$ is graded, then we can make use of the grading to arrive at a different scheme $\Proj A$ which turns out to be nicely behaved.
Roughly speaking, $\Proj A$ is like $\Spec A$ where the role of prime ideals is played by homogeneous prime ideals.
Thus:
\begin{definition}
	Given a graded ring $A$, we define $\Proj A$ \emph{as a set} to be
	\begin{equation*}
		\Proj A \coloneq \{\ideal{p} \subset A \mid \ideal{p} \text{ homogeneous prime ideal with } A_+ \nsubseteq \ideal{p}\}
	\end{equation*}
\end{definition}
We will explain the role of the condition $A_+ \nsubseteq \ideal{p}$ in a bit.
In the meantime, we are missing both a topology on $\Proj A$ and a structure sheaf.
\begin{definition}
	The \defineterm[Zariski topology!on $\Proj$]{Zariski topology} on $\Proj A$ is the topology whose closed sets are the sets
	\begin{equation*}
		V_+(\ideal{a}) \coloneq \{\ideal{p} \in \Proj A \mid \ideal{a} \subseteq \ideal{p}\}
	\end{equation*}
	for $\ideal{a} \subseteq A$ a homogeneous ideal.
\end{definition}
As for the Zariski topology on $\Spec A$, it is not hard to check that this indeed defines a topology.
Also note that this makes $\Proj A$ into a subspace of $\Spec A$, but be warned that this inclusion is not very useful since it does not give rise to a morphism of schemes!
\begin{remark}
	If $a = \sum_{d \geq 0} a_d \in A$ with $a_d \in A_d$, then $V(a) \subseteq \Spec A$ satisfies $V(a) \cap \Proj A = \bigcap_{d} V_+(a_d)$ (we adapt the notation $V_+({{-}})$ to arbitrary subsets and elements as in the ungraded case).
\end{remark}
\begin{proposition}
	If $\ideal{a}, \ideal{b} \subseteq A$ are homogeneous ideals, then $V_+(\ideal{a}) \subseteq V_+(\ideal{b})$ iff $\ideal{b} \cap A_+ \subseteq \sqrt{a}$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}

\section{Quasi-Coherent Sheaves}
\begin{definition}
	Let $X$ be a ringed space.
	A \defineterm{sheaf of $\cO_X$-modules} is a sheaf $\cF \in \Sh(X)$ together with the structure of an $\cO_X(U)$-module on $\cF(U)$ for all $U \subseteq X$ open such that the restriction maps $\rho_{UV}\colon \cF(U) \to \cF(V)$ are $\cF(U)$-module homomorphisms where we view $\cF(V)$ as a $\cF(U)$-module via restriction of scalars along $\rho_{UV}\colon \cO_X(U) \to \cO_X(V)$.
\end{definition}
A morphism of $\cO_X$ modules is then a morphism of sheaves compatible with the $\cO_X(U)$-module structures on each open $U \subseteq X$.
We write $\Mod_{\cO_X}$ for the category of all $\cO_X$-modules.
\begin{definition}
	An $\cO_X$-module $\cF$ is called\textellipsis{}
	\begin{alphanumerate}
		\item \defineterm[$\cO_X$-module!free]{free} if it is of the form $\cF \isom \cO_X^{\dsum I}$ for some index set $I$,
		\item \defineterm[$\cO_X$-module!locally free]{locally free} if $\cF|_U \isom \cO_U^{\dsum I_U}$ for all $U \subseteq X$ open, $I_U$ some index set,
		\item \defineterm[$\cO_X$-module!locally free of rank $r$]{locally free of rank $r$} if it is locally free and $|I_U| = r$ for all $U \subseteq X$ open and some fixed $r \in \N$, and
		\item \defineterm[$\cO_X$-module!invertible]{invertible}\index{sheaf!invertible|see {$\cO_X$-module!invertible}} if it is locally free of rank one.
	\end{alphanumerate}
\end{definition}
\begin{definition}
	Given $\cF, \cG \in \Mod_{\cO_X}$, their \defineterm[tensor product!on $\Mod_{\cO_X}$]{tensor product} is the sheaf $\cF \tensor_{\cO_X} \cG \in \Mod_{\cO_X}$ given by the sheafification of the presheaf sending an open set $U \subseteq X$ to $\cF(U) \tensor_{\cO_X(U)} \cG(U)$.
\end{definition}
\begin{proposition}
	The tensor product $\tensor_{\cO_{X}}$ makes $\Mod_{\cO_X}$ into a symmetric monoidal abelian category with unit $\cO_X$
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{remark}
	Given two sheaves of rings $\cO_X$, $\cO'_X$ on the same space $X$ and a morphism $(X, \cO_X) \to (X, \cO'_X)$ of ringed spaces, there is an adjunction 
	\begin{equation*}
		\begin{tikzcd}[cramped]
			{{-}} \tensor_{\cO_X} \cO'_X\colon\! \Mod_{\cO_X} 
					\ar[r, phantom, "\scriptscriptstyle\bot" description]
					\ar[r, shift left = 0.75ex]
				& \Mod_{\cO'_X}\!\noloc \res_{\cO_X}
					\ar[l, shift left = 0.75ex]
		\end{tikzcd}
	\end{equation*}
	where $\res_{\cO_X}$ sends an $\cO'_X$-module to itself, intrepreted as an $\cO_X$-module via the given morphism, in analogy to the situation for modules over rings.
\end{remark}
This is for instance useful for working with sheaves of smooth and continuous functions on a manifold.
For us, the following generalization will be of greater interest:
Given a morphism $f\colon X \to Y$ of ringed spaces, note that $f_* \cF$ naturally carries the structure of an $f_* \cO_X$-module.
This yields an $\cO_Y$-module via restriction along $f^\sharp\colon \cO_Y \to f_* \cO_X$ which we will also simply denote by $f_*$.
Clearly this assignment gives a functor $f_*\colon \Mod_{\cO_X} \to \Mod_{\cO_Y}$.

In the other direction, the counit $\epsilon$ of the $f^{-1} \dashv f_*$-adjunction gives rise to a morphism
\begin{equation*}
	f^{-1} \cO_Y \xto{f^{-1}(f^\sharp)} f^{-1} f_* \cO_X \xto{\epsilon} \cO_X
\end{equation*}
of sheaves, and therefore a functor $f^*\colon \Mod_{\cO_Y} \to \Mod_{\cO_X}$ taking $\cG \in \Mod_{\cO_Y}$ to $f^{-1} \cG \tensor_{f^{-1} \cO_Y} \cO_X$ which we call \defineterm[pullback]{pullback along $f$.}
\begin{proposition}
	These functors form an adjoint pair
	\begin{equation*}
		\begin{tikzcd}[cramped]
			f^*\!\colon\! \Mod_{\cO_X} 
					\ar[r, phantom, "\scriptscriptstyle\bot" description]
					\ar[r, shift left = 0.75ex]
				& \Mod_{\cO_Y}\!\noloc\! f_*
					\ar[l, shift left = 0.75ex]
		\end{tikzcd}
	\end{equation*}
\end{proposition}
\begin{proposition}[Projection formula]\index{projection formula}
	Given a morphism $f\colon X \to Y$ of ringed spaces and two sheaves $\cF \in \Mod_{\cO_X}$, $\cG \in \Mod_{\cO_Y}$ where $\cG$ is locally free of finite rank, there is a natural isomorphism
	\begin{equation*}
		f_*(\cF_X \otimes_{\cO_X} f^* \cG) \isom f_* \cF_X \otimes_{\cO_Y} \cG
	\end{equation*}
\end{proposition}
\begin{definition}
	Given a ringed space $X$, we call $\cF \in \Mod_{\cO_X}$ \defineterm[quasicoherent sheaf]{quasicoherent} if it is locally a quotient of free sheaves, i.e. for each $x \in X$ there exists an open neighborhood $U$ of $x$ and an exact sequence
	\begin{equation*}
		\cO_U^{\dsum I} \to \cO_U^{\dsum J} \to \cF|_U \to 0
	\end{equation*}
	with $I, J$ suitable index sets.
	We call $\cF$ \defineterm[coherent sheaf]{coherent} if for each $x \in X$ there exists an open neighborhood $U$ of $x$ and a surjection $\cO_U^{\dsum n} \surj \cF|_U$ for some $n > 0$ and whenever $\phi\colon \cO_U^{\dsum n} \surj \cF|_U$ is a surjection defined on some open $U \subseteq X$, then $\ker \phi$ is locally finitely generated, i.e. it iself is the target of a surjection $\cO_V^{\dsum m} \surj (\ker \phi)|_V$ on an open neighborhood $V$ of each point of $U$.
\end{definition}
By definition every coherent sheaf is also quasicoherent.
We let $\Coh(X)$ and $\QCoh(X)$ denote the full subcategories of $\Mod_{\cO_X}$ on the coherent and quasicoherent sheaves, respectively.
% TODO characterization of QCoh(Spec A) & Coh(Spec A)
\begin{proposition}\label{prp:qcoh:qcohacyclic}
	Let $A$ be a ring. 
	Then any $\cF \in \QCoh(\Spec A)$ is acyclic, i.e. $H^i(X, \cF) = 0$ for all $i > 0$.
\end{proposition}
\begin{corollary}
	If $0 \to \cF \to \cG \to \cH \to 0$ is an exact sequence of sheaves on $X = \Spec A$ with $\cF$ quasicoherent, then $0 \to H^0(X, \cF) \to H^0(X, \cG) \to H^0(X, \cH) \to 0$ is exact.
\end{corollary}
\begin{proof}
	Taking sections yields a long exact sequence
	\begin{equation*}
		0 \to H^0(X, \cF) \to H^0(X, \cG) \to H^0(X, \cH) \to H^1(X, \cF) \to \cdots
	\end{equation*}
	but $H^1(X, \cF) = 0$.
\end{proof}
\begin{corollary}
	Let $X$ be a scheme.
	Then $\QCoh(X) \subset \Mod_{\cO_X}$ is closed under extensions.
\end{corollary}
\begin{proof}
	Let $0 \to \cF_1 \to \cF_2 \to \cF_3 \to 0$ be an exact sequence of $\cO_X$-modules with $\cF_1$ and $\cF_3$ quasicoherent.
	Since being quasicoherent is a local property, we may assume that $X = \Spec A$ for some ring $A$.
	Letting $M_i \coloneq H^0(X, \cF_i)$, we obtain a short exact sequence
	\begin{equation*}
		0 \to M_1 \to M_2 \to M_3 \to 0
	\end{equation*}
	Using that $\widetilde{{{-}}}$ is exact, we obtain a diagram
	\begin{equation*}
		\begin{tikzcd}
			0 
					\ar[r]
				& \widetilde{M_1}
					\ar[r]
					\ar[d, "\isom"]
				& \widetilde{M_2}
					\ar[r]
					\ar[d]
				& \widetilde{M_3} 
					\ar[r]
					\ar[d, "\isom"]
				& 0
			\\
			0 
					\ar[r]
				& \cF_1
					\ar[r]
				& \cF_2
					\ar[r]
				& \cF_3
					\ar[r]
				& 0
		\end{tikzcd}
	\end{equation*}
	so by the five-lemma the middle vertical map, too, is an isomorphism and therefore $\cF_2$ is quasicoherent.
\end{proof}
\begin{proposition}
	Let $A$ be a ring and $I$ an injective $A$-module.
	Then $\widetilde{I} \in \QCoh(\Spec A)$ is flabby.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
It turns out that affine schemes are completely characterized by \cref{prp:qcoh:qcohacyclic}:
\begin{theorem}[Serre]
	If $X$ is a quasi-compact scheme, then $X$ is affine iff all quasicoherent sheaves on $X$ are acyclic iff $H^1(X, \theta) = 0$ for all quasicoherent sheaves of ideals $\theta \subseteq \cO_X$.
\end{theorem}
We will not prove this here.
\begin{proposition}
	Let $\phi\colon A \to B$ be a ring homomorphism and $f \coloneq \Spec \phi$.
	If $\cF \in \QCoh(\Spec B)$, then $f_* \cF \in \QCoh(\Spec A)$, and if $\cG \in \QCoh(\Spec A)$, then $f^* \cG \in \QCoh(\Spec B)$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then:
	\begin{alphanumerate}
		\item If $\cG \in \QCoh(Y)$, then $f^* \cG \in \QCoh(X)$.
		\item If $\cG \in \Coh(Y)$ and $X$ is locally Noetherian, then $f^* \cG \in \Coh(X)$.
		\item If $\cF \in \QCoh(X)$ and $X$ is Noetherian, then $f_* \cF \in \QCoh(Y)$.
		\item If $\cF \in \Coh(X)$, $X$ is Noetherian and $f$ is proper, then $f_* \cF \in \Coh(X)$.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $X$ be a separated scheme and $X = \bigcup_{i \in I} U_i$ an affine open cover.
	Then the natural map
	\begin{equation*}
		\check{H}^i(\{U_i\}_{i \in I}, \cF) \to H^i(X, \cF)
	\end{equation*}
	is an isomorphism for all $\cF \in \QCoh(X)$.
\end{proposition}
\begin{proof}
	Since $X$ is separated, the intersections $U_{i_0 \ldots i_n}$ are all affine as well, so the result follows from TODO and \cref{prp:qcoh:qcohacyclic}.
\end{proof}
\begin{proposition}
	Let $Y$ be a scheme.
	Then there is a bijection
	\begin{equation*}
		\{\theta \subseteq \cO_Y \text{ quasicoherent sheaves of ideals}\} \leftrightarrow \{X \subseteq Y \text{ closed subschemes}\}
	\end{equation*}
\end{proposition}
\begin{proof}
	% TODO why is i_* \cO_X qcoh?
	Given a closed subscheme $i\colon X \incl Y$, we obtain a sheaf of ideals as $\theta_X \coloneq \ker(i^\sharp\colon \cO_Y \to i_* \cO_X)$ which is quasicoherent since both $\cO_Y$ and $i_* \cO_X$ are.
	In the other direction, if $\theta \subseteq \cO_Y$ is a quasicoherent sheaf of ideals, then let $X \coloneq \supp(\cO_Y / \theta) = \{y \in Y \mid (\cO_Y / \theta)_y \neq 0\}$ and $\cO_X \coloneq \cO_Y / \theta$.
	% TODO finish
\end{proof}

\subsection{Quasicoherent Sheaves on Projective Schemes}
We will now return to our study of $\Proj$ and projective spaces.
Let $B$ be a graded ring generated in degree 1.
Define a functor
\begin{align*}
	\Gamma_*\colon \QCoh(\Proj B) &\to \grMod_B \\
	\cF &\mapsto \bigdsum_{d \in \Z} \Gamma(\Proj B, \cF(d))
\end{align*}
A priori this only lands in $\grMod_\Z$, so our first task is to show that $\Gamma_*(\cF)$ is actually a graded $B$-module.
% TODO
\begin{proposition}
	Let $A$ be a ring and consider $\P^n_A = \Proj A[x_0, \ldots, x_n]$.
	Then $A[x_0, \ldots, x_n] \isom \Gamma_*(\cO_{\P^n_A})$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $B$ be a graded ring generated in degree 1 and $\cF \in \QCoh(\Proj B)$.
	Then 
	\begin{equation*}
		\widetilde{\Gamma_*(\cF)} \isom \cF
	\end{equation*}
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $B$ be a graded ring generated in degree 1.
	There is an adjunction
	\begin{equation*}
		\begin{tikzcd}[cramped]
			\widetilde{{-}}\!\colon\! \grMod_B
					\ar[r, phantom, "\scriptscriptstyle\bot" description]
					\ar[r, shift left = 0.75ex]
				& \QCoh(\Proj B)\!\noloc\! \Gamma_*
					\ar[l, shift left = 0.75ex]
		\end{tikzcd}
	\end{equation*}
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $X$ be a quasi-compact scheme, $\cF \in \QCoh(X)$ and $\cL$ an invertible sheaf on $X$.
	Then:
	\begin{alphanumerate}
		\item Given sections $s \in H^0(X, \cF)$ and $a \in H^0(X, \cL)$ such that $s|_{X_a} = 0$, then there exists an $n > 0$ such that $s \tensor a^{\tensor n} = 0$ in $H^0(X, \cF \tensor_{\cO_X} \cL^n)$.
		\item For all $t \in H^0(X_a, \cF)$ there exists an $n > 0$ such that $a^{\tensor n} t \in \img(H^0(X, \cF \tensor_{\cO_X} \cL^n) \to H^0(X_a, \cF \tensor_{\cO_X} \cL^n))$.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	TODO
\end{proof}
Given any scheme $X$, we define the $n$-dimensional \defineterm{projective space} $\P^n_Y$ over $Y$ as the pullback
\begin{equation*}
	\begin{tikzcd}
		\P^n_Y
				\ar[r]
				\ar[d]
				\ar[dr, phantom, pullback marker]
			& \P^n_\Z
				\ar[d]
		\\
		Y 
				\ar[r]
			& \Spec \Z
	\end{tikzcd}
\end{equation*}
\begin{definition}
	A morphism $f\colon X \to Y$ of schemes is \defineterm[projective morphism]{projective} if there exists a closed immersion $i\colon X \to \P^n_Y$ making 
	\begin{equation}\label[diag]{diag:qcoh:projctv}
		\begin{tikzcd}[column sep = small]
			X
					\ar[rr, hook, "i"]
					\ar[dr, swap, "f"]
				& & \P^n_Y
					\ar[dl]
			\\
				& Y
		\end{tikzcd}
	\end{equation}
	commute.
	We say $f$ is \defineterm[quasi-projective morphism]{quasi-projective} if there is a similar commutative diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = small]
			X
					\ar[rr, hook, "i"]
					\ar[dr, swap, "f"]
				& & \close{X}
					\ar[dl, "\bar{f}"]
			\\
				& Y
		\end{tikzcd}
	\end{equation*}
	with $i$ an open embedding and $\bar{f}\colon \close{X} \to Y$ projective.
\end{definition}
\begin{definition}
	Let $f\colon X \to Y$ be a projective morphism of schemes. 
	An invertible sheaf $\cL$ on $X$ is \defineterm[very ample]{$f$-relatively very ample} if there exists a factorization as in \cref{diag:qcoh:projctv} with $i^* \cO_{\P^n_Y}(1) \isom \cL$ (here $\cO_{\P^n_Y}(1)$ is the pullback of $\cO_{\P^n_\Z}(1)$ along the structure map).
\end{definition}
\begin{proposition}
	Projective morphisms are proper.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	If $f\colon X \to \Spec A$ is a projective morphism, $A$ a Noetherian ring, $\cF \in \Coh(X)$ a coherent sheaf, and $\cL$ an $f$-relatively very ample invertible sheaf on $X$.
	Then for $n \gg 0$, the sheaf $\cF \tensor_{\cO_X} \cL^n$ is finitely generated.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
We think of $\cL$ in this context as a twisting sheaf $\cO_{X}(1)$ (and will often write it as such) and accordingly of $\cF \tensor_{\cO_X} \cL^n$ as $\cF(n)$.
\begin{proposition}
	If $A$ is a finite-type $k$-algebra for some field $k$ and $X \to \Spec A$ is a projective morphism, then $H^0(X, \cF)$ is a finite $A$-module for all $\cF \in \Coh(X)$, and moreover $\cF(n)$ is acyclic for all $n \gg 0$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
More generally, we have
\begin{theorem}[Serre]
	If $A$ is a Noetherian ring and $f\colon X \to \Spec A$ a projective morphism with $\cO_A(1)$ being $f$-relatively very ample, then $H^j(X, \cF)$ is a finite $A$-module for all $j$ and all $\cF \in \Coh(X)$, and $\cF(n)$ is acyclic for all $n \gg 0$.
\end{theorem}
\begin{corollary}
	Let $f\colon X \to Y$ be projective with $Y$ locally Noetherian.
	Then given any $\cF \in \Coh(X)$, all $R^i f_* \cF$ for $i \geq 0$ are also coherent.
\end{corollary}
\begin{proof}
	TODO
\end{proof}
We will now take a brief detour to compute the cohomology of projective space:
\begin{proposition}
	Let $R$ be a ring. 
	Then there are natural identifications
	\begin{equation*}
		H^q\big(\P^n_R, \cO_{\P^n_R}(d)\big) \isom \begin{cases}
			R[x_0, \ldots, x_n]_d & q = 0, d \geq 0 \\
			\Bigl(\frac{1}{x_0 \cdots x_n} R[x_0^{-1}, \ldots, x_n^{-1}]\Bigr)_d & q = n, d < 0 \\
			0 & \text{else}
		\end{cases}
	\end{equation*}
\end{proposition}
Writing $h^i(\P^n_R, \cO_{\P^n_R}(d)) \coloneq \dim_k H^i(\P^n_R, \cO_{\P^n_R}(d))$, we in particular have that
\begin{equation*}
	h^q\big(\P^n_R, \cO_{\P^n_R}(d)\big) = \begin{cases}
		\binom{n + d}{d} & q = 0, d \geq 0 \\
		\binom{|d| - 1}{|d| - n - 1} & q = n, d < 0 \\
		0 & \text{else}
	\end{cases}
\end{equation*}
\begin{proof}
	TODO
\end{proof}

\section{Invertible Sheaves and Line Bundles}
We now take a closer look at invertible sheaves.
% TODO flesh out analogy
In analogy with vector bundles, we will also call them \defineterm[line bundle]{line bundles}.
\begin{proposition}
	Let $\cL$ be a line bundle on a ringed space $X$. 
	Then $\sHom_{\cO_X}(\cL, \cO_X)$ is also a line bundle.
\end{proposition}
\begin{proof}
	Let $U \subseteq X$ be open such that $\cL|_U \isom \cO_U$.
	Since $\Gamma(U, \sHom_{\cO_X}(\cL, \cO_X)) = \Hom_{\cO_X(U)}(\cL(U), \cO_X(U))$, we find that 
	\begin{equation*}
		\sHom_{\cO_X}(\cL, \cO_X)|_U \isom \sHom_{\cO_U}(\cL|_U, \cO_U) \isom \sHom_{\cO_U}(\cO_U, \cO_U) \isom \cO_U
	\end{equation*}
	so $\sHom_{\cO_X}(\cL, \cO_X)$ is locally free of rank 1.
\end{proof}
\begin{definition}
	Let $X$ be a scheme.
	The \defineterm{Picard group} of $X$ is the group
	\begin{equation*}
		\Pic(X) \coloneq \{\cL \in \Mod_{\cO_X} \text{ invertible}\} / {{\sim}}
	\end{equation*}
	where $\cL \sim \cL'$ if $\cL \isom \cL'$ as $\cO_X$-modules.
\end{definition}
As given $\Pic(X)$ is just a set, but the following justifies its name:
\begin{proposition}
	The tensor product $\tensor_{\cO_X}$ makes $\Pic(X)$ into a group with identity element $\cO_X$ and inverses given by $\cL^{-1} = \cL^\vee \coloneq \sHom_{\cO_X}(\cL, \cO_X)$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{remark}
	The Picard group is functorial:
	% TODO justify this
	If $f\colon X \to Y$ is a morphism of schemes, then the assignment $\cL \mapsto f^* \cL$ defines a group homomorphism $f^*\colon \Pic(Y) \to \Pic(X)$, noting in particular that pullbacks commute with tensor products and that $f^*\sHom_{\cO_X}({{-}}, {{-}}) \isom \sHom_{\cO_X}(f^*({{-}}), {{-}})$.
\end{remark}
Given a line bundle $\cL \in \Pic(X)$, we can obtain a class in $\check{H}^1(X, \cO_X^\mlt) \isom H^1(X, \cO_X^\mlt)$ as follows: 
Pick an open covering $X = \bigcup_{i \in I} U_i$ of $X$ trivializing $\cL$, i.e. such that there exist isomorphisms $\phi_i\colon \cL|_{U_i} \xto{\isom} \cO_{U_i}$ for all $i \in I$.
On the intersections $U_{ij} = U_i \cap U_j$, we then obtain isomorphisms 
\begin{equation*}
	\phi_{ij} \coloneq \phi_i|_{U_{ij}} \circ (\phi_j|_{U_{ij}})^{-1}\colon \cO_{U_{ij}} \xto{\isom} \cO_{U_{ij}}
\end{equation*}
Identifying $\phi_{ij}$ with $\phi_{ij}(1) \in H^0(U_{ij}, \cO^\mlt_X)$, we find that the $\phi_{ij}$ satisfy the cocycle condition and therefore define a class in $\check{H}^1(X, \cO^\mlt_X)$.
% TODO actually do this
A priori this class might depend on the choice of open covering and of the $\phi_i$, but it is not hard to show that this not the case.
\begin{proposition}
	The assignment $\cL \mapsto \{\phi_{ij}\}$ defines an isomorphism $\Pic(X) \isom H^1(X, \cO_X^\mlt)$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{remark}
	Let $\cL \in \Pic(X)$ be a line bundle and $s \in H^0(X, \cL)$ a section.
	Then the set $X_s \coloneq \{x \in X \mid s \notin \ideal{m}_s \cL_s\} \subset X$ where $\ideal{m}_s \subseteq \cO_{X, x}$ is the maximal ideal is open.
	% TODO why?
	Viewing $s$ as a map $\phi\colon \cO_X \to \cL$ which on global sections sends 1 to $s$, its restriction to $X_s$ gives an isomorphism $\phi|_{X_s}\colon \cO_{X_s} \xto{\isom} \cL|_{X_s}$.
	In particular, if $s$ vanishes nowhere, then $\cL$ is trivial, i.e. $\cL \isom \cO_X$.

	% TODO details
	Thus, if $\cL$ is globally generated by a family of sections $\{s_i \in H^0(X, \cL)\}_{i \in I}$ and $U_i \coloneq X_{s_i}$ is the corresponding open set, we obtain a family of isomorphisms $\phi_i\colon \cL|_{U_i} \xto{\isom} \cO_{U_i}$ and therefore a Čech cocycle $\{\phi_{ij}\}$ as above, which explicitly is given by $\phi_{ij} = s_j s_i^{-1}$.
\end{remark}
\begin{example}
	Let $A$ be any ring.
	The line bundle $\cO_{\P^n_A}(1)$ is globally generated by the sections $x_0, \ldots, x_n \in H^0(\P^n_A, \cO_{\P^n_A}(1)) \isom \bigdsum_{i = 0}^n A x_i$.
	Then $(\P^n_A)_{x_i} = D_+(x_i)$ and the induced cohomology class is $\{\phi_{ij} = x_j / x_i\} \in H^1(\P^n_A, \cO_{\P^n_A}^\mlt)$.
\end{example}
\begin{example}
	Consider the function $\Z \to \Pic(\P^n_A) \isom H^1(\P^n_A, \cO_{\P^n_A}^\times)$ sending $d \in \Z$ to $\cO_{\P^n_A}(d)$:
	This is a group homomorphism since $\cO_{\P^n_A}(d) \isom \cO_{\P^n_A}(1)^{\tensor d}$. 
	It is also injective:
	Otherwise we may find a $d < 0$ with $\cO_{\P^n_A}(d) \isom \cO_{\P^n_A}$, but we have seen that $H^0(\P^n_A, \cO_{\P^n_A}(d)) = 0$ if $d < 0$.
	
	We will later see that this map is an isomorphism if $A$ is a field.
\end{example}
% TODO recall from where, exactly?
Recall that if $f\colon X \to Y$ is a morphism of schemes and $\cF$ is a quasi-coherent sheaf on $Y$, then we have an induced map $H^0(Y, \cF) \to H^0(X, f^* \cF)$.
\begin{proposition}
	Let $f\colon X \to \P^n_A$ be a morphism of schemes where $A$ is any ring, let $\cL \coloneq f^* \cO_{\P^n_A}(1)$, and let $s_i \coloneq f^*(x_i)$ for $0 \leq i \leq n$.
	Then the $s_i$ generate $\cL$.
\end{proposition}
\begin{proof}
	Since $\bigdsum_{i = 0}^n \cO_{\P^n_A} \xto{(x_i)_{0 \leq i \leq n}} \cO_{\P^n_A}(1)$ is surjective and $f^*$ is right exact and commutes with finite direct sums (since it is a left adjoint), we find that 
	\begin{equation*}
		f^*\Bigl(\bigdsum_{i = 0}^n \cO_{\P^n_A}\Bigr) \isom \bigdsum_{i = 0}^n \cO_X \xto{(s_i)_{0 \leq i \leq n}} f^* \cO_{\P^n_A}(1) \isom \cL
	\end{equation*}
	is still surjective.
\end{proof}
This statement has a converse: 
\begin{proposition}\label{prp:inv:pullbackmap}
	Let $X$ be a scheme over $\Spec A$ for some ring $A$ and $\cL \in \Pic(X)$ a line bundle generated by sections $s_1, \ldots, s_n \in H^0(X, \cL)$.
	Then there exists a \emph{unique} morphism $f\colon X \to \P^n_A$ over $\Spec A$ with $\cL \isom f^* \cO_{\P^n_A}(1)$ and $s_i = f^*(x_i)$.
\end{proposition}
\begin{proof}
	Let $U_i \coloneq X_{s_i}$.
	Since the $s_i$ generate $\cL$, the $U_i$ form an open covering $X = \bigcup_{i = 0}^n U_i$.
	To define $f$, it is then sufficient to define morphisms $f_i\colon U_i \to D_+(x_i) \subset \P^n_A$ which glue to a morphism on all of $X$. 
	Such an $f_i$ is equivalent to an $A$-algebra map $A[x_0 / x_i, \ldots, x_n / x_i] \to \Gamma(U_i, \cO_X)$.
	TODO
\end{proof}
\begin{remark}
	If the $s_i$ do not generate $\cL$, we still get a morphism $f\colon U \coloneq \bigcup_{i = 0}^n U_i \to \P^n_A$ with $\cL|_U = f^* \cO(1)$ and $s_i = f^*(x_i)$.

	As a particular instance of this, consider $x_0, \ldots, x_n \in H^0(\P^{n + 1}_A, \cO_{\P^{n + 1}_A}(1))$ (note that $x_{n + 1}$ is missing).
	Then $\P^{n + 1}_A \setminus \bigcup_{i = 0}^n X_{x_i} = \bigcap_{i = 0}^n V_+(x_i) = \{[0 : \cdots : 0 : 1]\}$, so we obtain a morphism $\P^{n + 1}_A \setminus \{[0 : \cdots : 0 : 1]\} \to \P^n_A$ which is the \defineterm{linear projection} from $[0 : \cdots : 0 : 1]$.
\end{remark}
\begin{remark}
	The map $f$ constructed in the proof of \cref{prp:inv:pullbackmap} is a closed immersion iff $f^{-1}(D_+(x_i)) \to D_+(x_i)$ is a closed immersion for all $i$ iff the $X_{s_i}$ are affine and the map $A[x_0 / x_i, \ldots, x_n / x_i] \to \Gamma(X_i, \cO_X)$ associated to $f_i$ is surjective.
\end{remark}
\begin{definition}
	A line bundle $\cL \in \Pic(X)$ is \defineterm[line bundle!ample]{ample}\index{ample line bundle|see {line bundle!ample}} if for all $\cF \in \Coh(X)$ the tensor product $\cF \tensor_{\cO_X} \cL^{\tensor n}$ is globally generated for all $n \gg 0$.
\end{definition}
\begin{example}
	If $X = \Spec A$ is an affine scheme, then every invertible sheaf on $X$ is ample:
	If $\cF \in \Coh(X)$, $\cL \in \Pic(X)$ are given by $\cF = \widetilde{M}$ and $\cL = \widetilde{N}$ for $M, N \in \Mod_A$, then $H^0(\cF \tensor_{\cO_X} \cL^n) \isom M \tensor_A N^{\tensor n}$ and the map 
	\begin{equation*}
		M \tensor_A N^{\tensor N} \tensor A_{\ideal{p}} \to M_{\ideal{p}} \tensor_{A_{\ideal{p}}} N_{\ideal{p}}^{\tensor n}
	\end{equation*}
	is obviously surjective for all prime ideals $\ideal{p}$ of $A$ (in fact, it is an isomorphism).
\end{example}
If $X$ is Noetherian, then ampleness can be checked on arbitrary powers:
\begin{proposition}\label{prp:inv:amplechar}
	Let $X$ be a Noetherian scheme and $\cL \in \Pic(X)$.
	Then the following assertions are equivalent:
	\begin{alphanumerate}
		\item\label{en:inv:ample1} $\cL$ is ample, 
		\item\label{en:inv:ample2} $\cL^{\tensor n}$ is ample for all $n > 0$, and
		\item\label{en:inv:ample3} $\cL^{\tensor n}$ is ample for some $n > 0$.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	The implications \lref{en:inv:ample1} $\Rightarrow$ \lref{en:inv:ample2} $\Rightarrow$ \lref{en:inv:ample3} hold by definition.
	To see that \lref{en:inv:ample3} implies \lref{en:inv:ample1}, let $\cF \in \Coh(X)$ be a coherent sheaf and let $\cF' \in \Coh(X)$ be the sheaf
	\begin{equation*}
		\cF' \coloneq \cF \dsum \big(\cF \tensor_{\cO_X} \cL\big) \dsum \big(\cF \tensor_{\cO_X} \cL^{\tensor 2}\big) \dsum \cdots \dsum \big(\cF \tensor_{\cO_X} \cL^{\tensor n - 1}\big)
	\end{equation*}
	By assumption, we may find $m_0 > 0$ such that $\cF' \tensor_{\cO_X} \cL^{\tensor nm}$ is globally generated for all $m \geq m_0$.
	Now distributing the tensor product over the direct sums, we obtain
	\begin{equation*}
		\cF' \tensor_{\cO_X} \cL^{\tensor nm} \isom \big(\cF \tensor_{\cO_X} \cL^{\tensor nm}\big) \dsum \cdots \dsum \big(\cF \tensor_{\cO_X} \cL^{\tensor n - 1 + nm}\big)
	\end{equation*}
	% TODO is this really where this assumption is used? Justify!
	Since $X$ is Noetherian, each sheaf in a direct sum is globally generated if the whole sum is. 
	Hence, we find that $\cF \tensor_{\cO_X} \cL^{\tensor N}$ is globally generated for all $N \geq n m_0$, so $\cL$ is ample.
\end{proof}
\begin{proposition}
	Let $X \xto{f} \Spec A$ be a scheme over $\Spec A$ of finite type where $A$ is a Noetherian ring and $\cL \in \Pic(X)$ a line bundle.
	Then $\cL$ is ample iff $f$ factors as 
	\begin{equation*}
		\begin{tikzcd}[column sep = 0ex]
			X
					\ar[rr, hook, "i"]
					\ar[dr, swap, "f"]
				& & \P^n_A
					\ar[dl]
			\\
				& \Spec A
		\end{tikzcd}
	\end{equation*}
	where $i$ is an (open or closed) immersion such that $\cL^n \isom i^* \cO_{\P^n_A}(1)$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{remark}
	If $f$ is proper, then $i$ will always be a closed immersion.
	In this case, the Proposition says that $\cL$ is ample iff $\cL^n$ is very ample for some $n > 0$. 
\end{remark}
Assume now that $k$ is an algebraically closed field and that $X$ is a projective $k$-scheme.
Given a line bundle $\cL \in \Pic(X)$ globally generated by sections $s_0, \ldots, s_n \in H^0(X, \cL)$, \cref{prp:inv:pullbackmap} yields a morphism $f\colon X \to \P^n_k$ over $\Spec k$ such that $f^* \cO_{\P^n_k}(1) \isom \cL$ and $s_i = f^*(x_i)$.
When is $f$ a closed immersion?
A convenient characterization is given by the following:
\begin{proposition}\label{prp:inv:closedimmcriterion}
	Let $V \coloneq \langle s_0, \ldots, s_n\rangle_k \subseteq H^0(X, \cL)$ be the $k$-vector subspace spanned by the $s_i$.
	Then the map $f$ is a closed immersion iff
	\begin{alphanumerate}
		\item $V$ \defineterm[linear system!separates points]{separates points}, i.e. for any two closed points $x \neq y \in X$ there exists some $s \in V$ with $s(x) = 0$ but $s(y) \neq 0$, and
		% TODO intuition
		\item $V$ \defineterm[linear system!separates tangent directions]{separates tangent directions}, i.e. for all closed points $x \in X$ the map 
			\begin{equation*}
				\langle s_x \mid s \in V \text{ with } s(x) = 0\rangle \incl \ideal{m}_x \cL_x \to \ideal{m}_x  / \ideal{m}^2_x \tensor_{\cO_{X, x}} \cL_x
			\end{equation*}
			where $\ideal{m}_x \subset \cO_{X, x}$ is the maximal ideal is surjective.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	TODO
\end{proof}

\section{Divisors}
\begin{definition}
	Given a space $X$, let $P_X^n$ denote the set of all ascending chains $\emptyset \neq X_0 \subsetneq X_1 \subsetneq \ldots \subsetneq X_n \subseteq X$ of irreducible closed subsets in $X$.  
	The \defineterm{dimension} of $X$ is the integer
	\begin{equation*}
		\dim X \coloneq \sup \big\{n \in \N \mid P^n_X \neq \emptyset\big\}
	\end{equation*}
	If $Z \subseteq X$ is a closed irreducible subset, we similarly let $P_X^n(Z)$ denote the set of all ascending chains $Z = Z_0 \subsetneq Z_1 \subsetneq \ldots \subsetneq Z_n \subseteq X$ of irreducible closed subsets of $X$.
	The \defineterm{codimension} of $Z$ in $X$ is then the integer
	\begin{equation*}
		\codim(Z \subset X) \coloneq \sup \big\{n \in \N \mid P^n_X(Z) \neq \emptyset\big\}
	\end{equation*}
	If $Z \subseteq X$ is closed but not irreducible, we define
	\begin{equation*}
		\codim(Z \subset X) \coloneq \inf_{\substack{W \subset Z \\ \text{closed irreducible}}} \codim(W \subset X)
	\end{equation*}
\end{definition}
For instance, we have $\dim \A^1_k = 1$: A non-empty closed irreducible subset of $\A^1_k$ is precisely a closed point.
% TODO justify
Similarly, $\dim \P^1_k = 1$.
% TODO recall facts about Krull dimension of rings and height of prime ideals, probably in the appendix?
\begin{definition}
	A scheme $X$ is called \defineterm[regular scheme!in codimension 1]{regular in codimension 1} if all the rings $\cO_{X, x}$ of dimension 1 are regular where $x \in X$ is a point.
\end{definition}
In other words, $X$ is regular in codimension 1 if the maximal ideal of all the dimension 1 local rings $\cO_{X, x}$ is principal.
In this section, we will largely restrain ourselves to working with a class of particularly nice schemes, those that are\textellipsis{}
\begin{alphanumerate}
	\item[\#]\label{ass:divs:standard} Noetherian, integral, separated, and regular in codimension 1.
\end{alphanumerate}
% TODO justify
Note that if $X$ satisfies these properties, then the local rings $\cO_{X, x}$ of dimension 1 are discrete valuation rings.
\begin{definition}
	A \defineterm[divisor!prime]{prime divisor} of a scheme $X$ satisfying \lref{ass:divs:standard} is a closed, integral subscheme $Y \subset X$ of codimension 1.
	We write $\PrDiv(X)$ for the set of all prime divisors of $X$.
\end{definition}
If $Y \subset X$ is a prime divisor, then it comes with a unique generic point $\eta \in Y$ since it is integral.

Rather than considering prime divisors on their own, we will consider a \enquote{linearization} of them:
\begin{definition}
	A \defineterm[divisor!Weil]{Weil divisor} on $X$ is a finite formal linear combination 
	\begin{equation*}
		D = \sum_{Y \in \PrDiv(X)} n_Y Y
	\end{equation*}
	with coefficients $n_Y \in \Z$.
	If $n_Y \geq 0$ for all $Y$, we say that $D$ is \defineterm[divisor!Weil!effective]{effective}.
	We denote the group of all Weil divisors on $X$ by $\Div(X)$.
\end{definition}
\begin{example}
	The prime divisors of $\P^1_k$ where $k$ is an algebraically closed field are precisely the closed points. 
	Thus $\Div(\P^k_1)$ consists of finite sums $\sum n_{[a_0 : a_1]} [a_0 : a_1]$ where $a_0, a_1 \in k$ are not both zero.
\end{example}
% TODO why?
\begin{example}
	Let $f \in k[x_0, x_1, x_2]_d$ be a homogeneous degree-$d$ polynomial where $k$ is an algebraically closed field.
	Then the prime divisors of $V_+(f) \subseteq \P^2_k$ consist of all the closed points $[a_0 : a_1 : a_2] \in V_+(f)$.
\end{example}
% TODO link codimension to dimension of local ring
Given a prime divisor $Y \subset X$ with generic point $\eta \in Y$, the stalk $\cO_{X, \eta}$ is a discrete valuation ring with quotient field $K(X)$.
Accordingly, choosing a uniformizer $t$ of the maximal ideal $\ideal{m}_\eta \subset \cO_{X, \eta}$, we obtain a valuation $v_Y\colon K(X)^\mlt \to \Z$ sending $t$ to 1.
% TODO geometric intuition
\begin{definition}
	An element $f \in K(X)^\mlt$ has a \defineterm{zero} along a prime divisor $Y \subset X$ if $v_Y(f) > 0$.
	It has a \defineterm{pole} along $Y$ if $v_Y(f) < 0$.
	We call $v_Y(f)$ the \defineterm[order!of zero]{order}\index{order!of pole} of the zero or pole of $f$ at $Y$, respectively.
\end{definition}
\begin{definition}
	To any $f \in K(X)^\mlt$ we associate its \defineterm[divisor!principal]{principal divisor}
	\begin{equation*}
		(f) \coloneq \sum_{Y \in \PrDiv(X)} \nu_Y(f) Y
	\end{equation*}
\end{definition}
For this to make sense, we need to show that this sum is actually finite:
\begin{lemma}
	For any $f \in K(X)^\mlt$, we have $v_Y(f) = 0$ for all but finitely many prime divisors $Y \subset X$.
\end{lemma}
% TODO this whole thing is a mess
\begin{proof}
	Let $U = \Spec A \subseteq X$ be an open affine subscheme on which $f$ is regular. 
	% TODO why?
	The complement $Z \coloneq X \setminus U$ is closed, so there can only be finitely many prime divisors contained in $Z$, seeing as $X$ is Noetherian.
	Now regularity implies that $v_Y(f) \geq 0$ for all prime divisors $Y \subset U$, with $v_Y(f) > 0$ precisely if $Y \subseteq V(f) \subseteq U$. 
	But this is a closed subset, so again can only contain finitely many prime divisors.
\end{proof}
Note that $(fg) = (f) + (g)$ for $f, g \in K(X)^\mlt$, so the map $p\colon K(X)^\mlt \to \Div(X)$ sending $f$ to $(f)$ is a group homomorphism.
\begin{definition}
	Given $f \in K(X)^\mlt$, we write
	\begin{equation*}
		(f) = (f)_0 - (f)_\infty
	\end{equation*}
	where 
	% TODO the manual spacing
	\begin{equation*}
		(f)_0 \coloneq \;\sum_{\mathclap{\substack{Y \in \PrDiv(X) \\ v_Y(f) > 0}}}\; v_Y(f) Y
	\end{equation*}
	is the \defineterm[divisor!zero]{zero divisor} of $f$ and 
	\begin{equation*}
		(f)_\infty \coloneq \,-\!\sum_{\mathclap{\substack{Y \in \PrDiv(X) \\ v_Y(f) < 0}}}\; v_Y(f) Y
	\end{equation*}
	is its \defineterm[divisor!pole]{pole divisor}.
\end{definition}
\begin{example}
	Consider $X = \A^2_k$ for $k$ a field.
	This certainly satisfies \lref{ass:divs:standard}.
	For $f = x_1 / x_2 \in K(X) = k(x_1, x_2)$, we have $(f)_0 = V(x_1)$ and $(f)_\infty = V(x_2)$.
\end{example}
\begin{definition}
	The \defineterm{divisor class group} of $X$ is the group
	\begin{equation*}
		\Cl(X) \coloneq \Div(X) / K(X)^\mlt
	\end{equation*}
	where we view $K(X)^\mlt$ as a subgroup of $\Cl(X)$ via the map $p$ from above.
	We call an element $D \in \Cl(X)$ \defineterm[divisor!Weil!effective]{effective} if it is represented by an effective divisor in $\Div(X)$.
\end{definition}
Note that being effective does not mean that \emph{all} representatives of $D$ are effective, only that such a representative exists.
\begin{proposition}\label{prp:div:pdivclosedres}
	Let $Z \subsetneq X$ be closed and let $U \coloneq X \setminus Z$.
	Then:
	\begin{alphanumerate}
		\item The map $\Cl(X) \to \Cl(U)$, $\sum n_Y Y \mapsto \sum n_Y (Y \cap U)$ is surjective, and if $\codim(Z \subset X) > 1$ then it is an isomorphism.
		\item\label{en:div:pdivses} If $Y \subset Z$ is a prime divisor, then the sequence
			\begin{equation*}
				\begin{tikzcd}[row sep = 0ex, column sep = small]
					\Z 
							\ar[r]
						& \Cl(X)
							\ar[r]
						& \Cl(U) 
							\ar[r]
						& 0
					\\
					n 
							\ar[r, mapsto]
						& nY
				\end{tikzcd}
			\end{equation*}
			is exact.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	TODO
\end{proof}
Generally $\Cl(X)$ can be difficult to compute, but let us look at a few easy examples:
\begin{example}
	Let $k$ be an algebraically closed field.
	\begin{alphanumerate}
		\item We have $\Cl(\A^1_k) = 0$.
			In fact, a prime divisor $Y \subset \A^1_k$ is a closed point, so the prime divisors are in bijection with the elements of $k$. 
			Thus, if $Y$ corresponds to $\lambda \in k$, then we have $Y = (x_1 - \lambda)$:
			If $Y' = \{\lambda'\} \subset \A^1_k$ is another prime divisor, then $v_{Y'}(x_1 - \lambda) = 0$ since $x_1 - \lambda$ becomes a unit in $K(\A^1_k) = k((x_1 - \lambda'))$. 
			Thus every prime divisor is principal and $\Cl(\A^1_k) = 0$.
		\item On the other hand, $\Cl(\P^1_k) \isom \Z$:
			Prime divisors of $\P^1_k$ again correspond to closed points $[a_0 : a_1] = (x_0 a_1 - a_0 x_1) \in \P^1_k$.
			Identifying $K(\P^1_k)$ with $k(x_0 / x_1)$ (computed on $D_+(x_1)$) and given two prime divisors $Y = [a_0 : a_1], Y' = [a'_0 : a'_1]$ of $\P^1_k$, let
			\begin{equation*}
				f \coloneq \frac{a_0 x_1 - a_1 x_0}{a'_0 x_1 - a'_1 x_0} = \frac{a_0 - a_1(x_0 / x_1)}{a'_0 - a'_1(x_0 / x_1)} \in K(\P^1_k)^\mlt
			\end{equation*}
			Then $(f) = Y - Y'$, so any two prime divisors differ by a principal divisor.
			This implies that the kernel of of the map $\Div(\P^1_k) \to \Z$, $\sum u_Y Y \mapsto \sum u_Y$ consists of all principal divisors, which implies that $\Cl(\P^1_k) \isom \Z$ if $\Cl(\P^1_k) \neq 0$, which we will show later.
	\end{alphanumerate}
\end{example}
One of the drawbacks of $\Cl(X)$ is that it is only defined if $X$ satisfies \lref{ass:divs:standard}.
For general schemes, there is a different approach:
\begin{definition}
	Given any scheme $X$, define a sheaf (of rings) $\cK_X \in \Sh(X)$ as the sheafification of the presheaf defined on affine open subsets $U = \Spec A \subseteq X$ by $U \mapsto Q(A) \coloneq S^{-1} A$ where $S \subset A$ is the set of all non-zero divisors.
\end{definition}
If $X$ is integral, then $Q(A) = K(X)$ for all $\Spec A \subseteq X$.
In this case $\cK_X$ is simply the constant sheaf on $X$ with values in $K(X)$.
By definition, $\cK_X$ comes with an injective map $\cO_X \incl \cK_X$ which restricts to an inclusion $\cO_X^\mlt \incl \cK_x^\mlt$, so we have a short exact sequence
\begin{equation*}
	0 \to \cO_X^\mlt \to \cK_X^\mlt \to \cK_X^\mlt / \cO_X^\mlt \to 0
\end{equation*}
\begin{definition}
	A \defineterm[divisor!Cartier]{Cartier divisor} on $X$ is an element of $H^0(X, \cK_X^\mlt / \cO_X^\mlt)$.
\end{definition}
By definition, a Cartier divisor $D$ on $X$ can be represented by a family of sections $\{f_i \in \Gamma(U_i, \cK_X^\mlt)\}$ on an open covering $X = \bigcup_{i \in I} U_i$ such that $f_i / f_j \in \cO_X^\mlt(U_{ij}) \subseteq \cK_X^\mlt(U_{ij})$, but bear in mind that such a presentation is not unique.
\begin{definition}
	A Cartier divisor $D \in H^0(X, \cK_X^\mlt / \cO_X^\mlt)$ is \defineterm[divisor!Cartier!effective]{effective} if it can be represented by a family of sections $\{f_i \in \cO_X(U_i)\}$.
\end{definition}

By definition we have a long exact sequence
\begin{equation*}
	0 \to H^0\big(X, \cO_X^\mlt\big) \to H^0\big(X, \cK_X^\mlt\big) \xto{\phi} H^0\big(X, \cK_X^\mlt / \cO_X^\mlt\big) \xto{\delta} H^1\big(X, \cO_X^\mlt\big) \to \cdots
\end{equation*}
% TODO what conditions do you need for the first iso?
Note that $H^1(X, \cO_X^\mlt) \isom \Pic(X)$ and $H^0(X, \cK_X^\mlt) = K(X)^\mlt$ if $X$ is integral and that $H^0(X, \cO_X^\mlt) = k$ if it is additionally a proper $k$-scheme where $k$ is any algebraically closed field.
\begin{definition}
	A \defineterm[divisor!Cartier!principal]{principal Cartier divisor} on $X$ is a Cartier divisor in the image of $\phi$.
	The \defineterm[divisor class group!Cartier]{Cartier divisor class group} of $X$ is the abelian group
	\begin{equation*}
		\CaCl(X) \coloneq H^0\big(X, \cK_X^\mlt / \cO_X^\mlt\big) \big/ \img \phi
	\end{equation*}
\end{definition}
What is the relationship between $\Cl(X)$, $\CaCl(X)$, and $\Pic(X)$, provided that $X$ is suitably nice? 
Note that we get an injection $\CaCl(X) \incl \Pic(X)$ from our long exact sequence above if $X$ is integral.
\begin{proposition}
	This injection is in fact an isomorphism.
\end{proposition}
\begin{proof}
	The next term to the right in the long exact sequence is $H^1(X, \cK_X^\mlt)$.
	If $X$ is integral then it is irreducible and $\cK_X^\mlt$ is a constant sheaf, therefore acyclic, therefore this group vanishes, so $\delta$ must be surjective.
\end{proof}
It will be useful to understand this isomorphism more concretely.
% TODO move this into cohomology section
As a first step, we will have to understand the connecting homomorphism $\delta$.
Given any short exact sequence $0 \to \cF \to \cG \to \cH \to 0$ of sheaves on a space $X$, consider the long exact sequence 
\begin{equation*}
	0 \to H^0(X, \cF) \to H^0(X, \cG) \xto{\phi} H^0(X, \cH) \xto{\delta} H^1(X, \cF) \to \cdots
\end{equation*}
Given $s \in H^0(X, \cH)$, we may find an open covering $X = \bigcup_{i \in I} U_i$ of $X$ with well-ordered index set $I$ and sections $s_i \in H^0(U_i, \cG)$ such that $\phi(s_i) = s|_{U_i}$ with $s_i|U_{{ij}} - s_j|_{U_{ij}} \in H^0(U_{ij}, \cF) \subseteq H^0(U_{ij}, \cG)$.
% TODO why
Then $\delta(s) \in H^1(X, \cF)$ is represented by the Čech cocycle $\{s_i|_{U_{ij}} - s_j|_{U_{ij}}\}_{i < j}$ (recall that we always have $H^1(X, \cF) \isom \check{H}^1(X, \cF)$).

Applying this to our situation, let $D \in H^0(X, \cK_X^\mlt / \cO_X^\mlt)$ be represented a family $f_i \in \cK_X^\mlt(U_i) = K(X) \setminus \{0\}$ for $X = \bigcup_{i \in I} U_i$ a suitable open covering.
Then $\delta(D) \in H^1(X, \cO_X^\mlt) \isom \Pic(X)$ is represented by the Čech cocycle $\{f_i / f_j \in \cO_X^\mlt(U_{ij})\}_{i < j}$.
Denoting the resulting line bundle by $\cO(D) \in \Pic(X)$, we can realize $\cO(D)$ as a subsheaf of $\cK_X$ via $\cO(D)|_{U_i} \coloneq \cO|_{U_i} \cdot f_i^{-1}$.
That this does in fact glue to a sheaf follows from the fact that $f_i / f_j \in \cO_X^\mlt(U_{ij})$, and it is a line bundle by definition.

To make the link with $\Cl(X)$, we will from now again assume that $X$ satisfies \lref{ass:divs:standard}.
Let $\phi\colon H^0(X, \cK_X^\mlt / \cO_X^\mlt) \to \Div(X)$ be given by sending a Cartier divisor $D$ represented as $\{f_i \in \cK_X^\mlt(U_i)\}_{i \in I}$ for some open covering $X = \bigcup_{i \in I} U_i$ to $\sum_{Y \in \PrDiv(X)} u_{D, Y} Y$ where $u_{D, Y} = \nu_Y(f_i)$ if $Y \cap U_i \neq \emptyset$.
% TODO why? (finiteness)
This is well-defined since $f_i / f_j \in \cO_X^\mlt(U_{ij})$, i.e. $\nu_Y(f_i / f_j) = 0$, and the sum is finite.
Moreover, if $D$ is principal, i.e. the $f_i$ are the restrictions of a global section $f \in \cK_X^\mlt(X)$, then $\phi(D)$ is the principal Weil divisor $(f)$.
In other words, we have a commutative diagram
\begin{equation*}
	\begin{tikzcd}[column sep = small]
		0 
				\ar[r]
			& H^0\big(X, \cK_X^\mlt\big)
				\ar[r]
				\ar[d, equals]
			& H^0\big(X, \cK_X^\mlt / \cO_X^\mlt\big)
				\ar[r]
				\ar[d, "\phi"]
			& \CaCl(X)
				\ar[r]
				\ar[d, dashed, "\Phi"]
			& 0
		\\
		0
				\ar[r]
			& K(X)^\mlt
				\ar[r]
			& \Div(X)
				\ar[r]
			& \Cl(X)
				\ar[r]
			& 0
	\end{tikzcd}
\end{equation*}
with exact rows, with $\Phi$ induced by $\phi$.
\begin{proposition}
	The map $\phi$ (and hence also $\Phi$) is injective if $X$ is normal and and isomorphism if $X$ is factorial.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
Summing up, we have:
\begin{corollary}
	If $X$ is a factorial scheme, then $\Cl(X) \isom \Pic(X) \isom \CaCl(X)$.
\end{corollary}
% TODO check this
\begin{example}
	If $k$ is a field and $n > 0$, then $\CaCl(\P^n_k) \isom \Pic(\P^n_k) \isom \Cl(\P^n_k) \isom \Z$ with $\Pic(\P^n_k)$ generated by $\cO_{\P^n_k}(1)$, and $\Cl(\P^n_k)$ generated by the class of any hyperplane $H = V_+(x_i)$, $0 \leq i \leq n$.

	To see this last statement, note that if $f \in k[x_0, \ldots, x_n]_d$ is homogeneous of degree $d$ with factorization $f = \prod g_i^{n_i}$, $g_i$ irreducible, $k \in \N_{\geq 0}$, then the corresponding Weil divisor is $\sum n_i V_+(g_i)$. 
	If $f_1, f_2 \in k[x_0, \ldots, x_n]_d$ are homogeneous of the same degree, then $f_1 / f_2 \in K(\P^n_k) = k(x_0, \ldots, x_n)$ is of homogeneous degree 0, so the two Weil divisors $D_1, D_2$ associated to $f_1, f_2$, respectively satisfy $D_1 - D_2 = (f_1 / f_2)$, whence $D_1 = D_2 \in \Cl(\P^n_k)$. 
	Thus, we obtain a group homomorphism $\Z \to \Cl(\P^n_k)$ sending 1 to $H$.
	This map is surjective:
	A prime divisor $Y \subset \P^n_k$ is a closed subscheme and therefore of the form $V_+(\ideal{p})$ for $\ideal{p} \subset k[x_0, \ldots, x_n]$ a homogeneous prime ideal.
	Since $\codim(Y \subset \P^n_k) = 1$, $\ideal{p}$ must be principal and therefore generated by an element $f \in \ideal{p}$ of homogeneous degree $d$, whence $Y = dH$ in $\Cl(\P^n_k)$.

	Finally, to see that it is also injective, we observe that the composite $\Z \surj \Cl(\P^n_k) \isom \Pic(X)$ is of the form $d \mapsto \cO_{\P^n_k}(d)$:
	Letting $H = V_+(x_0)$ without loss of generality, $\P^n_k = \bigcup_{i = 0}^n D_+(x_i)$ and $H \cap D_+(x_i) = V_+(x_0) \cap D_+(x_i) = V(x_0 / x_i)$ imply that the Cartier divisor associated with $H$ can be represented by $\{x_i / x_0 \in k(x_0, \ldots, x_n)_0\}$.
	The associated line bundle is then given by the Čech cocycle $\{\phi_{ij} = x_i / x_j \in \cO_{\P^n_k}^\mlt(D_+(x_i x_j))\} \in \check{H}^1(\P^n_k, \cO_{\P^n_k}^\mlt)$ and this describes $\cO_{\P^n_k}(1)$, as we have seen.
\end{example}
\begin{example}
	Let $\Aut_{/k}(\P^n_k)$ denote the group of automorphisms of $\P^n_k$ over $\Spec k$.
	Then $\Aut_{/k}(\P^n_k) \isom \PGL(n + 1, k) \coloneq \GL(n + 1, k) / k^\mlt$.
	% TODO
\end{example}
If $D \in H^0(X, \cK_X^\mlt / \cO_X^\mlt)$ is an effective Cartier divisor represented by $\{f_i \in \cO_X(U_i)\}$ on some open covering $X = \bigcup_{i \in I} U_i$, then observe that
\begin{equation*}
	\cO(-D)|_{U_i} \isom \cO(X)_{U_i}^\vee = f^i \cO_{U_i} \subseteq \cO_{U_i} \subseteq \cK_X|_{U_i}
\end{equation*}
In other words, $\cO(-D)$ is a subsheaf of $\cO_X$, thus a sheaf of ideals, and therefore corresponds to a closed subscheme $V(D) \subseteq X$ which we will also usually simply denote by $D$.
\begin{proposition}
	If the associated Weil divisor of $D$ is a prime divisor $Y$, then $V(D) = Y$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	There is a short exact sequence
	\begin{equation*}
		0 \to \cO(-D) \to \cO_X \to i_* \cO_D \to 0
	\end{equation*}
	where $i\colon V(D) \incl X$ is the inclusion.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
We will now turn our attention to relating effective divisors to sections of invertible sheaves.
Given $\cL \in \Pic(X)$ and a section $s \in H^0(X, \cL) \setminus \{0\}$, we associate an effective Cartier divisor to $s$ when $X$ is integral as follows:
Fix an open covering $X = \bigcup_{i \in I} U_i$ trivializing $\cL$ and isomorphisms $\phi_i\colon \cL|_{U_i} \xto{\isom} \cO_{U_i}$. 
% TODO restriction maps of sheaves on integral schemes are injective
Since $X$ is integral, the elements $f_i \coloneq \phi_i(s|_{U_i}) \in H^0(U_i, \cO_{U_i})$ are all non-zero and therefore can be regarded as elements of $\cK_X^\mlt(U_i) = K(X)^\mlt$.
\begin{proposition}
	The sections $\{f_i\}_{i \in I}$ define an effective Cartier divisor on $X$.
\end{proposition}
\begin{proof}
	Let $\phi_{ij} \coloneq \phi_i \circ \phi_j^{-1}\colon \cO_{U_{ij}} \xto{\isom} \cO_{U_{ij}}$ be the associated transition maps.
	Then
	\begin{align*} 
		f_j \cdot \phi_{ij}(1) &= \phi_{ij}(f_j) \\
							   &= (\phi_i \circ \phi_j^{-1})(f_j) \\
							   &= \phi_i(s) \\
							   &= f_i
	\end{align*}
	where we omit restrictions from the notation for brevity's sake.
	In other words, $f_i / f_j = \phi_{ij}(1) \in \cO_X^\mlt(U_{ij})$ and the claim follows.
\end{proof}
% TODO actually check this?
A priori this construction may depend on the choice of open covering of $X$, but it is routine to show that different choices of covering give the same Cartier divisor.

We will bend notation a little and allow ourselves to also write $(s)$ for the (Cartier) divisor associated to $s$ in this way, as well as using $(s)_0$, $(s)_\infty$ for the zero and pole divisors of the associated Weil divisor.
\begin{proposition}
	Given two sections $s, s' \in H^0(X, \cL) \setminus \{0\}$, then $(s)_0 = (s')_0 \in H^0(X, \cK_X^\mlt / \cO_X^\mlt)$ iff there exists a $\lambda \in H^0(X, \cO_X^\mlt)$ with $s = \lambda s'$.
\end{proposition}
\begin{proof}
	This follows immediately from the fact that the set of Cartier divisors is $H^0(X, \cK_X^\mlt / \cO_X^\mlt)$.
\end{proof}
In the other direction, let $D$ be an effective Cartier divisor on $X$.
\begin{lemma}
	There exists some $s \in H^0(X, \cO(D)) \setminus \{0\}$ with $(s)_0 = D$.
\end{lemma}
\begin{proof}
	Assume $D$ is represented by a family of sections $\{g_i \in \cO_X^\mlt(U_i)\}$ where $X = \bigcup_{i \in I} U_i$ is an open covering.
	Recall that the line bundle $\cO(D)$ is given by $\cO_{U_i} \cdot g_i^{-1} \subset \cK_X|_{U_i}$ on $U_i$, so that a trivialization $\phi_i\colon \cO(D)|_{U_i} \to \cO_{U_i}$ is given by multiplying with $g_i$.
	In particular, we have that $\phi_i(g_i g_i^{-1}) = \phi_i(1) = g_i$.
	Renaming $1 \in \cO(D)|_{U_i}$ to $s_i$ to avoid confusion, we are thus left to prove that the $s_i$ glue to a global section of $\cO(D)$.
	But we have that $s_i|_{U_{ij}} = s_j|_{U_{ij}}$ iff $\phi_i(s_i|_{U_{ij}}) = \phi_i(s_j|_{U_{ij}})$, and 
	\begin{align*}
		\phi_i(s_j|_{U_{ij}}) &= \phi_i(\phi_j^{-1}(g_j|_{U_{ij}})) \\
							  &= (\phi_i \circ \phi_j^{-1})(g_j|_{U_{ij}}) \\
							  &= \frac{g_i}{g_j} \cdot g_j|_{U_{ij}} \\
							  &= g_i|_{U_{ij}}
	\end{align*}
	which is by definition the same as $\phi_i(s_i|_{U_{ij}})$.
\end{proof}
Summing up, we have proved the following:
% TODO the standard assumption isn't needed here, is it? Only integral and...?
\begin{proposition}\label{prp:div:linebundleeffectivedivisor}
	Let $X$ be a scheme satisfying \lref{ass:divs:standard}.
	Then there is a bijection
	\begin{equation*}
		\frac{H^0(X, \cL) \setminus \{0\}}{H^0\big(X, \cO_X^\mlt\big)} \leftrightarrow 
		\begin{Bmatrix}
			D \in H^0\big(X, \cK_X^\mlt / \cO_X^\mlt\big) \\ 
			D \text{ effective and } \cO(D) \isom \cL
		\end{Bmatrix}
	\end{equation*}
\end{proposition}
\begin{definition}
	Let $X$ be a projective scheme over a field $k$ satisfying \lref{ass:divs:standard}.
	% TODO refer to Serre's theorem
	Given a line bundle $\cL \in \Pic(X)$ and a $k$-vector subspace $V \subseteq H^0(X, \cL)$ (recall that $H^0(X, \cL)$ is a finite-dimensional $k$-vector space under these assumptions), we call $\P(V) \coloneq V \setminus \{0\} \mathbin{/} k^\mlt$ a \defineterm{linear system}.
	If $V = H^0(X, \cL)$, we write $|\cL| \coloneq \P(H^0(X, \cL))$ and speak of a \defineterm[linear system!complete]{complete linear system}.
\end{definition}
\begin{remark}
	If $k$ is algebraically closed, then $|\cL|$ is in bijection with $\{D \in H^0\big(X, \cK_X^\mlt / \cO_X^\mlt\big) \text{ effective and } \cO(D) \isom \cL\}$ by \cref{prp:div:linebundleeffectivedivisor}.
\end{remark}

\section{Curves}
\begin{definition}
	A \defineterm[curve!smooth projective]{smooth projective curve} over a field $k$ is a $k$-scheme $C$ of dimension 1 satisfying the standard assumption \lref{ass:divs:standard}.
\end{definition}
The prime divisors on a smooth projective curve $C$ are given precisely by the closed points of $C$, so a Weil divisor $D \in \Div(C)$ is a finite linear combination $D = \sum n_x x$ of closed points $x \in C$ with coefficients $n_x \in \Z$.
\begin{definition}
	The \defineterm[degree!of a Weil divisor]{degree} of a Weil divisor $D  = \sum n_x x \in \Div(C)$ is the sum
	\begin{equation*}
		\deg(D) \coloneq \sum n_x [k(x) : k]
	\end{equation*}
	% TODO why is this a finite field extension?
	where $[k(x) : k]$ is the degree of the finite field extension $k(x) / k$.
\end{definition}
Note that $\deg(D) \geq 0$ if $D$ is effective.
\begin{proposition}
	Principal Weil divisors on $C$ have degree 0.
\end{proposition}
% TODO this is extremely sketchy
\begin{proof}
	Given $f \in K(C)^\mlt$, let $\cL \coloneq \cO_C((f)_\infty) \isom \cO((f))$.
	We may then find $s, t \in H^0(C, \cL) \setminus \{0\}$ such that $(s)_0 = (f)_0$ and $(t)_0 = (f)_\infty$, noting that $(f)_0 \cap (f)_\infty = \emptyset$.
	Viewing $s$ and $t$ as maps $\cO_C \to \cL$, we obtain short exact sequences
	\begin{equation*}
		0 \to \cL^\vee \xto{s} \cO \to \cO_{(s)_0} \to 0
	\end{equation*}
	and 
	\begin{equation*}
		0 \to \cL^\vee \xto{t} \cO \to \cO_{(t)_0} \to 0
	\end{equation*}
	% TODO reference
	by taking the associated closed scheme exact sequences and tensoring with $\cL^\vee$.
	We thus have
	\begin{equation*}
		\chi(C, \cO_{(s)_0}) = \chi(C, \cO_{(t)_0}) = \chi(C, \cL^\vee) - \chi(C, \cO_{(\cO)})
	\end{equation*}
	% TODO Grothendieck's theorem
	Noting that $\cO_{(s)_0}$ and $\cO_{(t)_0}$ are coherent with 0-dimensional support, we find that they are acyclic, so...
	TODO
\end{proof}
\begin{corollary}
	The degree map $\Div(C) \to \Z$ descends to a group homomorphism
	\begin{equation*}
		\deg\colon \Cl(C) \isom \CaCl(C) \isom \Pic(C) \to \Z
	\end{equation*}
\end{corollary}
\begin{remark}
	If $C(k) \neq \emptyset$, then this map is surjective.
\end{remark}
\begin{example}
	Recall that $\Pic(\P^1_k) \isom \Z \cO_{\P^1_k}(1)$. 
	Since $H^0(\P^1_k, \cO_{\P^1_k}(1)) \neq 0$, by \cref{prp:div:linebundleeffectivedivisor} there exists an effective divisor $D$ such that $\cO_{\P^1_k}(D) \isom \cO_{\P^1_k}(1)$, so $0 \leq \deg D = \deg \cO_{\P^1_k}(1)$ together with the preceding remark implies that $\deg \cO_{P^1_k}(1) = 1$.

	We could also do this computation explicitly:
	% TODO ???
	The section $x_1 \in H^0(\P^1_k, \cO_{\P^1_k}(1))$ satisfies $(x_1)_0 = \{[0 : 1]\}$, so $\deg(\cO_{\P^1_k}(1)) = \deg((x_0)_\infty) = 1$.
\end{example}
Note in particular that $H^0(C, \cL) = 0$ for all $\cL \in \Pic(C)$ with $\deg \cL < 0$, again by \cref{prp:div:linebundleeffectivedivisor}.
\begin{theorem}[Riemann-Roch]\index{Riemann-Roch theorem}
	Let $C$ be a smooth projective curve over a field $k$ and $\cL \in \Pic(C)$ a line bundle.
	Then
	\begin{equation*}
		\chi(C, \cL) = \deg(\cL) + 1 - g(C)
	\end{equation*}
	where $g(C) \coloneq h^1(C, \cO_C)$ is the \defineterm[genus!of a curve]{genus} of $C$.
\end{theorem}
For example, $g(\P^1_k) = 0$ whereas $g(\cO_{V_+(f)}) = (d - 1)(d - 2) / 2$ for a homogeneous polynomial $f \in k[x_0, \ldots, x_n]$ of degree $d$ (some $n > 0$).
\begin{proof}
	TODO
\end{proof}
To get the most out of the Riemann-Roch Theorem, we will combine it with the following theorem we are not going to prove:
\begin{theorem}[Serre duality]
	Let $C$ be a smooth projective curve over a field $k$.
	Then there exists a line bundle $\omega_C \in \Pic(C)$, called the \defineterm{canonical bundle} of $C$, such that $H^1(C, \cL) \isom H^0(C, \cL^\vee \tensor_{\cO_C} \omega_C)^\vee$ for all $\cL \in \Pic(C)$. 
\end{theorem}
Together with Riemann-Roch, this gives the formula
\begin{equation*}
	h^0(C, \cL) - h^0(C, \cL^\vee \tensor_{\cO_C} \omega_C) = \deg \cL + 1 - g(C)
\end{equation*}
Immediately we derive the following consequences:
\begin{proposition}\label{prp:curves:closedimmcriterion}
	Let $C$ be a smooth projective curve over an algebraically closed field $k$ and $\cL \in \Pic(C)$ a line bundle.
	For all distinct closed points $x \neq y \in C$, 
	\begin{alphanumerate}
		\item $\cL$ is globally generated iff $h^0(\cL(-x)) = h^0(\cL) - 1$,
		\item\label{ert:curves:seppts} $\cL$ separates points iff $h^0(\cL(-x - y)) = h^0(\cL) - 2$, and
		\item $\cL$ separates tangent directions iff $h^0(\cL(-2x)) = h^0(\cL) - 1$.
	\end{alphanumerate}
\end{proposition}
\begin{proof}
	Consider the short exact sequence
	\begin{equation*}
		0 \to \cO_C(-x) \to \cO_C \to k(x) \to 0
	\end{equation*}
	where we identify $k(x)$ with $i_* k(x)$ where $i\colon \{x\} \incl C$ is the inclusion.
	Tensoring with $\cL$ and taking cohomology, we get an exact sequence
	\begin{equation}\label{seq:curves:globgen}
		0 \to H^0(C, \cL(-x)) \to H^0(C, \cL) \xto{\phi_x} \cL_x \to H^1(C, \cL(-x)) \to \ldots
	\end{equation}
	Then $\cL$ is globally generated at $x$ iff $\phi_x \neq 0$ which is the case precisely if $h^0(\cL(-x)) = h^0(\cL) - 1$. 

	For \cref{ert:curves:seppts}, we take
	\begin{equation*}
		0 \to \cO_C(-x - y) \to \cO_C \to k(x) \dsum k(y) \to 0
	\end{equation*}
	and obtain
	\begin{equation*}
		0 \to H^0(C, \cL(-x - y)) \to H^0(C, \cL) \xto{\psi} \cL_x \dsum \cL_y \to H^1(C, \cL(-x - y)) \to \ldots
	\end{equation*}
	Then $\cL$ separates points iff $\psi$ is surjective, which is the case iff $h^0(\cL(-x - y)) = h^0(\cL) - 2$.

	TODO last point
\end{proof}
\begin{corollary}\label{cor:curves:ampledegree}
	Let $C$ be a smooth projective curve over an algebraically closed field $k$ and $\cL \in \Pic(C)$ a line bundle.
	Then $\cL$ is globally generated if $\deg \cL \geq 2g(C)$, and $\cL$ is very ample if $\deg \cL \geq 2g(C) + 1$.
\end{corollary}
\begin{proof}
	Let $x \in C$ be a closed point and let $\cM \coloneq \omega_C \tensor_{\cO_C} \cL(-x)^\vee$.
	Using \cref{seq:curves:globgen} from the preceding proof, it suffices to show that $H^1(C, \cL(-x)) = 0$. 
	By Serre duality, this is the same as showing that $H^0(C, \cM)^\vee = 0$.
	To this end, we claim that $\deg \omega_C = 2 g(C) - 2$:
	Riemann-Roch implies that 
	\begin{align*}
		1 - g(C) & = \chi(C, \cO_C) \\
				 &= h^0(\omega_C) - h^1(\cO_C) \\
				 &= h^0(\cO_C) - h^0(\omega_C) \\
				 &= 1 - h^0(\omega_C)
	\end{align*}
	so $h^0(\omega_C) = g(C)$.
	Another round of Riemann-Roch implies that
	\begin{align*}
		\deg \omega_C + 1 - g(C) &= \chi(C, \omega_C) \\
								 &= h^0(\omega_C) - h^1(\omega_C) \\
								 &= g(C) - h^0(\cO_C) \\
								 &= g(c) - 1
	\end{align*}
	so altogether we have $\deg \omega_C = 2g(C) - 2$.
	Now
	\begin{equation*}
		\deg \cM = \deg \omega_C - \deg \cL(-x) = 2g(C) - 2 - \deg L + 1
	\end{equation*}
	which is $< 0$ if $\deg \cL > 2g(C) - 1$. 
	Since the zeroth cohomology of a line bundle of negative degree vanishes, the claim follows.

	TODO second statement
\end{proof}
\begin{corollary}
	If $\cL \in \Pic(C)$, then $\cL$ is ample iff $\deg \cL > 0$.
\end{corollary}
\begin{proof}
	Recall from \cref{prp:inv:amplechar} that $\cL$ is ample iff $\cL^n$ is very ample for some $n > 0$.
	Thus, if $\deg \cL > 0$, then $\deg \cL^{2g(C) + 1} > 2g(C) + 1$ so $\cL^{2g(C) + 1}$ is very ample by the preceding corollary.
	% TODO why does $H^0(C, \cL^n) \neq 0$ imply that $\deg \cL^n > 0$? Obviously $\deg \cL \geq 0$, but why can't it be = 0?
	Conversely, if $\cL$ is ample, then $\cL^n$ is very ample for some $n$, so $H^0(C, \cL^n) \neq 0$ and therefore $\deg \cL > 0$.
\end{proof}
\begin{proposition}
	Let $C$ be a smooth projective curve over a field $k$ of genus $g(C) = 0$.
	Then $C \isom \P^1_k$ iff $C(k) \neq \emptyset$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{definition}
	Given two smooth projective curves $C$, $C'$ over the same field $k$ and a finite surjective morphism $\phi\colon C \to C'$, we obtain a morphism
	\begin{align*}
		\phi^*\colon \Div(C') &\to \Div(C) \\
		y &\mapsto \sum_{\substack{x \in C \setminus \{\eta\} \\ \phi(x) = y}} \nu_x(t) \cdot x
	\end{align*}
	where $y \in C'$ is any prime divisor and $t$ is the image of a choice of uniformizer $f \in \cO_{C', y}$ under the induced map $\cO_{C', y} \to \cO_{C, x}$.
\end{definition}
\begin{proposition}
	The square
	\begin{equation*}
		\begin{tikzcd}
			\Div(C')
					\ar[r, "\phi^*"]
					\ar[d, two heads]
				& \Div(C)
					\ar[d, two heads]
			\\
			\Pic(C')
					\ar[r, "\phi^*"]
				& \Pic(C)
		\end{tikzcd}
	\end{equation*}
	commutes.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Any finite surjective morphism $\phi\colon C \to C'$ between smooth projective curves over a field $k$ satisfies 
	\begin{equation*}
		\deg \phi^* \cL = \deg \cL \cdot \deg \phi
	\end{equation*}
	for all line bundles $\cL \in \Pic(C')$ where $\deg \phi \coloneq [K(C) : K(C')]$ is the \defineterm[degree!of map between curves]{degree} of $\phi$ (note that $\phi$ induces a map $K(C') \incl K(C)$).
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{corollary}\label{cor:curves:degonerationalsection}
	Assume there exists an $f \in K(C)^\mlt$ such that $\deg (f)_0 = 1$ (which is the case iff $\deg (f)_\infty = 1$).
	Then $C \isom \P^1_k$.
\end{corollary}
\begin{proof}
	The element $f$ corresponds to a map $\phi\colon C \to \P^1_k$ with $\phi^* [0 : 1] = (f)_0$, $\phi^* [1 : 0] = (f)_\infty$.
	Applying the preceding Proposition, we find that 
	\begin{equation*}
		1 = \deg (f)_0 = \deg \phi^* [0 : 1] = \deg [0 : 1] \cdot \deg \phi = \deg \phi
	\end{equation*}
	% TODO why does this follow?
	so $\deg \phi = 1$, so $\phi$ must be an isomorphism.
\end{proof}
% TODO function fields

\subsection{Elliptic Curves}
\begin{definition}
	Let $X$ be a scheme over a field $k$.
	We say $X$ is \defineterm{geometrically integral} if $X_K$ is integral is for all field extensions $K / k$.
\end{definition}
\begin{definition}
	An \defineterm[curve!elliptic]{elliptic curve}\index{elliptic curve|see {curve!elliptic}} is a geometrically integral smooth projective finite curve over a field $k$ of genus 1 such that $\cO_{C, x}$ is a discrete valuation ring for all $x \in C(k)$.
\end{definition}
If $C$ is an elliptic curve, then the Riemann-Roch theorem says that
\begin{equation*}
	h^0(C, \cL) - h^1(C, \cL) = \chi(C, \cL) = \deg \cL
\end{equation*}
for all $\cL \in \Pic(C)$.
\begin{proposition}
	If $C$ is an elliptic curve, then $\omega_C = \cO_C$.
\end{proposition}
\begin{proof}
	We saw in the proof of \cref{cor:curves:ampledegree} that $\deg \omega_C = 2g(C) - 2 = 0$.
	Riemann-Roch and Serre duality then imply that $H^0(C, \omega_C) \isom H^1(C, \cO_C) \isom k$.
	But for any $s \in H^0(C, \cO_C) \setminus \{0\}$ we have that $\omega_C \isom \cO_C((s)_0)$ and thus that $0 = \deg \omega_C = \deg (s)_0$.
	% TODO reference
	Since $(s)_0$ is effective, we conclude that $s$ is a nowhere vanishing section of $\omega_C$, whence $\omega_C \isom \cO_C$.
\end{proof}
% TODO why is C(k) non-empty?
Choose any $x_0 \in C(k)$ and consider $\cO_C(3x_0)$.
This has degree $\deg \cO_C(3x_0) = 3$, so \cref{cor:curves:ampledegree} implies that it is very ample.
\begin{proposition}
	The complete linear system $|\cO_C(3x_0)|$ defines a closed embedding $\phi\colon C \incl \P^2_k$.
\end{proposition}
\begin{proof}
	By \cref{prp:inv:pullbackmap} there exists a map $\phi\colon C \to \P^n_k$ such that $f^* \cO_{\P^n_k}(1) \isom \cO_C(3x_0)$ where $n = h^0(\cO_C(3x_0)) - 1$.
	By Serre duality we have that $h^1(\cO_C(3x_0)) = h^0(\omega_C \tensor_{\cO_C} \cO_C(-3x_0)) = $ since $\deg \omega_C \tensor_{\cO_C} \cO(-3x_0) = \deg \cO_C(-3x_0) = -3 < 0$, so $3 = \chi(C, \cO_C(3x_0)) = h^0(\cO_C(3x_0))$ and hence $n = 2$.

	% TODO spell out details
	To see that $\phi$ is a closed embedding, combine \cref{prp:inv:closedimmcriterion} and \cref{prp:curves:closedimmcriterion}.
\end{proof}
% TODO something about sections
Let $\Pic^0(C) \subseteq \Pic(C)$ denote the subgroup consisting of all line bundles of degree 0 and consider the function
\begin{align*}
	\phi\colon C(k) &\to \Pic^0(C) \\
	x &\mapsto \cO_C(x - x_0)
\end{align*}
\begin{proposition}
	The map $\phi$ is bijective.
\end{proposition}
\begin{proof}
	For injectivity, assume there are two points $x \neq y \in C(k)$ such that $\cO_C(x) \dsum \cO_C(x_0)^\vee \isom \cO_C(x - x_0) \isom \cO_C(y - x_0) \isom \cO_C(y) \dsum \cO_C(x_0)^\vee$.
	Then $\cO_C(x) \isom \cO_C(y)$ and we can find $g \in K(C)^\mlt$ such that $(g) = x - y$.
	Thus $(g)_0 = x$, so $\deg (g)_0 = [k : k] = 1$, so \cref{cor:curves:degonerationalsection} says that $C \isom \P^1_k$, but that is absurd: $g(C) = 1 \neq 0 = g(\P^1_k)$.

	For surjectivity, let $\cM \in \Pic^0(C)$ be any degree-0 line bundle.
	Then $\cM(x_0)$ is a degree-1 line bundle, so Riemann-Roch implies that $\chi(C, \cM) = 1$ and therefore that $h^0(C, \cM(x_0)) > 0$.
	Any section $s \in H^0(C, \cM(x_0)) \setminus \{0\}$ thus yields an effective Cartier divisor $(s)_0$ of degree $\deg (s)_0 = 1$, which implies that $(s)_0 = x$ for some $x \in C(k)$.
\end{proof}
As an immediate corollary, $C(k)$ inherits the structure of an abelian group from $\Pic^0(C)$.
We can explain this group structure more explicitly:
TODO

\printindex
\printbibliography
\end{document}

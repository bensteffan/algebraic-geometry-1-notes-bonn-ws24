\documentclass[wip, algebra]{bsteffan-lecturenotes}

\usepackage{stmaryrd}

\addbibresource{references.bib}

\newcommand{\cO}{\mathcal{O}}
\newcommand{\cC}{\mathcal{C}}
\newcommand{\cF}{\mathcal{F}}
\newcommand{\cG}{\mathcal{G}}

\newcommand{\A}{\mathbb{A}}
\renewcommand{\P}{\mathbb{P}}

\newcommand{\Nil}{\mathfrak{N}}

\newcommand{\nisom}{\ncong}

\DefineCategory{Sh}
\DefineCategory{Sch}
\DefineCategory{AffSch}
\DefineCategory{LocRingSpc}
\DefineCategory{RingSpc}
\DefineCategory{Ouv}

\NewDocumentCommand{\defineterm}{om}{%
	\emph{#2}\index{\IfNoValueTF{#1}{#2}{#1}}%
}

\tikzcdset{
	pushout marker/.style = {
		phantom,
		"\ulcorner" very near start
	},
	pullback marker/.style = {
		phantom,
		"\lrcorner" very near start
	},
}

\course{Algebraic Geometry \uppercase\expandafter{\romannumeral 1\relax}}
\lecturer{Prof. Dr. Daniel Huybrechts}
\assistant{Dr. Giacomo Mezzedini}
\author{Ben Steffan}

\begin{document}
\maketitle
\tableofcontents

\section*{About These Notes}

\section{Sheaves}
Sheaf theory is supposed to keep track of local vs. global information on topological spaces.
\begin{definition}
	Let $X$ be a topological space.
	Define a poset $\Ouv_X$ with objects the open sets of $X$ ordered by inclusion.

	Let $\cC$ be a category.
	A $\cC$-valued \defineterm{presheaf} on $X$ is a functor $\cF\colon \op{\Ouv_X} \to \cC$.
\end{definition}
We will mostly be interested in presheaves of abelian groups, rings, or other algebraic structures.
Sometimes one requires that $\cF(\emptyset)$ is a terminal object of $\cC$, but we generally will not assume this.

Given such a presheaf $\cF$ and some open set $U \subseteq X$, we will call the elements of $\cF(U)$ \defineterm[section!local]{local sections of $\cF$} over $U$.
We write $\Gamma(U, \cF) \coloneq \cF(U)$ for the \defineterm{space of sections} over $U$.
If $U = X$, then an element of $\cF(X)$ will be known as a \defineterm[sectin!global]{global section} of $\cF$ and $\Gamma(X, \cF)$ as the \emph{space of global sections}.

Given open sets $V \subseteq U \subseteq X$, we will write the induced map of the inclusion as $\rho_{UV}\colon \cF(U) \to \cF(V)$ and call it a \defineterm{restriction map}.
If $s \in \cF(U)$ is a section, then we will often denote its \emph{restriction} $\rho_{UV}(s) \in \cF(V)$ to $V$ by $s|_V$.

We will take the term \enquote{presheaf on $X$} sans further qualifiers to mean $\Ab$-valued presheaf on $X$.
\begin{example}
	Let $X$ and $Y$ be spaces.
	\begin{enumerate}
		\item Define a presheaf $\cF$ of sets on $X$ by putting 
			\begin{equation*}
				\cF(U) \coloneq \{f\colon X \to Y \mid f \text{ continuous}\}
			\end{equation*}
			for any open $U \subseteq X$ with restriction maps given by restriction of domain.
		\item Letting $Y = \R$ in the last definition, we obtain the \defineterm[sheaf!of continuous functions]{presheaf $\cC_X$ of continuous functions} on $X$.
			Note that in this case pointwise addition and multiplication make $\cC_X$ into a presheaf of rings on $X$, although we will often consider it as simply as a presheaf of abelian groups.
		\item Let $G$ be an abelian group.
			Define the \defineterm[presheaf!constant]{constant presheaf} $\mathbb{G}$ with values in $G$ as $\mathbb{G}(U) \coloneq G$ for all $U \subseteq X$ open with all restriction maps the identity of $G$.
	\end{enumerate}
\end{example}

\section{Schemes}
\begin{definition}
	A \defineterm{ringed space} is a pair $(X, \cO_X)$ where $X$ is a space and $\cO_X\in \Sh_{\CRing}(X)$ a sheaf of rings on $X$.
	A \emph{morphism of ringed spaces} $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ is a pair $(f, f^\sharp)$ where $f\colon X \to Y$ is a continuous function and $f^\sharp\colon \cO_Y \to f_* \cO_X$ a map of sheaves of rings.
\end{definition}
\begin{remark}
	Given morphisms of ringed space $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ and $(g, g^\sharp)\colon (Y, \cO_Y) \to (Z, \cO_Z)$, their composite is the morphism $(g \circ f, g^\sharp \circ f^\sharp)\colon (X, \cO_X) \to (Z, \cO_Z)$ where $g^\sharp \circ f^\sharp\colon \cO_Z \to (g \circ f)_* \cO_X$ is given by 
	\begin{equation*}
		\cO_Z \xto{g^\sharp} g_* \cO_Y \xto{g_*(f^\sharp)} g_* (f_* \cO_X) = (g \circ f)_* \cO_X
	\end{equation*}
	using functoriality of pushforwards with respect to morphisms of sheaves.
\end{remark}
Note that an isomorphism of ringed spaces is a map $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ of ringed spaces such that $f$ is a homeomorphism and $f^\sharp$ an isomorphism of sheaves.

In many cases (though not always) $f^\sharp$ will be naturally \enquote{induced} by $f$.
\begin{example}\label{epl:sch:examples}
	\leavevmode
	\begin{enumerate}
		\item If $X$ is a space and $\cO_X = \cC_X$ its sheaf of continuous functions, then $(X, \cO_X)$ is a ringed space.
			Given a continuous map $f\colon X \to Y$, we obtain a morphism $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ by 
			\begin{align*}
				f^\sharp|_U\colon \cO_Y(U) &\to (f_* \cO_X)(U) = \cO_X(f^{-1}(U)) \\
					\big(\phi\colon U \to \R\big) &\mapsto \big(f^{-1}(U) \xto{f} U \xto{\phi} \R\big)
			\end{align*}
			for all $U \subseteq X$ open.
		\item If $X$ is a smooth manifold and $\cO_X = \cC_X^\infty$ its sheaf of smooth functions, then $(X, \cO_X)$ is a ringed space.
			Given a smooth map $f\colon X \to Y$, we define a map of sheaves $f^\sharp\colon \cO_Y \to f_* \cO_X$ by composition with $f$ as above and therefore obtain a morphism $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ of ringed spaces.
		\item If $X$ is a complex manifold and $\cO_X$ its sheaf of holomorphic functions, then $(X, \cO_X)$ is a ringed space and any holomorphic map $f\colon X \to Y$ induces a map of ringed spaces as above.
		\item Let $k$ be an algebraically closed field.
			A subset $X \subseteq k^n$ is an \defineterm{affine algebraic set} if $X = V(\ideal{a}) = \{(t_1, \ldots, t_n) \in k^n \mid f(t_1, \ldots, t_n)\} = 0 \text{ for all } f \in \ideal{a}\}$ where $\ideal{a} \subseteq k[x_1, \ldots, x_n]$ is an ideal.
			The set $X$ then becomes a space by equipping it with the subspace topology of the Zariski topology on $k^n \isom \MaxSpec k[x_1, \ldots, x_n] \subset \Spec k[x_1, \ldots, x_n]$.

			We call a function $h\colon U \to k$ defined on an open subset $U \subseteq X$ \defineterm[regular function]{regular} if for each $x \in U$ there exists an open neighborhood $V_x \subseteq U$ of $x$ and polynomials $g_1, g_2 \in k[x_1, \ldots, x_n]$ such that for all $y \in V_x$, we can express $h$ as $h(y) = g_1(y) / g_2(y)$ (in particular $g_2$ does not vanish on $V_x$).

			We then obtain a ringed space $(X, \cO_X)$ by letting $\cO_X$ be the \defineterm{sheaf of regular functions} on $X$, i.e.
			\begin{equation*}
				\cO_X(U) \coloneq \{h\colon U \to k \mid h \text{ regular}\}
			\end{equation*}
			together with the obvious restriction maps.
			We call this ringed space the \defineterm[ringed space!associated with an affine algebraic set]{ringed space associated with the affine algebraic set $X$}.
	\end{enumerate}
\end{example}
Note that in examples 2 and 3, we cannot expect a general continuous map to induce a morphism of ringed spaces in the same way, since composing a smooth (respectively, holomorphic) map with a continuous function may not yield a smooth (respectively, holomorphic) map again.
\begin{remark}
	A regular function $h\colon U \to k$ is continuous with respect to the Zariski topologies on its domain and codomain; this follows from the fact that polynomials are continuous.

	We should thus ask whether any continuous map $f\colon X \to Y$ between affine algebraic sets induces a $f^\sharp\colon \cO_Y \to f_* \cO_X$ via composition as in example 1.
	The answer is no in general, but if it does, we call it a \defineterm{regular function}.
\end{remark}
\begin{example}
	Consider the ringed spaces $(\R^n, \cC_{\R^n})$ and $(\R^n, \cC^\infty_{\R^n})$ and define a morphism $(f, f^\sharp)\colon (\R^n, \cC_{\R^n}) \to (\R^n, \cC_{\R^n})$ by $f = \id_{\R^n}$ and taking $f^\sharp\colon \cC^\infty_{\R^n} \to (\id_{\R^n})_* \cC_{\R^n} = \cC_{\R^n}$ to be the inclusion.
	Note in particular that $f$ is a homeomorphism but $(f, f^\sharp)$ is not an isomorphism.

	Similarly, we obtain a map $(\C^n, \cO^\mathrm{hol}_{\C^n}) \to (\C^n_{\mathrm{Zar}}, \cO^\mathrm{reg}_{\C^n})$ from the ringed space of homolomorphic functions on $\C^n$ to the ringed space of regular functions on $\C^n$ equipped with the Zariski topology.
\end{example}
\begin{definition}
	A \defineterm{locally ringed space} is a ringed space $(X, \cO_X)$ such that the stalks $\cO_{X, x}$ are local rings for all $x \in X$.
\end{definition}
\begin{example}
	Let $(X, \cO_X)$ be as in example 1 above.
	Then $(X, \cO_X)$ is a locally ringed space.
	To see this, note that the stalk of $\cO_X$ at any point $x \in X$ is given by
	\begin{equation*}
		\cO_{X, x} = \{(h\colon U \to \R) \mid x \in U \subseteq X \text{ open},\ h \in \cO_X(U)\} / {{\sim}}
	\end{equation*}
	where $(h\colon U \to \R) \sim (h'\colon V \to \R)$ if $h|_W = h'|_W$ for some open $x \in W \subseteq U \cap V$.
	Let $\ideal{m}_x \coloneq \{[h\colon U \to \R] \in \cO_{X, x} \mid h(x) = 0\}$ be the set of germs vanishing at $x$.
	Obviously $\ideal{m}_x$ is a proper ideal, and it is in fact the unique maximal ideal of $\cO_{X, x}$:
	To see this, it suffices to show that every element $g \in \cO_{X, x} \setminus \ideal{m}_x$ is invertible. 
	But a continuous function that does not vanish at $x$ does not vanish on a full neighborhood of $x$ and is therefore invertible on such a neighborhood.

	Analogous reasoning shows that the ringed spaces from examples 2 through 4 above are also locally ringed.
\end{example}
\begin{definition}
	A \defineterm[locally ringed space!morphism of]{morphism of locally ringed spaces} is a morphism of ringed spaces $(f, f^\sharp)\colon (X, \cO_X) \to (Y, \cO_Y)$ if the induced map on stalks $f^\sharp_x\colon \cO_{Y, f(x)} \to (f_* \cO_X)_{f(x)} \to \cO_{X, x}$ is a \defineterm[local ring!morphism of]{morphism of local rings}, i.e. $\big(f^\sharp_x\big)^{-1}(\ideal{m}_x) = \ideal{m}_{f(x)}$.

	Composition of morphisms of locally ringed spaces is given by composition of morphisms of ringed spaces.
\end{definition}
\begin{remark}\label{rmk:sch:nonlocal}
	Note that being a morphism of local rings is a condition over being a morphism of rings which are local.
	If $\phi\colon A \to B$ is a ring map where $A$ and $B$ are local, then $\phi^{-1}(\ideal{m}_B) \subseteq \ideal{m}_A$ will always hold, but the reverse inclusion might not:
	Take for example $A = \Z_{(p)}$ and $B = Q(A) = \Q$ together with the canonical map.
\end{remark}
\begin{remark}
	If $\phi\colon A \to B$ is a ring homomorphism and $\ideal{q} \subset B$ a prime ideal, then $\ideal{p} \coloneq \phi^{-1}(\ideal{q})$ is a prime ideal of $A$.
	Moreover, $\phi$ induces a ring homomorphism $A_{\ideal{p}} \to B_{\ideal{q}}$.
\end{remark}
\begin{example}
	% TODO link to definition of structure sheaf
	Let $A$ be a ring and $\cO_{\Spec A}$ its structure sheaf.
	Then the pair $(\Spec A, \cO_{\Spec A})$ is a ringed space, and in fact a locally ringed space:
	% TODO link
	We have shown that $\cO_{\Spec A, \ideal{p}} \isom A_{\ideal{p}}$.
	By the previous remark, any ring homomorphism $\phi\colon A \to B$ then induces a morphism of locally ringed spaces $(f, f^\sharp)\colon (\Spec A, \cO_{\Spec A}) \to (\Spec B, \cO_{\Spec B})$.
\end{example}
\begin{definition}
	An \defineterm[scheme!affine]{affine scheme} is a locally ringed space $(X, \cO_X)$ which is isomorphic to $(\Spec A, \cO_{\Spec A})$ for some ring $A$.
\end{definition}
\begin{example}
	The following are important examples of affine schemes:
	\begin{enumerate}
		\item $(\Spec \Z, \cO_{\Spec \Z})$.
			For $D(a)$ a basic open set, we have $\cO_{\Spec \Z}(D(a)) \isom \Z_a$.
		\item $(\Spec k, \cO_{\Spec k})$ for $k$ a field.
			In this case $\Spec k$ consists of a single point and $\cO_{\Spec k}(\Spec(k)) = k$.
		\item $\A^n_A \coloneq (\Spec A[x_1, \ldots, x_n], \cO_{\Spec A[x_1, \ldots, x_n]})$ for $A$ any ring.
		\item $(\Spec A, \cO_{\Spec A})$ for $A$ a discrete valuation ring.
			In this case $\Spec A = \{(0), \ideal{m}\}$ where $\ideal{m}$ is the unique maximal ideal with the open sets being the empty set, $\Spec A$ itself, and $\{(0)\}$.
			We then have $\cO_{\Spec A}(\Spec A) = A$ and $\cO_{\Spec A}(\{(0)\}) = \cO_{\Spec A, (0)} = Q(A)$.
		\item $(\Spec k[x]/(x^2), \cO_{\Spec k[x]/(x^2)})$ where $k$ is a field ($k[x] / (x^2)$ is known as the \defineterm[dual numbers]{ring of dual numbers} over $k$).
			In this case $\Spec k[x]/(x^2)$ again consists of a single point, namely $(x)$.
	\end{enumerate}
\end{example}
Note that $(\Spec k, \cO_{\Spec k})$ and $(\Spec k[x]/(x^2), \cO_{\Spec k[x]/(x^2)})$ consist both of one point, yet are different: $\cO_{\Spec k}(\Spec k) = k$ while $\cO_{\Spec k[x]/(x^2)}(\Spec k[x]/(x^2)) = k[x] / (x^2)$.
\begin{example}
	Consider the locally ringed spaces $(\C^n, \cO^\mathrm{hol}_{\C^n})$ and $(\A^n_\C, \cO_{\A^n_\C})$ where $\cO_{\A^n_\C}$ is the structure sheaf.
	We define a map $(f, f^\sharp)\colon (\C^n, \cO^\mathrm{hol}_{\C^n}) \to (\A^n_\C, \cO_{\A^n_\C})$ as follows:
	$f$ is the map 
	\begin{align*}
		f\colon \C^n &\isom \MaxSpec(\C[x_1, \ldots, x_n]) \incl \A^n_\C \\
		(t_1, \ldots, t_n) &\mapsto (x_1 - t_1, \ldots, x_n - t_n)
	\end{align*}
	which is continuous because polynomials are continuous in the standard topology on $\C^n$.
	Letting $A \coloneq \C[x_1, \ldots, x_n]$, we define $f^\sharp\colon \cO_{\A^n_\C} \to f_* \cO^\mathrm{hol}_{\C^n}$ as
	\begin{equation*}
		f^\sharp|_U(s) = \left(U \cap \C^n \xto{s} \coprod_{\ideal{m} \in U \cap \C^n} A_{\ideal{m}} \to \C\right)
	\end{equation*}
	for all $(s\colon U \to \coprod_{\ideal{p} \in U} A_{\ideal{p}}) \in \cO_{\A^n_\C}(U)$ sections over the open set $U \subseteq \A^n_\C$ where the map $\coprod_{\ideal{m} \in U \cap \C^n} A_{\ideal{m}} \to \C$ is given component-wise by the maps $A_{\ideal{m}} \surj A_{\ideal{m}} / \ideal{m} A_{\ideal{m}} \isom \C$.
	Holomorphicity of $f^\sharp|_U(s)$ comes down to the fact that $s$ is locally representable as a quotient of polynomials which are of course holomorphic.
\end{example}
\begin{lemma}
	Let $(f, f^\sharp)\colon (\Spec A, \cO_A) \to (\Spec B, \cO_B)$ be a morphism of locally ringed spaces.
	Then $f$ is of the form $f = \Spec \phi$ where $\phi \coloneq f^\sharp(\Spec A)\colon B \isom \cO_B(\Spec B) \to (f_* \cO_A)(\Spec B) = \cO_A(\Spec A) \isom A$ is the map on global sections.
\end{lemma}
\begin{proof}
	Since passing to stalks is commutative with the map on global sections, we have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}
			B
					\ar[r, "\phi"]
					\ar[d]
				& A
					\ar[d]
			\\
			B_{f(\ideal{q})}
					\ar[r, swap, "f^\sharp_{\ideal{q}}"]
				& A_{\ideal{q}}
		\end{tikzcd}
	\end{equation*}
	for any $\ideal{q} \in \Spec A$.
	But $(f, f^\sharp)$ is local, so $(f^\sharp_{\ideal{q}})^{-1}(\ideal{q} B_{\ideal{q}}) = f(\ideal{q}) B_{f(\ideal{q})}$ and we conclude that $\phi^{-1}(\ideal{q}) = f(\ideal{q})$, whence $f = \Spec \phi$.
\end{proof}
\begin{corollary}
	Let $(f, f^\sharp), (g, g^\sharp)\colon (\Spec A, \cO_A) \to (\Spec B, \cO_B)$ be two morphisms of locally ringed spaces.
	If $f^\sharp(\Spec B) = g^\sharp(\Spec B)$, then $(f, f^\sharp) = (g, g^\sharp)$.
\end{corollary}
\begin{solution}
	By the previous lemma we have $f = g$.
	To show that $f^\sharp = g^\sharp$, it suffices to show that they agree on all distinguished open sets $D(b) \subseteq \Spec B$, and this follows from the fact that $D(b) = \Spec B_b$ by restriction.
\end{solution}
\begin{proposition}\label{prp:sch:morphbij}
	Let $A$, $B$ be two rings.
	Then there exists a bijection
	\begin{equation*}
		\begin{Bmatrix}
			\text{ring homomorphisms} \\
			A \to B
		\end{Bmatrix}
		\leftrightarrow
		\begin{Bmatrix}
			\text{morphisms of locally ringed spaces} \\
			(\Spec B, \cO_{\Spec B}) \to (\Spec A, \cO_{\Spec A})
		\end{Bmatrix}
	\end{equation*}
\end{proposition}
\begin{proof}
	Given a morphism $(f, f^\sharp)\colon (\Spec B, \cO_{\Spec B}) \to (\Spec A, \cO_{\Spec A})$, we obtain a ring homomorphism $\phi\colon A \to B$ as
	\begin{align*}
		\phi = f^\sharp\colon A \isom \cO_A(\Spec A) \to (f_* \cO_B)(\Spec A) &= \cO_B(f^{-1}(\Spec A)) \\
																			  &= \cO_B(\Spec B) \\
																			  &\isom B
	\end{align*}
	In the other direction, if we start with a ring homomorphism $\psi\colon A \to B$, we obtain a morphism $(g, g^\sharp)\colon (\Spec B, \cO_{B}) \to (\Spec A, \cO_{A})$ via $g = \Spec \psi$ and defining $g^\sharp\colon \cO_A \to g_* \cO_B$ as follows: 
	For any distinguished open set $D(a) \subseteq \Spec A$, we have $\cO_A(D(a)) \isom A_a$ as well as 
	\begin{equation*}
		(g_* \cO_B)(D(a)) = \cO_B(g^{-1}(D(a))) = \cO_B(D(\psi(a))) = B_{\psi(a)}
	\end{equation*}
	so we can take $g^\sharp\colon \cO_A(D(a)) \to (g_* \cO_B)(D(a))$ to be the natural map $A_a \to B_{\psi(a)}$ induced by $\psi$.
	It is not hard to check that this glues together to a sheaf homomorphism (in particular since the $D(a)$ form a basis of the Zariski topology on $\Spec A$), so $(g, g^\sharp)$ is a morphism of ringed spaces.
	To see that it is in fact a morphism of locally ringed spaces, let $\ideal{q} \in \Spec B$ be a prime ideal and define $\ideal{p} \coloneq \psi^{-1}(\ideal{q})$.
	Since the map $g^\sharp_{\ideal{p}}\colon \cO_{A, \ideal{p}} \to \cO_{B, \ideal{q}}$ is compatible with $\psi = g^\sharp(\Spec A)$, we find that $(g^\sharp_{\ideal{p}})^{-1}(\ideal{q} B_{\ideal{q}}) = (\psi^{-1}(\ideal{q})) A_{\psi^{-1}(\ideal{q})} = \ideal{p} A_{\ideal{p}}$ so $g^\sharp$ is local.

	Finally, we will show that these two constructions are mutually inverse.
	One direction is easy: 
	If we start with a ring homomorphism $\phi\colon A \to B$, then construct a morphism of locally ringed spaces $(f, f^\sharp)$, we recover $\phi$ as $\phi = f^\sharp(\Spec A)$.
	On the other hand, if we start with $(f, f^\sharp)$ and apply our construction to $f^\sharp(\Spec A)$ to get another morphism $(g, g^\sharp)$, the previous corollary implies that $(f, f^\sharp) = (g, g^\sharp)$ since $f^\sharp(\Spec A) = g^\sharp(\Spec B)$ by construction.
\end{proof}
\begin{definition}
	A \defineterm{scheme} is a ringed space $(X, \cO_X)$ that is locally isomorphic to an affine scheme, i.e. for all points $x \in X$ there exists an open neighborhood $U \ni x$ such that $(U, \cO_X|_U)$ is isomorphic to $(\Spec A, \cO_{\Spec A})$ for some ring $A$.
\end{definition}
\begin{definition}
	We define $\AffSch$, $\Sch$, and $\LocRingSpc$ to be the categories with objects the affine schemes, schemes, and locally ringed spaces, respectively, and morphisms all morphisms of locally ringed spaces.

	We also define a category $\RingSpc$ which has as objects all ringed spaces and as morphisms all morphisms of ringed spaces.
\end{definition}
We thus have a chain of subcategory inclusions
\begin{equation*}
	\AffSch \incl \Sch \incl \LocRingSpc \incl \RingSpc
\end{equation*}
of which the first two are full.
\begin{remark}\label{prp:sch:ringaff}
	Proposition \ref{prp:sch:morphbij} implies that we have an equivalence of categories 
	\begin{align*}
		\op{\CRing} &\xto{\eqv} \AffSch \\
		A &\mapsto (\Spec A, \cO_{\Spec A})
	\end{align*}
\end{remark}
\begin{remark}
	Recall the example from Remark \ref{rmk:sch:nonlocal} and note that the induced map $(\Spec Q(A), \cO_{\Spec Q(A)}) \to (\Spec A, \cO_{\Spec A})$ \emph{is} a morphism of local rings.
\end{remark}

\subsection{From Classical Algebraic Geometry to Scheme Theory}
Let $k$ be an algebraically closed field and $X \subseteq k^n$ an affine algebraic set, say $X = V(\ideal{a})$ for some ideal $\ideal{a} \subseteq k[x_1, \ldots, x_n]$.
Then $X$ comes with a sheaf, its sheaf of regular functions $\cO_X$ (see example \ref{epl:sch:examples}), which gives a ringed space $(X, \cO_X)$.
In general $(X, \cO_X)$ is not a scheme, but we can associate to it a scheme as follows:
Consider the ideal $I(X) \subseteq k[x_1, \ldots, x_n]$ given by 
\begin{equation*}
	I(X) \coloneq \{f \in k[x_1, \ldots, x_n] \mid f(t_1, \ldots, t_n) = 0 \text{ for all } (t_1, \ldots, t_n) \in X\}
\end{equation*}
By Hilbert's Nullstellensatz, we then have $I(X) = \sqrt{\ideal{a}}$.
We then obtain the \defineterm{affine coordinate ring} $A(X) \coloneq k[x_1, \ldots, x_n] / I(X)$ of $X$, and from this an affine scheme $(\Spec A(X), \cO_{A(X)})$.
\begin{proposition}
	There exists a morphism of locally ringed spaces $(f, f^\sharp)\colon (X, \cO_X) \to (\Spec A(X), \cO_{A(X)})$.
\end{proposition}
\begin{proof}
	Noting that 
	\begin{equation*}
		\MaxSpec A(X) = \{\ideal{m} \in \MaxSpec k[x_1, \ldots, x_n] \mid I(X) \subseteq \ideal{m}\}
	\end{equation*}
	we see that under the bijection $k^n \leftrightarrow \MaxSpec k[x_1, \ldots, x_n]$, $(t_1, \ldots, t_n) \mapsto (x_1 - t_1, \ldots, x_n - t_n)$ we in fact have $X \isom \MaxSpec A(X)$, and so define $f$ to be the inclusion $X \isom \MaxSpec A(X) \incl \Spec A(X)$.

	If $U \subseteq \Spec A(X)$ is open and $s\colon U \to \coprod_{\ideal{p} \in U} A(X)_{\ideal{p}}$ is any section in $\cO_{A(X)}(U)$, we obtain a section $t \in (f_* \cO_X)(U) = \cO_X(U \cap \MaxSpec A(X))$ via
	\begin{equation*}
		t\colon U \cap \MaxSpec A(X) \xto{s|_{U \cap \MaxSpec A(X)}} \coprod_{\ideal{m} \in \MaxSpec A(X)} A(X)_{\ideal{m}} \to k
	\end{equation*}
	where the last map is obtained by observing that $A(X)_{\ideal{m}} / \ideal{m} A(X)_{\ideal{m}} \isom k$ for all $\ideal{m} \in \MaxSpec A(X)$ and applying this isomorphism to each component.
	% TODO check
	Since $s$ is locally of the form $s = \bar{g}_1 / \bar{g}_2$ for $\bar{g}_1, \bar{g}_2 \in A(X)$, $t$ is locally of the form $t = g_1 / g_2$ for $g_1, g_2$ lifts of $\bar{g}_1, \bar{g}_2$, respectively, and therefore $f^\sharp(s) \coloneq t$ is well-defined.

	% TODO spell this out?
	One then checks that $(f, f^\sharp)$ does in fact define a morphism of locally ringed spaces.
	In fact, if $\ideal{m} \in \MaxSpec k[x_1, \ldots, x_n]$ is the maximal ideal corresponding to $(t_1, \ldots, t_n) \in k^n$, then $\cO_{X, \ideal{m}} \isom \cO_{Y, \ideal{m}} \isom A(X)_{\ideal{m}}$.
\end{proof}
\begin{remark}
	To define $(\Spec A(X), \cO_{A(X)})$, we only that $X$ is an affine algebraic set, not that $X = V(\ideal{a})$ for a given ideal $\ideal{a}$.
	If we remember this information, we can consider $\Spec k[x_1, \ldots, x_n] / \ideal{a}$.
	We then have morphisms
	\begin{equation*}
		(X, \cO_X) \xto{(f, f^\sharp)} (\Spec A(X), \cO_{A(X)}) \xto{(g, g^\sharp)} (\Spec k[x_1, \ldots, x_n] / \ideal{a}, \cO_{k[x_1, \ldots, x_n] / \ideal{a}})
	\end{equation*}
	% TODO homeomorphism?
	where $g$ is a continuous bijection.
\end{remark}
\begin{example}
	Let $k$ be a field and $A \coloneq k[x] / (x^2)$ its ring of dual numbers.
	Then $\Spec k$ and $\Spec A$ both consist of a single point.
	Define two maps $(f, f^\sharp)\colon (\Spec k, \cO_{k}) \to (\Spec A, \cO_{A})$ and $(g, g^\sharp)\colon (\Spec A, \cO_{A}) \to (\Spec k, \cO_k)$ as follows:
	$f$ and $g$ must be the unique maps. 
	The map $f^\sharp$ is given by the quotient map $f^\sharp\colon \cO_A(\Spec A) \isom A \surj A / (x) \isom k \isom (f_* \cO_k)(\Spec A)$, and its counterpart $g^\sharp\colon \cO_k(\Spec k) \isom k \incl A \isom (g_* \cO_A)(\Spec k)$ is the canonical inclusion.
	Then $(g, g^\sharp) \circ (f, f^\sharp) = \id_{(\Spec k, \cO_k)}$, but $(f, f^\sharp) \circ (g, g^\sharp) \neq \id_{(\Spec A, \cO_A)}$: $f^\sharp \circ g^\sharp$ is the composite $A \surj k \incl A \neq \id_A$.
\end{example}
\begin{proposition}\label{prp:affinclleftadj}
	The inclusion $i\colon \AffSch \incl \Sch$ has a left adjoint $l\colon \Sch \to \AffSch$ given by $l((X, \cO_X)) \coloneq \Spec \Gamma(X, \cO_X)$ on objects.
	In other words, there are natural isomorphisms
	\begin{equation*}
		\AffSch(\Spec \Gamma(X, \cO_X), Y) \isom \Sch(X, Y)
	\end{equation*}
	for any scheme $X$ and affine scheme $Y$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
Here are two special cases of this:
\begin{example}
	\leavevmode
	\begin{enumerate}
		\item Let $(X, \cO_X)$ be any scheme.
			Since there is a unique ring map $\Z \to \Gamma(X, \cO_X)$, there is a unique morphism of schemes $X \to \Spec \Z$, i.e. $\Spec \Z$ is a terminal object of $\Sch$.
		\item If $k$ is a field and $A$ a $k$-algebra, then the inclusion $k \incl A$ corresponds to a morphism $(\Spec A, \cO_A) \to (\Spec k, \cO_k)$.
	\end{enumerate}
\end{example}
Next, we want to briefly discuss how to create new schemes out of old via gluing.
\begin{proposition}[{\cite[Exercise 4.4.A]{vakil_rising_2025}}]
	Suppose we are given schemes $X_i$, open subschemes $X_{ij} \subseteq X_i$ with $X_{ii} = X_i$, and isomorphisms $f_{ij}\colon X_{ij} \to X_{ji}$ with $f_{ii}$ the identity such that the \defineterm{cocycle condition} $f_{ik}|_{X_{ij} \cap X_{ik}} = f_{jk}|_{X_{ji} \cap X_{jk}} \circ f_{ij}|_{X_{ij} \cap X_{ik}}$ is satisfied for all $i, j, k$.
	Then there is a unique scheme $X$ along with open subschemes isomorphic to the $X_i$ respecting the gluing data in the obvious sense.
\end{proposition}
\begin{proof}
	TODO (maybe?)
\end{proof}
\begin{example}
	Let $k$ be a field and let $X_1 = X_2 = \A^1_k$ and $U_1 = U_2 = \A^1_k \setminus \{0\} = \Spec(k[x]_x)$. 
	There are two interesting choices of morphism $(\phi, \phi^\sharp)\colon (U_1, \cO_{U_1}) \to (U_2, \cO_{U_2})$:
	\begin{enumerate}
		\item $(\phi, \phi^\sharp) = \id_{(U_1, \cO_{U_1})}$.
			In this case we obtain the \defineterm{affine line with two origins}.
		\item $(\phi, \phi^\sharp)$ is given by the ring isomorphism $k[x]_x \to k[x]_x$, $x \mapsto 1 / x$.
			In this case we obtain the \defineterm{projective line} $\P^1_k$ over the field $k$.
			% TODO pictures?
	\end{enumerate}
\end{example}
To make sense of this second example, assume that $k$ is algebraically closed and only consider maximal ideals.
Then $\phi^{-1}((x - t)) = (x - 1 / t)$, so $\P^1_k$ identifies with $k^2 \setminus \{0\} / k^\times$, points of which we write as $[t_1 : t_2]$ (these are the familiar homogeneous coordinates).

\subsection{Properties of Schemes}
We start out by listing some topological properties of schemes, i.e. properties that apply to the underlying space.
\begin{definition}
	Let $X = (X, \cO_X)$ be a scheme.
	\begin{enumerate}
		\item $X$ is \defineterm[scheme!connected]{connected} if $X$ is, i.e. if $X$ cannot be decomposed as the union of two disjoint proper non-empty subsets.
		\item $X$ is \defineterm[scheme!irreducible]{irreducible} if $X$ is, i.e. if $X$ cannot be written as the union of two proper closed subsets (not necessarily disjoint).
			Equivalently, $X$ is irreducible iff every open subset of $X$ is dense in $X$ iff any two non-empty open subsets of $X$ have non-empty intersection.
		\item $X$ is \defineterm[scheme!quasicompact]{quasicompact} if $X$ is, i.e. if any open cover of $X$ admits a finite subcover.
	\end{enumerate}
\end{definition}
Note that $X$ being irreducible implies $X$ is connected, but not vice-versa:
For any field $k$, the scheme $\Spec k[x_1, x_2] / (x_1 x_2)$ is connected but at the same time union $\Spec k[x_1, x_2] / (x_1) \cup \Spec k[x_1, x_2] / (x_2)$ of proper closed subsets and therefore reducible.
\begin{figure}[ht]
	\centering
	\begin{tikzpicture}[thick, scale = 2]
		\draw (-1, 0) -- (1, 0) node[below] {$x_1$};
		\draw (0, -1) -- (0, 1) node[left] {$x_2$};
	\end{tikzpicture}
	\caption{The scheme $\Spec k[x_1, x_2] / (x_1 x_2)$.}
\end{figure}
\begin{remark}
	If $X$ is quasicompact, then any closed subspace of $X$, too, is quasicompact.
	The same is not true for open subspaces in general.
\end{remark}
\begin{example}
	For every ring $A$, $\Spec A$ is quasicompact.
	% TODO put proof here or in appendix?
\end{example}
We will also need a few properties that are scheme-theoretic in nature:
\begin{definition}
	Let $X = (X, \cO_X)$ be a scheme.
	\begin{enumerate}
		\item $X$ is \defineterm[scheme!locally Noetherian]{locally Noetherian} if it admits an affine cover $X = \bigcup_{i \in I} \Spec A_i$ such that $A_i$ is a Noetherian ring.
		\item $X$ is \defineterm[scheme!Noetherian]{Noetherian} if it is locally Noetherian and quasi-compact.
		\item $X$ is \defineterm[scheme!reduced]{reduced} if $\Gamma(U, \cO_X)$ is a reduced ring for all $U \subseteq X$ open.
		\item $X$ is \defineterm[scheme!integral]{integral} if $\Gamma(U, \cO_X)$ is an integral domain for all $U \subseteq X$ open.	
	\end{enumerate}
\end{definition}
% TODO put that here
By exercise 28, $X$ being reduced is equivalent to all the stalks $\cO_{X, x}$ of $X$ being reduced rings.
The analogous statement for $X$ being integral is false, however: 
Although it holds that $X$ being integral implies all its stalks being integral, there are non-integral schemes with integral stalks, e.g. $\Spec k \sqcup \Spec k$ for $k$ a field.
Note also that integral implies reduced but not vice-versa: 
Take for instance $\Spec k[x_1, x_2] / (x_1 x_2)$.
Note also that open subset of an irreducible space are again irreducible.
\begin{proposition}\label{prp:intiffirredred}
	A scheme $(X, \cO_X)$ is integral iff it is irreducible and reduced.
\end{proposition}
Before the proof, let us prove a quick lemma.
\begin{lemma}
	Let $(X, \cO_X)$ be any scheme, $U \subseteq X$ an open subset, and $s \in \Gamma(U, \cO_X)$ a section.
	Then the set $\{x \in U \mid s_x \in \ideal{m}_x\} \subseteq U$ is closed in $U$, where $\ideal{m}_x \subset \cO_{X, x}$ is the maximal ideal.
\end{lemma}
\begin{proof}
	Write $I_s \coloneq \{x \in U \mid s_x \notin \ideal{m}_x\}$.
	We will show that $I_s$ is open in $U$.
	To that end, note that $s_x \notin \ideal{m}_x$ is to say that $s_x$ is a unit since $\cO_{X, x}$ is local.
	If $s_x^{-1} \in \cO_{X, x}$ is its inverse, then by definition of the stalk we find sections $s_V, s_V^{-1} \in \cO_X(V)$ on some open neighborhood $x \in V \subseteq U$ representing $s_x$ and $s_x^{-1}$, respectively, but then in particular we have that $s_V s_V^{-1} = 1$.
	Noting that we may take $s_V = s|_V$ we find that $s_y \notin \ideal{m}_y$ for all $y \in V$.
	In other words, $I_s$ contains an open neighborhood around each of its points and must therefore be open.
\end{proof}
\begin{proof}[Proof of Proposition \ref{prp:intiffirredred}]
	If $(X, \cO_X)$ is integral then it is reduced.
	If $X$ was not irreducible, then we could find non-empty proper open subsets $U_1, U_2 \subset X$ with $U_1 \cap U_2 = \emptyset$.
	But this implies $\Gamma(U_1 \cup U_2, \cO_X) = \Gamma(U_1, \cO_X) \times \Gamma(U_2, \cO_X)$ which is not an integral domain, contradiction.

	Conversely, assume $(X, \cO_X)$ is irreducible and reduced and let $s_1, s_2 \in \Gamma(U, \cO_X)$ be sections over some open $U \subseteq X$ with $s_1 s_2 = 0$.
	By the previous lemma, the two sets $X_i \coloneq \{x \in U \mid s_{i, x} \in \ideal{m}_x\}	\subseteq U$ ($i = 1, 2$) are closed.
	But if $0 = (s_1 s_2)_x = s_{1, x} s_{2, x}$, then we must have $s_{1, x} \in \ideal{m}_x$ or $s_{2, x} \in \ideal{m}_x$ for each $x \in U$ since $\ideal{m}_x$ is in particular a prime ideal, and this implies that $X_1 \cup X_2 = U$.
	But $X$ is irreducible, so $U$, too, is irreducible, so without loss of generality we may assume that $X_1 = U$.
	Let $\Spec A \subseteq U$ be an open affine subscheme and define $t\coloneq s_1|_{\Spec A}$.
	We then in particular have $t_x \in \ideal{m}_x$ for all $x \in \Spec A$, but unraveling the definitions this is to say that $t / 1 \in \ideal{p} A_{\ideal{p}}$ for all $\ideal{p} \in \Spec A$, so $t \in \ideal{p}$ for all $\ideal{p} \in \Spec A$, which is to say that $\ideal{p} \in \Nil A$ and therefore that $t = 0$ since $X$ and therefore $A$ is reduced.
	Thus $s_1|_{\Spec A} = 0$, so covering $U$ with affine schemes we find that $s_1 = 0$ altogether.
\end{proof}
\begin{corollary}
	If $X$ is an integral scheme, then there exists a unique \defineterm{generic point} $\eta \in X$, i.e. a point whose closure is the whole space $X$.
\end{corollary}
\begin{proof}
	Pick an affine subscheme $\Spec A \subseteq X$ and define $\eta \coloneq (0) \in \Spec A$.
	Then $\close{\{\eta\}} = \Spec A$ and by irreducibility we must already have $\close{\{\eta\}} = X$, seeing as $\Spec A$ is dense in $X$.

	It remains to show that $\eta$ is unique.
	Let thus $\eta' \in X$ be another generic point and pick an affine subscheme $\Spec A \subseteq X$ containing $\eta$.
	Since $X \setminus \Spec A$ is closed and $\close{\{\eta'\}} = X$, we must then have $\eta' \in \Spec A$.
	Assuming without loss of generality that $\eta = (0) \in \Spec A$ and identifying $\eta'$ with some prime ideal $\ideal{p} \in \Spec A$, we have $\eta \in V(\ideal{p})$, but this means $\ideal{p} = (0)$, so $\eta = \eta'$.
\end{proof}
We now come back to Noetherianness.
By definition, a scheme is locally Noetherian if it admits a cover by affine subschemes of Noetherian rings.
It is natural to ask (and to expect true) whether this already implies that any affine subscheme is one of Noetherian rings, and indeed the answer is yes, even though the proof is somewhat tedious.
\begin{proposition}
	A scheme $X$ is locally Noetherian iff for any open affine subscheme $\Spec A \subseteq X$, the ring $A$ is Noetherian.
\end{proposition}
% TODO split this proof up into multiple lemmas
\begin{proof}
	One direction of the proof is true by definition.
	Let thus $X$ be a locally Noetherian scheme and pick a cover $X = \bigcup_{i \in I} \Spec A_i$ with the $A_i$ Noetherian.
	Let $U = \Spec A \subseteq X$ be another open, affine subscheme, and let $U_i \coloneq \Spec A_i \cap U$ such that $U = \bigcup_{i \in I} U_i$.
	Since $U$ is affine, it is quasicompact, so we may reduce to a finite covering $U = \bigcup_{i = 1}^n U_i$.
	Now $U_i \subseteq \Spec A_i$ is open, so we may cover it with finitely many distinguished opens $U_i = \bigcup_{j = 1}^{k_i} \Spec A_{i, a_j}$.
	Fixing one $B \coloneq A_{i, a_j}$, we can find an element $a \in A$ such that $\Spec A_a \subseteq \Spec B$, which gives rise to a commutative diagram
	\begin{equation*}
		\begin{tikzcd}
			A 
					\ar[r]
					\ar[dr]
				& B
					\ar[d]
			\\
				& A_a
		\end{tikzcd}
	\end{equation*}
	Let $b \in B$ be the image of $a$ under the top map.
	We now claim that $\Spec A_a = \Spec B_b$ as sets, but this is clear: 
	For any prime ideal $\ideal{q} \in \Spec B$, we have $b \notin \ideal{q}$ iff $a \notin \ideal{p} \coloneq \ideal{q}^c$.
	
	More importantly, however, we also have $\Spec A_a = \Spec B_b$ \emph{as schemes}.
	To this end, we have to show that we have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
				& B
					\ar[dl]
					\ar[dr]
			\\
			A_a 
					\ar[rr, "\isom"]
				& & B_b
		\end{tikzcd}
	\end{equation*}
	But we already know that $\cO_A|_{\Spec B} \isom \cO_B$, so further restriction yields 
	\begin{equation*}
		\cO_{A_a} \isom \cO_A|_{\Spec A_a} \isom \cO_B|_{\Spec B_b} \isom \cO_{B_b}
	\end{equation*}
	so taking sections yields the claim.

	Next, we show that any ideal $\ideal{a} \subseteq A$ can be written as $\ideal{a} = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}) A_{a_i})$ where $\pi_i\colon A \to A_{a_i}$ are the canonical maps.
	Clearly $\ideal{a}$ is contained in the intersection.
	On the other hand, if $b \in \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}) A_{a_i})$ is any element, then we can write each $\pi_i(b)$ as $\pi_i(b) = b / 1 = b_i / a_i^{n_i}$ for some $b_i \in \ideal{a}$.
	Since $b_i / a_i^{n_i} = (a_i b_i) / a_i^{n_i + 1}$ and $a_i b_i \in \ideal{a}$, we may in fact assume that $\pi_i(b) = b_i / a_i^m$ for some fixed $m$ independent of $i$.
	We then find $m_1, \ldots, m_i \in \N$ such that $(b_i - a_i^m b) a_i^{m_i} = 0$ for all $i$, and setting $M \coloneq \max \{m_1, \ldots, m_n\}$ we obtain $(b_i - a_i^m b) a_i^M = 0$.
	But this is to say that $a_i^{m + M} b \in \ideal{a}$, so since $\Spec A = \bigcup_{i = 1}^n \Spec A_{a_i}$, which is the same as saying that $\bigcap_{i = 1}^n V(a_i) = V(a_1, \ldots, a_n) = \emptyset$, we see that we must have $(a_1, \ldots, a_n) = (1)$, which in turn is the case iff $(a_1^k, \ldots, a_n^k) = (1)$ for any $k > 0$.
	Applying this to $k = m + M$, we obtain that 1 can be expressed as a linear combination
	\begin{equation*}
		1 = \sum_{i = 1}^n \beta_i a_i^k
	\end{equation*}
	for some $\beta_i \in A$ and multiplying both sides with $b$ then yields
	\begin{equation*}
		b = \sum_{i = 1}^n \beta_i \underbrace{a_i^k b}_{\in \ideal{a}}
	\end{equation*}
	so $b \in \ideal{a}$, as we set out to show.

	To finish up the proof, let $\ideal{a}_1 \subseteq \ideal{a}_2 \subseteq \ldots$ be an ascending chain of ideals of $A$.
	We then obtain ascending chains $\pi_i(\ideal{a}_1) A_{a_i} \subseteq \pi_i(\ideal{a}_2) A_{a_i} \subseteq \ldots$ of ideals of $A_{a_i}$ for all $i = 1, \ldots, n$.
	But the $A_{a_i}$ are Noetherian, so for each there exists some $N_i > 0$ with $\pi_i(\ideal{a}_{N_i}) A_{a_i} = \pi_i(\ideal{a}_{N_i + 1}) A_{a_i} = \ldots$.
	Then putting $N \coloneq \max \{N_1, \ldots, N_n\}$, we find that $\pi_i(\ideal{a}_N) A_{a_i} = \pi_i(\ideal{a}_{N + 1}) A_{a_i} = \ldots$ for all $i$, so 
	\begin{equation*}
		\ideal{a}_N = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}_N) A_{a_i}) = \bigcap_{i = 1}^n \pi_i^{-1}(\pi_i(\ideal{a}_{N + 1}) A_{a_i}) = \ideal{a}_{N + 1} = \ldots
	\end{equation*}
	so $A$ is Noetherian.
\end{proof}

\subsection{Open and Closed Subschemes}
Recall that if $U \subseteq X$ is an open subset of a scheme $(X, \cO_X)$, then $(U, \cO_X|_U)$ is an open subscheme of $X$ (in particular it is again a scheme).
\begin{remark}
	If $\Spec B \subseteq \Spec A$ is an open affine subscheme of an affine scheme, then $\Spec B = \bigcup_{i = 1}^n \Spec A_{a_i}$ for suitable $a_1, \ldots, a_n \in A$.
	If $b_i$ is the image of $a_i$ under the associated ring homomorphism $A \to B$, then $\Spec A_{a_i} = \Spec B_{b_i}$ (this we showed in the proof of the preceding proposition).
\end{remark}
\begin{remark}
	An open subscheme of an affine scheme need not again be affine.
	For instance, $\A^n_k \setminus \{0\} \subset \A^n_k$ is open but not affine if $n \geq 2$ for any field $k$.
\end{remark}
Closed subschemes are not quite as straightforward.
In fact, we can give two separate definitions which will turn out to agree.
\begin{definition}
	A \defineterm{closed subscheme} of a scheme $(X, \cO_X)$ is an equivalence class of morphisms of schemes $(i, i^\sharp)\colon (Z, \cO_Z) \to (X, \cO_X)$ such that $i\colon Z \incl X$ is a closed embedding and $i^\sharp\colon \cO_X \to i_* \cO_Z$ is a surjection, where $(i, i^\sharp)$ is equivalent to $(i', i'^\sharp)\colon (Z', \cO_{Z'}) \to (X, \cO_X)$ if there is a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
			(Z, \cO_Z)
					\ar[rr, "\isom"]
					\ar[dr]
				& & (Z', \cO_{Z'})
					\ar[dl]
			\\
				& (X, \cO_X)
		\end{tikzcd}
	\end{equation*}
	with the top map an isomorphism.
\end{definition}
\begin{definition}
	A \defineterm{closed subscheme} of a scheme $(X, \cO_X)$ consists of a closed subset $i\colon Z \incl X$ and structure sheaf $\cO_Z$ such that $(Z, \cO_Z)$ is a scheme, together with a sheaf of ideals $\theta_Z \subseteq \cO_X$ such that $\cO_X / \theta_Z \isom i_* \cO_Z$ (here the quotient is a quotient of sheaves).
\end{definition}
\begin{proposition}
	Let $A$ be a ring.
	Then there exists a natural bijection
	\begin{equation*}
		\{\ideal{a} \subseteq A \text{ ideal}\} \leftrightarrow \{Z \subseteq \Spec A \text{ closed subscheme}\}
	\end{equation*}
\end{proposition}
\begin{proof}
	Given an ideal $\ideal{a} \subseteq A$, consider $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) \subseteq (\Spec A, \cO_A)$.
	Then $\Spec A / \ideal{a} = V(\ideal{a}) \subseteq \Spec A$ is closed and the map $\cO_A \surj i_* \cO_{A / \ideal{a}}$ surjective since for all prime ideals $\ideal{p} \in \Spec A$ containing $\ideal{a}$, the map $A_{\ideal{p}} \surj (A / \ideal{a})_{\ideal{p}} = A_{\ideal{p}} / \ideal{a} A_{\ideal{p}}$ is.
	Conversely, if $(Z, \cO_Z) \subseteq (\Spec A, \cO_A)$ is a closed subscheme, we obtain an ideal $\ideal{a} \coloneq \ker(\Gamma(\Spec A, \cO_A) \to \Gamma(Z, \cO_Z))$.

	We now have to show these two constructions are mutually inverse to each other.
	One direction is easy: 
	Starting with an ideal $\ideal{a} \subseteq A$, we have 
	\begin{equation*}
		\ideal{a}_{\Spec A / \ideal{a}} = \ker\big(\underbrace{\Gamma(\Spec A, \cO_A)}_{= A} \to \underbrace{\Gamma(\Spec A / \ideal{a}, \cO_{A / \ideal{a}})}_{= A / \ideal{a}}\big) = \ideal{a}
	\end{equation*}
	On the other hand, if we start out with a closed subscheme $(Z, \cO_Z) \incl (\Spec A, \cO_A)$, we obtain an ideal $\ideal{a}_Z \coloneq \ker(\Gamma(\Spec Z, \cO_Z) \to \Gamma(\Spec A, \cO_A))$, and from this the closed subscheme $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) \incl (\Spec A, \cO_A)$.
	As a first step to showing $(\Spec A / \ideal{a}, \cO_{A / \ideal{a}}) = (Z, \cO_Z)$, we will show that $Z \subseteq V(\ideal{a})$ as sets.
	Suppose there exists some prime ideal $\ideal{p} \in Z \setminus V(\ideal{a}_Z)$, i.e. $\ideal{p} \in Z$ but $\ideal{a}_Z \nsubseteq \ideal{p}$.
	There is then some $a \in \ideal{a}_Z$ with $a \notin \ideal{p}$.
	We then have a commutative diagram
	\begin{equation*}
		\begin{tikzcd}[sep = large]
			\textcolor{darkgray}{a} 
					\ar[rrr, mapsto, darkgray]
					\ar[ddd, mapsto, darkgray]
				&[-3.2em] & &[-3.2em] \textcolor{darkgray}{0}
					\ar[ddd, mapsto, darkgray]
			\\[-2.5em]
				& A
					\ar[r]
					\ar[d]
				& \Gamma(Z, \cO_Z)
					\ar[d]
			\\
				& A_{\ideal{p}}
					\ar[r]
				& \cO_{Z, \ideal{p}}
			\\[-2.5em]
			\textcolor{darkgray}{a_{\ideal{p}}}
					\ar[rrr, mapsto, darkgray]
				& & & \textcolor{darkgray}{0}
		\end{tikzcd}
	\end{equation*}
	But $a_{\ideal{p}}$ must lie in $A_{\ideal{p}}^*$ since $a \notin \ideal{p}$ and therefore get mapped to a unit of $\cO_{Z, \ideal{p}}$, contradiction.
	Hence $Z \subseteq V(\ideal{a})$.

	Consider now the inclusion $j\colon \Spec A / \ideal{a}_Z \incl \Spec A$ and the induced map $j^\sharp\colon \cO_A \to j_* \cO_{A / \ideal{a}_Z}$.
	We get an induced map $g\colon j_* \cO_{A / \ideal{a}_Z} \to i_* \cO_Z$ making the diagram
	\begin{equation*}
		\begin{tikzcd}[column sep = tiny]
			\cO_A 
					\ar[rr, two heads, "j^\sharp"]
					\ar[dr, two heads, swap, "i^\sharp"]
				& & j_* \cO_{A / \ideal{a}_Z}
					\ar[dl, "g"]
			\\
				& i_* \cO_Z
		\end{tikzcd}
	\end{equation*}
	commute iff the restriction $i^\sharp|_{\ker j^\sharp}$ is trivial.
	This condition we can check on stalks.
	But for $\ideal{p} \in Z$, $j^\sharp_{\ideal{p}}$ is the quotient map $\cO_{A, \ideal{p}} = A_{\ideal{p}} \surj A_{\ideal{p}} / \ideal{a}_Z A_{\ideal{p}} = \cO_{A / \ideal{a}_Z, \ideal{p}}$ so $\ker j^\sharp_{\ideal{p}} = \ideal{a}_Z A_{\ideal{p}}$, and $i^\sharp|_{\ideal{a}_Z A_{\ideal{p}}} = 0$, so $g$ exists.
	Note also that $g$ is surjective since $j^\sharp$ and $i^\sharp$ are.
	We may thus assume that $(\Spec A, \cO_Z) = (\Spec A / \ideal{a}_Z, \cO_{A / \ideal{a}_Z})$.
	%We may thus replace the inclusion $(Z, \cO_Z) \incl (\Spec A, \cO_A)$ by $(Z, \cO_Z) \incl (\Spec A / \ideal{a}_Z, \cO_{A / \ideal{a}_Z})$.
	% and assume without loss of generality that $A = \Gamma(\Spec A, \cO_A)

	We now show that $Z = \Spec A$ as schemes.
	Since $Z \subset \Spec A$ is closed, there are elements $\{a_i \in A \mid i \in I\}$ where $I$ is some index set such that $Z = V((a_i)_{i \in I})$.
	Pick some $a = a_i$.
	Since $\Spec A$ is quasi-compact and $Z \subseteq \Spec A$ is closed, it, too, is quasi-compact and can therefore be covered with finitely many open affine subschemes $Z = \bigcup_{j = 1}^n \Spec B_i$.
	The maps $A \incl \Gamma(Z, \cO_Z) \to \cO_Z(\Spec B_i) = B_i$ take the element $a$ to $b_i$, so since $\Spec B_i \subseteq Z \subseteq V(a)$, we find that all prime ideals $\ideal{p} \in \Spec B_i$ must contain $b_i$, i.e. $b_i$ is nilpotent.

	TODO: Complete proof.
\end{proof}

\section{Fibre Products}
\begin{definition}
	Fix a scheme $S \in \Sch$.
	In this section, we will consider \defineterm[S-scheme@$S$-scheme]{$S$-schemes}, i.e. elements of the slice category $\Sch_{/ S}$ of schemes over $S$.

	When $S = \Spec k$ for $k$ a field, we will simply speak of $k$-schemes and write $\Sch_{/ k} \coloneq \Sch_{/ \Spec k}$.
\end{definition}
Note that $\Sch_{/ \Spec \Z} \isom \Sch$ since $\Spec \Z$ is terminal in $\Sch$.

In this section we will be interested in studying products in $\Sch_{/ S}$, or equivalently pullbacks (or \defineterm[fibre product]{fibre products}) in $\Sch$.

As a first step, let us treat the case that all involved schemes are affine.
\begin{proposition}
	The inclusion $\AffSch \incl \Sch$ preserves arbitrary limits, in particular pullbacks.
	Moreover $\AffSch$ has all pullbacks, and the pullback of a cospan $\Spec A \rightarrow \Spec C \leftarrow \Spec B$ in $\AffSch$ is given by $\Spec A \tensor_C B$.
\end{proposition}
\begin{proof}
	The first statement is an immediate consequence of the fact that the inclusion admits a left adjoint, see Proposition \ref{prp:affinclleftadj}.
	The second follows from the equivalence $\AffSch \simeq \op{\CRing}$ of Remark \ref{prp:sch:ringaff}.
\end{proof}
Before moving on to the general proof, let us discuss some applications and properties.
\begin{remark}
	Let $X$ be an $S$-scheme, $Z$ a $T$-scheme, and $Y$ both an $S$- and $T$-scheme.
	As for pullbacks in any category, $X \times_S Y$ is unique up to unique isomorphism.
	Also, there is a unique isomorphism $(X \times_S Y) \times_T Z \isom X \times_S (Y \times_T Z)$ which commutes with the structure maps.
\end{remark}
\begin{example}
	Let $k$ be a field.
	We will usually write $X \times_k Y$ in place of $X \times_{\Spec k} Y$ for $X, Y$ two $k$-schemes.
	Then we have $\A^n_k \times_k \A^m_k \isom \A^{n + m}_k$, seeing as $k[x_1, \ldots, x_n] \tensor_k k[y_1, \ldots, y_m] \isom k[x_1, \ldots, x_n, y_1, \ldots, y_m]$.

	Importantly, note, however, that $|\A^n_k \times_k \A^m_k| \neq |\A^n_k| \times |\A^m_k|$ in general (take $n = m = 1$).
\end{example}
\begin{example}\label{epl:sch:fpR}
	Let $X = Y = \Spec \C$ considered as $\R$-schemes.
	Then
	\begin{align*}
		X \times_\R Y &= \Spec \C \tensor_\R \C \\
					  &\isom \Spec \R[x] / (x^2 + 1) \tensor_\R \C \\
					  &\isom \Spec \C[x] / (x^2 + 1) \\
					  &\isom \Spec \C[x] / (x + i)(x - 1) \\
					  &\isom \Spec \C \times \C
	\end{align*}
	thus $|X \times_\R Y|$ has exactly two points while $|X| \times |Y|$ has one.
	In particular, there is no obvious natural map $|X| \times |Y| \to |X \times_\R Y|$ one could write down!
\end{example}
\begin{definition}
	Let $Y$ be a scheme, $y \in Y$ a point, and define the \defineterm{residue field} $k(y) \coloneq \cO_{Y, y} / \ideal{m}_y$ of $y$ where $\ideal{m}_y \subset \cO_{Y, y}$ is the maximal ideal.
	We then have a morphism of schemes $\Spec k(y) \to Y$ taking the unique point of $\Spec k(y)$ to $y$ and on structure sheaves being given by the composite 
	\begin{equation*}
		\cO_Y \to \cO_{Y, y} \surj k(y) \isom i_* \cO_{k(y)}
	\end{equation*}
	Let now $f\colon X \to Y$ be a morphism of schemes.
	The \defineterm{fibre} of $f$ over $y$ is the fibre product
	\begin{equation}\label{diag:sch:fibre}
		\begin{tikzcd}
			X_y \coloneq X \times_Y \Spec k(y) 
					\ar[r]
					\ar[d, swap, "p"]
				& \Spec k(y)
					\ar[d]
			\\
			X
					\ar[r, "f"]
				& Y
		\end{tikzcd}
	\end{equation}
\end{definition}
\begin{definition}
	If $Y$ is an integral scheme, then it has a unique generic point $\eta \in Y$.
	If $f\colon X \to Y$ is a morphism of schemes, we define the \defineterm{generic fibre} $X_\eta$ of $f$ to be that over $\eta$.
	Similarly, a \defineterm{closed fibre} of $f$ is any fibre over a closed point $y \in Y$.
\end{definition}
\begin{example}
	If $A$ is a DVR, then $\Spec A$ consists of exactly two points: $\eta = (0)$ and $t = \ideal{m}$ where $\ideal{m} \subset A$ is the maximal ideal.
	A morphism $f\colon X \to \Spec A$ thus has exactly two fibres: one closed and one generic.
	By definition, these come with morphisms
	\begin{align*}
		X_\eta &\to \Spec k(\eta) = \Spec Q(A) \;\;\text{and}\\
		X_t &\to \Spec k(t) = \Spec A / \ideal{m}
	\end{align*}
	As a concrete example, consider $A = \Z_{(p)}$ for some prime $p$.
	Then $k(t) = \F_p$ and $k(\eta) = \Q$, so $X_\eta$ is a scheme over $\Q$ and $X_t$ is a scheme over $\F_p$.
	Note in particular that the two residue fields have different characteristics.

	On the other hand, if $A = k\llbracket x\rrbracket$, then $k(\eta) = k((x))$ and $k(t) = k$ which are of the same characteristic.
\end{example}
We will now prove the existence of fibre products.
\begin{proposition}
	$\Sch$ admits all fibre products.
\end{proposition}
\begin{proof}
	TODO.
\end{proof}
We now resume talking about fibres.
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then there is a homeomorphism from $|X_y|$ to $f^{-1}(Y)$.
\end{proposition}
\begin{proof}
	The commutativity of diagram \eqref{diag:sch:fibre} implies that $p$ lands in $f^{-1}(y)$, so we have a continuous map $g\colon |X_y| \to f^{-1}(y)$.
	To see that $g$ is surjective, pick any element $x \in f^{-1}(y)$ and consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(x)
					\ar[dr, dashed, "\exists!"]
					\ar[drr, bend left = 20, "\Spec \phi"]
					\ar[ddr, bend right = 20]
			\\[-1em]
				&[-2.2em] X_y
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& \Spec k(y) 
					\ar[d]
			\\
				& X
					\ar[r, swap, "f"]
				& Y
		\end{tikzcd}
	\end{equation*}
	where $\phi$ is the induced map on residue fields
	\begin{equation*}
		\begin{tikzcd}
			\cO_{Y, y} 
					\ar[r, "f^\sharp"]
					\ar[d, two heads]
				& \cO_{X, x}
					\ar[d, two heads]
			\\
			k(y)
					\ar[r, dashed, swap, "\phi"]
				& k(x)
		\end{tikzcd}
	\end{equation*}
	using that $f^\sharp$ is local.
	Thus $x \in \img g$.

	For injectivity, we may without loss of generality assume that $X = \Spec B$ and $Y = \Spec A$ so that $y$ corresponds to some prime ideal $\ideal{p} \in \Spec A$ and $X_y = \Spec k(Y) \tensor_A B$.
	Seeing as $k(y) = A_{\ideal{p}} / \ideal{p} A_{\ideal{p}}$ in this case, we have $X_y = \Spec S^{-1} B / \ideal{p} B$ where $S = A \setminus \ideal{p}$.
	Then 
	\begin{align*}
		|X_y| &= \{\ideal{q} \in \Spec B \mid \underbrace{\ideal{p} B \subseteq \ideal{q}}_{\Leftrightarrow \ideal{p} \subseteq \ideal{q}^c} \text{ and } \ideal{q}^c \cap S = \emptyset\} \\
			  &= \{\ideal{q} \in \Spec B \mid \ideal{q}^c \subseteq \ideal{p}\} \\
			  &= f^{-1}(y)
	\end{align*}
	so $g$ is injective.

	% TODO explain this better!
	Finally, to see that $g^{-1}\colon f^{-1}(y) \to |X_y|$ is continuous, we note that we have a basis for the topology on $X_y$ consisting of sets of the form $D(b / s)$ with $b / s \in S^{-1} B$, i.e. they are of the form $D(b) \cap f^{-1}(y)$.
\end{proof}

\subsection{Base Change}
Let $\phi\colon R \to S$ be a morphism of schemes.
We define a functor $\Sch_{/ S} \to \Sch_{/ R}$, $(X \xto{f} S) \mapsto (X_R \xto{g} R)$ through the pullback diagram
\begin{equation*}
	\begin{tikzcd}
		X_R \coloneq X \times_S R
				\ar[r]
				\ar[d, swap, "g"]
				\ar[dr, phantom, "\lrcorner" very near start]
			& X
				\ar[d, "f"]
		\\
		R 
				\ar[r, swap, "\phi"]
			& S
	\end{tikzcd}
\end{equation*}
on objects.
If $\alpha\colon X \to Y$ is a morphism of $S$-schemes, we then define $\alpha_R\colon X_R \to Y_R$ via the commutative cube
\begin{equation*}
	\begin{tikzcd}
		X_R
				\ar[rr]
				\ar[dd, swap, "g"]
				\ar[dr, dashed, swap, "\alpha_R"]
			& & X
				\ar[dd, swap, "f\;" near start]
				\ar[dr, "\alpha"]
		\\
			& Y_R
				\ar[rr, crossing over]
			& & Y
				\ar[dd]
		\\
		R 
				\ar[rr, "\phi" near end]
				\ar[dr, equals]
			& & S
				\ar[dr, equals]
		\\
			& R 
				\ar[rr, "\phi"]
				\ar[from = uu, crossing over]
			& & S
	\end{tikzcd}
\end{equation*}
induced by the universal property of the pullback.
It is easy to check that this in fact defines a functor.
\begin{definition}
	Let $K / k$ be a field extension and $X$ a $k$-scheme.
	We define the set of \defineterm[K-rational point@$K$-rational point]{$K$-rational points} $X(K)$ of $X$ to be
	\begin{equation*}
		X(K) \coloneq \Sch_{/ k}(\Spec K, X)
	\end{equation*}
\end{definition}
% TODO something about Galois groups?
Observe that there is a bijection between $X(K)$ and the $K$-rational points $X_K(K)$ of the base change along $\Spec K \to \Spec k$:
This follows from the universal property of the pushout in the diagram
\begin{equation*}
	\begin{tikzcd}
		\Spec K
				\ar[dr, dashed, "\exists!"]
				\ar[drr, bend left = 20]
				\ar[ddr, equals, bend right = 18]
		\\[-1em]
			&[-2.2em] X_K
				\ar[r]
				\ar[d]
				\ar[dr, phantom, "\lrcorner" very near start]
			& K
				\ar[d]
		\\
			& \Spec K 
				\ar[r]
			& \Spec k
	\end{tikzcd}
\end{equation*}
We can combine this with our discussion of fibres:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes, let $y \in Y$ be a point with residue field $k(y)$, and fix an algebraic closure $\close{k(y)}$ of $k(y)$.
	The \defineterm[fibre!geometric]{geometric fibre} $X_{\close{y}}$ of $X$ over $y$ is defined by the pullback
	\begin{equation*}
		\begin{tikzcd}
			X_{\close{y}}
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X_y
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X
					\ar[d]
			\\
			\Spec \close{k(y)}
					\ar[r]
				& \Spec k(y)
					\ar[r]
				& Y
		\end{tikzcd}
	\end{equation*}
\end{definition}
Note that by pullback pasting the outer rectangle is also a pullback square.
\begin{example}
	Fix a field $k$ and an algebraic closure $\close{k}$ of $k$ and consider the $k$-scheme $\A^1_k$.
	Since $\A^1_k$ is already the fibre of the unique morphism $\A^1_k \to \Spec k = \{(0)\}$, its geometric fibre is given by
	\begin{equation*}
		\begin{tikzcd}
			\mathllap{(\A^1_k)_{\close{(0)}} =\ } \A^1_{\close{k}} 
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& \A^1_k
					\ar[d]
			\\
			\Spec \close{k}
					\ar[r]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
	In particular, note that $\A^1_k = \{(0)\} \cup \{(f) \mid f \in k[x] \text{ irreducible}\}$ whereas $\A^1_{\close{k}} = \{0\} \cup \{(x - \lambda) \mid \lambda \in \close{k}\} \leftrightarrow \{(0)\} \cup \close{k}$: 
	Unless $k = \close{k}$ already, the geometric fibre has fewer points than the ordinary fibre.
\end{example}
\begin{example}
	Let $k$ be a field and $\close{k}$ an algebraic closure of $k$.
	Then the $\close{k}$-rational points of $\A^n_k$ are in bijection with $k^n$ for any $n$ since we have
	\begin{equation*}
		\A^n_k(\close{k}) = \A^n_{\close{k}}(\close{k}) \leftrightarrow k^n
	\end{equation*}
\end{example}
\begin{example}
	Consider an $\Z_{(p)}$-scheme $X \to \Spec \Z_{(p)}$ for some prime number $p$.
	Then $\Spec \Z_{(p)} = \{\eta = (0), t = (p)\}$, so we have two fibres $X_\eta \to \Spec k(\eta) = \Spec \Q$ and $X_t \to \Spec k(t) = \Spec \F_p$ and therefore also two geometric fibres $X_{\close{\eta}} \to \Spec \close{\Q}$ and $X_{\close{t}} \to \Spec \close{\F_p}$.
\end{example}
Two warnings are in order: 
First, note that base change does not translate to underlying spaces.
In other words, the square at the left being a pullback does not imply the square at the right is a pullback in the following diagram:
\begin{equation*}
	\begin{tikzcd}
		X_R
				\ar[r]
				\ar[d]
				\ar[dr, phantom, "\lrcorner" very near start]
			& X
				\ar[d]
		\\
		R 
				\ar[r]
			& S
	\end{tikzcd}
	\qquad\qquad
	\begin{tikzcd}
		{|X_R|}
				\ar[r]
				\ar[d]
			& {|X|}
				\ar[d]
		\\
		{|R|}
				\ar[r]
			& {|S|}
	\end{tikzcd}
\end{equation*}
Consider for instance $X = R = \Spec \C$ and $S = \Spec \R$ so that $X_R = \Spec \C \times_{\Spec \R} \Spec \C \isom \Spec \C[x] / (x + i)(x - i)$, i.e. $|X_R| = \{(x - i), (x + i)\}$ whereas $|X| \times_{|S|} |R|$ is a singleton (cf. example \ref{epl:sch:fpR}).
In particular, note that connectedness is not preserved under fibre products.

The other warning concerns base change along endomorphisms.
\begin{definition}
	Let $k$ be a field and $X$ a $k$-scheme.
	Given an automorphism $\sigma \in \Aut(k)$, define the \defineterm[scheme!conjugate]{conjugate $k$-scheme} $X^\sigma$ of $X$ associated to $\sigma$ as the pullback
	\begin{equation*}
		\begin{tikzcd}
			X^\sigma
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& X
					\ar[d]
			\\
			\Spec k
					\ar[r, swap, "\Spec \sigma"]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
\end{definition}
Note that $X \isom X^\sigma$ as schemes, but generally not as $k$-schemes:
\begin{example}
	Consider $X = \Spec \R$ viewed as a $\Q\big(\sqrt{2}\big)$-scheme and let $\sigma\colon \Q\big(\sqrt{2}\big) \to \Q\big(\sqrt{2}\big)$ be the automorphism sending $\sqrt{2}$ to $-\sqrt{2}$.
	Then $X^\sigma \nisom X$ as $\Q\big(\sqrt{2}\big)$-schemes:
	There is no automorphism of $\R$ taking $\sqrt{2}$ to $-\sqrt{2}$ (in fact, the only automorphism of $\R$ is the identity).
\end{example}
% TODO \P^1_C example

\section{Morphisms of Schemes}
We will now discuss a number of properties of morphisms of schemes.
To start, we have a number of purely topological properties:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is\textellipsis{}
	\begin{enumerate}
		\item \defineterm[morphism of schemes!open]{open}/\defineterm[morphism of schemes!closed]{closed} if $|f|\colon |X| \to |Y|$ is, 
		\item \defineterm[morphism of schemes!dominant]{dominant} if $f(|X|)$ is dense in $|Y|$,
		\item \defineterm[morphism of schemes!quasi-compact]{quasi-compact} if for all quasi-compact open subsets $V \subseteq Y$, $f^{-1}(V)$ is quasi-compact, and
		\item \defineterm[morphism of schemes!quasi-finite]{quasi-finite} all fibres $f^{-1}(y)$ for $y \in Y$ are finite.
	\end{enumerate}
\end{definition}
Note that if $Y$ is integral, then $f$ is dominant iff $\eta \in \img f$.
% TODO explain?
Also note that it is enough to check quasi-compactness on an open affine cover of $Y$.
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is an \defineterm[morphism of schemes!open immersion]{open/closed immersion}\index{morphism of schemes!closed immersion} if $f$ is an isomorphism onto an open (respective, closed) subscheme of $Y$.
\end{definition}
We also have some purely scheme-theoretic properties:
\begin{definition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	We say that $f$ is\textellipsis{}
	\begin{enumerate}
		\item \defineterm[morphism of schemes!locally of finite type]{locally of finite type} if there exists an open affine covering $Y = \bigcup_i \Spec A_i$ of $Y$ and open affine covering $f^{-1}(\Spec A_i) = \bigcup_j \Spec B_{ij}$ of $f^{-1}(\Spec A_i)$ such that each $B_{ij}$ is a finite type $A_i$-algebra,
		\item \defineterm[morphism of schemes!of finite type]{of finite type} if it is locally of finite type and there are only finitely many $B_{ij}$ for each $i$ in the preceding definition,
		\item \defineterm[morphism of schemes!affine]{affine} there exists an open affine covering $Y = \bigcup_i \Spec A_i$ such that $f^{-1}(\Spec A_i)$ is affine, and
		\item \defineterm[morphism of schemes!finite]{finite} if it is affine and $B_i \coloneq f^{-1}(\Spec A_i)$ is a finite $A_i$-module for all $i$.
	\end{enumerate}
\end{definition}
We will now discuss some \enquote{standard tricks} when working with properties of morphisms of schemes.
\begin{proposition}\label{prp:sch:basicloc}
	If $f\colon \Spec B \to \Spec A$ is a morphism induced by a morphism $\phi\colon A \to B$ of rings, then $f^{-1}(\Spec A_s) = \Spec B_t$ for all $s \in A$ and $t \in B$ with $\phi(s) = t$.
\end{proposition}
\begin{proof}
	Since $\Spec A_s = D(s) = \{\ideal{p} \in \Spec A \mid s \notin \ideal{p}\}$ and $\Spec B_t = D(t) = \{\ideal{q} \in \Spec B \mid t \notin \ideal{q}\}$ and $f(\ideal{q}) = \phi^{-1}(\ideal{q})$ for all $\ideal{q} \in \Spec B$, it suffices to observe that $s \notin \phi^{-1}(\ideal{q})$ iff $t \notin \ideal{q}$.
\end{proof}
\begin{proposition}
	Let $\Spec A, \Spec B \subseteq X$ be affine subschemes of a scheme $X$. 
	Then $\Spec A \cap \Spec B$ can be covered by open affines $U \subseteq \Spec A \cap \Spec B$ of the form $U = D(s) = \Spec A_s = D(t) = \Spec B_t$ for suitable $s \in A$, $t \in B$.
\end{proposition}
\begin{proof}
	Writing $V \coloneq \Spec A \cap B$, consider a point $x \in V$.
	There then exists some $t_1 \in B$ with $x \in D(t_1) = \Spec B_{t_1} \subseteq V$ since the distinguished open subsets form a basis.
	We can then further find some $s \in A$ with $x \in D(s) = \Spec A_s \subseteq \Spec B_{t_1} \subseteq V$.
	We thus have ring homomorphisms $A \xto{f} B_{t_1} \xto{g} A_s$.
	Applying the last proposition to $g$, we find that $g^{-1}(\Spec A_s) = D(t_2) = \Spec (B_{t_1})_{t_2}$ for some $t_2 \in B$.
	% TODO why?
	On the other hand $f^{-1}(\Spec A_s) = \Spec A_s$, so since we may assume without loss of generality that $t_2 \in \img(B \to B_{t_1})$, we finally obtain that $\Spec (B_{t_1})_{t_2} = \Spec B_{t_1 t_2}$, so for $t = t_1 t_2$ we have $\Spec A_s = \Spec B_t \subseteq V$ as desired.
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes where $Y = \Spec A$ is affine.
	If $X = \bigcup_{i \in I} \Spec B_i$ is a covering of $X$ by open affine subschemes, then $f^{-1}(\Spec A_s) = \Spec (B_i)_t$ for all $s \in A$, $t_i \in B_i$ such that the ring map associated to the restriction $f|_{\Spec B_i}$ takes $s$ to $t_i$.
\end{proposition}
\begin{proof}
	This is a direct consequence of proposition \ref{prp:sch:basicloc}.
\end{proof}
\begin{proposition}
	Assume $\phi\colon A \to B$ is a ring homomorphism and $b_i \in B$ be a collection of elements such that $(b_i \mid i \in I) = B$.
	If each $B_{b_i}$ is of finite type over $A$, then $B$, too, is of finite type over $A$.
\end{proposition}
\begin{proof}
	Without loss of generality we may assume that there are only finitely many $b_i$, say $b_1, \ldots, b_n$.
	Since $(b_1, \ldots, b_n) = B$, we may find coefficients $a_i \in B$ such that
	\begin{equation*}
		\sum_{i = 1}^n a_i b_i = 1
	\end{equation*}
	By assumption, we may write every $B_{b_i}$ as $B_{b_i} = A[\beta_{i, 0}, \ldots, \beta_{i, N_i}]$ where each $\beta_{i, j}$ is of the form $\beta_{i, j} = \alpha_{i, j} / b_i^{k_{i, j}}$ with $\alpha_{i, j} \in B$.
	Letting $B'$ be the $A$-subalgebra of $B$ generated by all the $a_i, b_i$, and $\alpha_{i, j}$, we obtain another algebra of finite type over $A$.
	Now since $(b_1, \ldots, b_n) = B$, we have for all $M > 0$ that $(b_1^M, \ldots, b_n^M) = B$ as well, so there exist $c_i \in B$ with
	\begin{equation*}
		\sum_{i = 1}^n c_i b_i^M = 1
	\end{equation*}
	so for all $b \in B$ we find that $b = \sum_{i = 1}^n c_i (b b_i^M)$.
	Noting then that for $m \gg 0$ we have $b b_i^M \in B$ since $b$ maps to some polynomial in the $\beta_{i, j}$ under the map $B \to B_{b_i}$ and $b_i^M \beta_{i, j}$ lies in the subalgebra generated by the $\alpha_{i, j}$ for $M \gg 0$ by definition, we find that $B = B'$ and therefore that $B$ is of finite type over $A$. 
\end{proof}
\begin{proposition}
	Let $X$ be a scheme and let $A \coloneq \Gamma(X, \cO_X)$.
	Then $X$ is affine, i.e. $X = \Spec A$, iff there exist $a_1, \ldots, a_n \in A$ such that $(a_i) = A$ and the $X_{a_i} \coloneq \{x \in X \mid a_{i, x} \in \cO_{X, x}^*\}$ are affine.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	If $\phi\colon A \to B$ is a ring homomorphism and $\{s_i\}_{i \in I}$ is a family of elements of $A$ such that $(s_i \mid i \in I) = A$.
	Letting $t_i \coloneq \phi(s_i)$, then we have that if $B_{t_i}$ is of finite type over $A_{s_i}$ for all $i$, then $B$ itself is of finite type over $A$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is locally of finite type iff for all $\Spec B \subseteq f^{-1}(\Spec A)$ where $\Spec A \subseteq Y$ is affine, $B$ is of finite type over $A$.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is affine iff for all $\Spec A \subseteq Y$ affine, $f^{-1}(\Spec A) \subseteq X$ is affine.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
This has the following immediate consequence:
\begin{corollary}
	If $X \to \Spec A$ is an affine morphism of schemes, then $X$ is affine.
\end{corollary}
\begin{corollary}
	A morphism $f\colon X \to Y$ of schemes is finite iff for all $\Spec A \subseteq Y$ open affine, the preimage $\Spec B = f^{-1}(\Spec A) \subseteq X$ is affine with $B$ of finite type over $A$.
\end{corollary}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	If $f\colon X \to Y$ is a finite morphism of schemes, then $f$ is closed and quasi-finite.
\end{proposition}
\begin{proof}
	TODO
\end{proof}

\subsection{Separated and Proper Morphism}
\begin{definition}
	A morphism $f\colon X \to Y$ of schemes is \defineterm[morphism of schemes!separated]{separated} if the diagonal $\Delta_f = \Delta_{X / Y}\colon X \to X \times_Y X$ defined by the pullback
	\begin{equation*}
		\begin{tikzcd}
			X
					\ar[dr, dashed, "\Delta_f" near end]
					\ar[drr, equals, bend left = 20]
					\ar[ddr, equals, bend right = 18]
			\\[-.7em]
				&[-1.5em] X \times_Y X
					\ar[r]
					\ar[d]
					\ar[dr, phantom, "\lrcorner" very near start]
				& X
					\ar[d, "f"]
			\\
				& X
					\ar[r, swap, "f"]
				& Y
		\end{tikzcd}
	\end{equation*}
	is a closed immersion.
\end{definition}
\begin{example}
	Morphisms $f\colon \Spec B \to \Spec A$ between affine schemes are always separated: 
	$f$ corresponds to a ring map $A \to B$, and $\Delta_f$ to the ring map $\phi\colon B \tensor_A B \surj B$, whence $\Delta_f$ is an isomorphism from $\Spec B$ onto $V(\ker \phi) \subseteq \Spec(B \tensor_A B)$.

	Similarly, every affine morphism is separated, and so are open and closed immersions.
\end{example}
In fact, we can weaken the condition of $\Delta_f$ being a closed immersion somewhat:
\begin{proposition}
	A morphism $f\colon X \to Y$ of schemes is separated iff $\Delta(X) \subseteq X \times_Y X$ is a closed subset.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{definition}
	A morphism $f\colon X \to Y$ of schemes is \defineterm[morphism of schemes!proper]{proper} if it is separated, of finite type, and \defineterm[morphism of schemes!universally closed]{universally closed}, i.e. all pullbacks of $f$ are closed maps.
\end{definition}
\begin{example}
	The map $\A^1_k \to \Spec k$ where $k$ is a field is closed but not universally so.
	On the other hand, the map $\P^1_k \to \Spec k$ is proper.
	% TODO proof
\end{example}
\begin{example}
	Any finite map is proper:
	Being finite implies being affine, which implies being separated, as we saw above.
	Of course being finite is a stronger condition than being of finite type, and finite maps are closed as well as stable under base change and therefore universally closed.
\end{example}
\begin{example}
	There exist maps that are quasi-finite, separated, of finite type, and surjective, but nevertheless not proper: 
	The projection $\A^1_k \setminus \{0\} \sqcup \A^1_k \to \A^1_k$ for $k$ any field is an example.
\end{example}
The following two results we will not prove:
\begin{proposition}[Nagata Compactification]
	If $f\colon X \to Y$ is separated and of finite type, with $X$ and $Y$ Noetherian schemes, then $f$ can be factored as $X \xto{h} Z \xto{g} Y$ with $h$ an open immersion and $g$ proper.
\end{proposition}
\begin{proposition}
	Let $f\colon X \to Y$ be a morphism of schemes.
	Then $f$ is finite iff it is quasi-finite and proper.
\end{proposition}
We now turn our attention to Vakil's \defineterm{magic square}, an important tool for working with separatedness.
\begin{proposition}
	Given schemes $X_1$, $X_2$, $Y$, and $Z$, as well as maps $f_i\colon X_i \to Y$ ($i = 1, 2$) and $g\colon Y \to Z$, the square
	\begin{equation*}
		\begin{tikzcd}
			X_1 \times_Y X_2
					\ar[r]
					\ar[d]
					\ar[dr, pullback marker]
				& Y
					\ar[d, "\Delta_{Y / Z}"]
			\\
			X_1 \times_Z X_2
					\ar[r]
				& Y \times_Z Y
		\end{tikzcd}
	\end{equation*}
	is a pullback square.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Separatedness and properness are closed under composition.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Given morphisms of schemes $X \xto{f} Y \xto{g} Z$ where $g$ is separated, then $\Gamma_f\colon X \to X \times_Z Y$, the \defineterm{graph} of $f$, defined by the diagram
	\begin{equation*}
		\begin{tikzcd}
			X
					\ar[dr, "\isom"]
					\ar[ddr, swap, bend right = 18, "\Gamma_f"]
			\\[-.9em]
				&[-2em] X \times_Y Y
					\ar[r]
					\ar[d, "\psi"]
					\ar[dr, pullback marker]
				& Y
					\ar[d, "\Delta_g"]
			\\
				& X \times_Z Y
					\ar[r]
				& Y \times_Z Y
		\end{tikzcd}
	\end{equation*}
	is a closed immersion.
	(Here the pullback square is the magic square obtained from $X_1 = X$, $X_2 = Y$ and $f_2 = \id_Y$.)
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{proposition}
	Given morphisms $X \xto{f} Y \xto{g} Z$ of schemes, then $f$ is separated if $g \circ f$ is.
	Likewise, if $g \circ f$ is proper, $g$ is separated and $f$ is quasi-compact, then $f$ is proper.
\end{proposition}
\begin{proof}
	TODO
\end{proof}
\begin{theorem}[Cancellation Theorem]
	Consider a property $P$ of morphisms of schemes which is preserved under composition and stable under base-change.
	Let $X \xto{f} Y \xto{g} Z$ be two morphisms of schemes.
	If $g \circ f$ and $\Delta_g$ have $P$, then $f$, too, has $P$.
\end{theorem}
\begin{proof}
	TODO
\end{proof}

\subsection{Valuative Criterion}
Let $K$ be a field.
A \defineterm{valuation} of $K$ is a function $v\colon K^\mlt \to \Gamma$ where $\Gamma$ is a totlly ordered abelian group such that
\begin{equation*}
	v(x \cdot y) = v(x) + v(y)
\end{equation*}
and
\begin{equation*}
	v(x + y) = \min \{v(x), v(y)\}
\end{equation*}
We can then define the \defineterm{valuation ring} $\cO_v \coloneq \{x \in K \mid v(x) \geq 0\} \subseteq K$ of $K$ with respect to $v$ (by convention $v(0) = \infty$).
The ring $\cO_v$ is a local ring with maximal ideal $\ideal{m}_v = \{x \in \cO_v \mid v(x) > 0\}$.
In fact, $\ideal{m}$ is the only non-zero prime ideal of $\cO_v$, so $\Spec \cO_v$ consists of an open point $\eta = (0)$ and a closed point $\ideal{m}_v$.
\begin{theorem}[Valuative Criterion]
	Let $f\colon X \to Y$ be a map of schemes where $X$ is Noetherian and consider all diagrams of the form
	\begin{equation*}
		\begin{tikzcd}
			\Spec K
					\ar[r]
					\ar[d, hook]
				& X
					\ar[d, "f"]
			\\
			\Spec \cO_v
					\ar[r]
					\ar[ur, dashed]
				& Y
		\end{tikzcd}
	\end{equation*}
	Where $K$ is a field and $v$ a valuation on $K$.
	Then $f$ is separated iff a lift as indicated exists, and proper iff this lift is unique.
\end{theorem}
\begin{example}
	Fix a field $k$ and let $X$ be the line with double origin.
	We claim that the projection $X \to \A^1_k$ is not separated.
	To this end, observe that $k[t]_{(t)}$ is a valuation ring of $k(t)$ with valuation given by $v(t) = 1$ and group $\Gamma = \Z$ and consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(t)
					\ar[r]
					\ar[d, hook]
				& X
					\ar[d]
			\\
			\Spec k[t]_{(t)}
					\ar[r]
				& \A^1_k
		\end{tikzcd}
	\end{equation*}
	Clearly there are at least two morphisms $\Spec k[t]_{(t)} \to X$ making the diagram commute, given by including into each of the two copies of $\A^1_k$ from which $X$ is glued, so the valuative criterion implies that $X \to \A^1_k$ is not separated.
\end{example}
\begin{example}
	Fix a field $k$ and and consider the projection $\A^1_k \to \Spec k$.
	Consider the diagram
	\begin{equation*}
		\begin{tikzcd}
			\Spec k(t)
					\ar[r]
					\ar[d, hook]
				& \A^1_k
					\ar[d]
			\\
			\Spec k[t]_{(t)}
					\ar[r]
					\ar[ur, dashed]
				& \Spec k
		\end{tikzcd}
	\end{equation*}
	where the top map is induced by the ring map $k[x] \to k(t)$, $x \mapsto t^{-1}$ and the bottom map by the inclusion $k \incl k[t]_{(t)}$.
	A solution to the lifting problem as indicated then corresponds to the dashed arrow in the diagram
	\begin{equation*}
		\begin{tikzcd}
			k(t)
				& k[x]
					\ar[l]
					\ar[dl, dashed]
			\\
			k[t]_{(t)}
					\ar[u, hook]
				& k
					\ar[l, hook]
					\ar[u, hook]
		\end{tikzcd}
	\end{equation*}
	but no such ring map exists since $t$ is not invertible in $k[t]_{(t)}$.
\end{example}

\printbibliography
\printindex
\end{document}
